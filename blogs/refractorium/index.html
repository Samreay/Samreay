<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Refractorium - Samuel Hinton</title><link rel=stylesheet href="https://cosmiccoding.com.au/css/main.min.7fbf65bef988e0cecd6d148a59756085deed3c480729d260d0a30b282b1d7da8.css" integrity="sha256-f79lvvmI4M7NbRSKWXVghd7tPEgHKdJg0KMLKCsdfag="><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel="shortcut icon" href=https://cosmiccoding.com.au/img/favicon.png type=image/x-icon></head><meta name=description content="A light transport simulator written in vanilla javascript!"><meta name=robots content="noodp"><link rel=canonical href=https://cosmiccoding.com.au/blogs/refractorium/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cosmiccoding.com.au/blogs/refractorium/cover.jpg"><meta name=twitter:title content="Refractorium"><meta name=twitter:description content="A light transport simulator written in vanilla javascript!"><meta property="og:title" content="Refractorium"><meta property="og:description" content="A light transport simulator written in vanilla javascript!"><meta property="og:type" content="article"><meta property="og:url" content="https://cosmiccoding.com.au/blogs/refractorium/"><meta property="og:image" content="https://cosmiccoding.com.au/blogs/refractorium/cover.jpg"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2017-03-07T00:00:00+00:00"><meta property="article:modified_time" content="2017-03-07T00:00:00+00:00"><meta property="article:section" content="blog"><meta property="article:published_time" content="2017-03-07 00:00:00 +0000 UTC"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Refractorium","genre":"blog","url":"https:\/\/cosmiccoding.com.au\/blogs\/refractorium\/","datePublished":"2017-03-07 00:00:00 \u002b0000 UTC","description":"A light transport simulator written in vanilla javascript!","author":{"@type":"Person","name":""}}</script><body><div class="flex flex-col min-h-screen overflow-hidden"><header class="absolute w-full z-30"><div class="max-w-6xl mx-auto px-4 sm:px-6"><div class="flex items-center justify-between h-20"><div class="flex-shrink-0 mr-4"><a class=block href=/ aria-label="Samuel Hinton"><h2 class=logo>SRH</h2></a></div><nav class="hidden md:flex md:flex-grow"><ul class="flex flex-grow justify-end flex-wrap items-center"><li><a href=/#books class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Books</a></li><li><a href=/reviews class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Reviews</a></li><li><a href=/tutorials class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Tutorials</a></li><li><a href=/blogs class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Blog</a></li><li><a href=/#courses class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">CV</a></li></ul></nav><div class=md:hidden x-data="{ expanded: false }"><button class=hamburger :class="{ 'active': expanded }" @click.stop="expanded = !expanded" aria-controls=mobile-nav :aria-expanded=expanded>
<span class=sr-only>Menu</span><svg class="w-6 h-6 fill-current text-gray-300 hover:text-gray-200 transition duration-150 ease-in-out" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect y="4" width="24" height="2" rx="1"/><rect y="11" width="24" height="2" rx="1"/><rect y="18" width="24" height="2" rx="1"/></svg></button><nav id=mobile-nav class="absolute top-full z-20 left-0 w-full px-4 sm:px-6 overflow-hidden transition-all duration-300 ease-in-out" x-ref=mobileNav :style="expanded ? 'max-height: ' + $refs.mobileNav.scrollHeight + 'px; opacity: 1' : 'max-height: 0; opacity: .8'" @click.away="expanded = false" @keydown.escape.window="expanded = false" x-cloak><ul class="bg-gray-800 px-4 py-2"><li><a href=/#books class="flex text-gray-300 hover:text-gray-200 py-2">Books</a></li><li><a href=/reviews class="flex text-gray-300 hover:text-gray-200 py-2">Reviews</a></li><li><a href=/tutorials class="flex text-gray-300 hover:text-gray-200 py-2">Tutorials</a></li><li><a href=/blogs class="flex text-gray-300 hover:text-gray-200 py-2">Blog</a></li><li><a href=/#courses class="flex text-gray-300 hover:text-gray-200 py-2">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="flex text-gray-300 hover:text-gray-200 py-2">CV</a></li></ul></nav></div></div></div></header><div class=flex-grow><div id=post-container class="content content-wider blog-post relative"><div class="section-header blog"><h1 class=title>Refractorium</h1><p>6th March 2017</p><p>A light transport simulator written in vanilla javascript!</p></div><h2 style=font-weight:800;text-align:center;margin-bottom:50px><a href=https://samreay.github.io/Refractorium/ target=_blank>Click here to run the simulator in your browser.</a></h2><p>I was browsing <a href=http://reddit.com/r/Simulated>Reddit&rsquo;s Simulated subreddit</a> one afternoon and came across a nice GPU voxel fluid
animation. Whilst reading up <a href=https://benedikt-bitterli.me/vorton-fluid.html>how it was engineered</a>, I stumbled
onto a project by <a href=https://benedikt-bitterli.me/index.html>Benedikt Bitterli</a> called <a href=https://benedikt-bitterli.me/tantalum/tantalum.html>Tantalum</a>.</p><p>It was a GPU accelerated 2D light transport simulator, and I spent at least an hour playing around with it
and producing some beautiful caustics. But with Tantalum, you can only control the position and angle of the
light source - the rest of the scene was static. And so, obviously, the solution was for me to build my
own light transport simulator with a dynamic scene. The staticness of Tantalum make&rsquo;s sense as a dynamic
scene would require painful dynamic shader compilation. Difficult, and definitely over my head as I have
no experience with WebGL. And so a completely CPU based javascript project was born.</p><p>On the most basic level, scenes are composed of objects. Some objects have a brightness set, and these
objects emit light. Others are objects that light interacts with - either lines or solids. Lines can three optical
properties - absorption (how much of the light is absorbed in the material), reflection (how much bounces instead
of penetrating the object) and roughness. In my implementation, roughness is implemented as Gaussian noise on
the expected output angle, bound to within 90 degrees of the normal using rejection sampling. An example
of different styles of lines are shown below. The first line the beam of light hits is a perfect mirror:
0% absorption, 100% reflection, 0 roughness. The second line is a beam splitter, which has a reflectance of 30%.
The top line is then a generic wall - some absorption and a medium roughness. The bottom right line is essentially
an event horizon - 100% absorption.</p><p><div><figure class=rounded><picture><source srcset=/blogs/refractorium/linetest_hu176c8e5a837b4680160f4e950f55ff26_79255_1080x0_resize_q90_h2_box.webp width=1080 height=720 type=image/webp><source srcset=/blogs/refractorium/linetest.jpg width=1080 height=720 type=image/jpg><img width=1080 height=720 loading=lazy decoding=async alt src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Solid objects have another property - refractive index. Now here I&rsquo;ve had to take some liberties with
the refractive index&rsquo;s dependence on wavelength. In order to get nice diffraction of light I essentially made
up a strong relationship. It&rsquo;s not physical, at all, but it looks alright&mldr; and isn&rsquo;t that what&rsquo;s important in
a light simulator? The image below shows four different solids. The first has no 0% reflection, and
we can see all the light transferring through it. The second object has around 30% reflection, and we
can see some internal reflection going on. The convex lens then focuses light onto a roughened prism with
high refractive index, so we can see extra reflection from the refractive index and the dispersion of light on
interacting with the object.</p><p><div><figure class=rounded><picture><source srcset=/blogs/refractorium/refracttest_hue53c2aeca4ad36341b2e7fde8e986c65_101377_1080x0_resize_q90_h2_box.webp width=1080 height=720 type=image/webp><source srcset=/blogs/refractorium/refracttest.jpg width=1080 height=720 type=image/jpg><img width=1080 height=720 loading=lazy decoding=async alt src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>At this point in the project I had the scene&rsquo;s set up, but no interactivity. I knew I wanted objects
to be directly selectable on the canvas, and so the question became how to determine if the user
had clicked on an object. However, all objects already had methods used to check if a light ray intersected
them (returning the distance to intersection, coordinate of intersection, resultant angle of reflection, etc).
And so detecting object clicks became extremely simple. In the case of a solid object, illustrated on the left
hand side of the image below, we can see that all case rays intersect with the object. For a line, all we have to do
is case a bunch of rays, and check the distance of closest intersection. Combining those with object information such as
the object size we can produce a metric that (after applying a threshold) that is not only reliable, but able to easily
select edge cases (light objects inside objects).</p><p><div><figure class=rounded><picture><source srcset=/blogs/refractorium/objectDetection_hu06ba3a6bcda531c7e58ea8df3080cacd_346069_1080x0_resize_q90_h2_box.webp width=1080 height=720 type=image/webp><source srcset=/blogs/refractorium/objectDetection.jpg width=1080 height=720 type=image/jpg><img width=1080 height=720 loading=lazy decoding=async alt src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Slapping a bit of CSS around everything and providing some basic tools to control renderer settings, I put
it online, and I&rsquo;m fairly happy with how it turned out. I&rsquo;d like to see if I can parcel light ray
simulation out to web workers, but I&rsquo;m happy with the results so far!</p><p>{% include image.html ?class=&ldquo;img-poster&rdquo; url=&ldquo;main.jpg&rdquo;)
{% include image.html ?class=&ldquo;img-poster&rdquo; url=&ldquo;mixed.jpg&rdquo;)
{% include image.html ?class=&ldquo;img-poster&rdquo; url=&ldquo;cylinder.jpg&rdquo;)</p><div class="relative max-w-xl mx-auto my-20"><div class="fancy_card horizontal"><div class=card_translator><div class="card_rotator tiny_rot card_layer"><div class="card_layer newsletter p-2"><div class="newsletter-inner h-full"><div class="relative h-full sib-form-container" id=sib-form-container><div class="mb-6 lg:mb-12 text-center"><h3 class="text-main-200 mb-2 lg:mb-8">Stay in the loop!</h3><p class="text-main-100 text-lg text-opacity-70">For new releases, exclusive giveaways, and reviews.</p></div><form action="https://Cosmiccoding.us5.list-manage.com/subscribe/post?u=aebe5de1d2e40dccb3aeca491&amp;id=3987dd4a1f" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class="validate w-full" target=_blank novalidate><div><input type=email class="w-full appearance-none bg-main-600 mb-4 border border-main-600 bg-opacity-5 focus:border-main-300 rounded-sm px-4 py-3 text-main-100 placeholder-main-100 required" placeholder="Your best email…" aria-label="Your best email…" name=EMAIL required data-required=true id=EMAIL><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_aebe5de1d2e40dccb3aeca491_3987dd4a1f tabindex=-1></div><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class="button btn bg-main-600 hover:bg-main-400 shadow w-full"></div><p id=mce-error-response style=display:none class="text-center mt-2 opacity-50 text-main-200">There was a problem, please try again.</p><p id=mce-success-response style=display:none class="text-center mt-2 opacity-50 text-main-200">Thanks mate, won't let ya down.</p></form></div></div></div><div class="card_layer card_effect card_soft_glare" style=pointer-events:none></div></div></div></div></div></div></div><script language=javascript type=text/javascript src=https://cosmiccoding.com.au/js/main.min.11673d10a962fb5205229607e62ea1d23424d35dad33db7bfe2a09a63d5409fa.js></script>
<script async defer src="https://www.googletagmanager.com/gtag/js?id=G-GRX6QE03YR"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GRX6QE03YR")</script></div></body></html>