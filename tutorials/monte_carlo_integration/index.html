<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Monte-Carlo Integration made easy - Samuel Hinton</title><link rel=stylesheet href="https://cosmiccoding.com.au/css/main.min.b842bc4f8d358708f7b5666fe7108ed6474cd18dad036996cd6f85d3bb7b6a42.css" integrity="sha256-uEK8T401hwj3tWZv5xCO1kdM0Y2tA2mWzW+F07t7akI="><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel="shortcut icon" href=https://cosmiccoding.com.au/img/favicon.png type=image/x-icon></head><meta name=description content="A practical Python explanation of Monte-Carlo integration"><meta name=robots content="noodp"><link rel=canonical href=https://cosmiccoding.com.au/tutorials/monte_carlo_integration/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cosmiccoding.com.au/tutorials/monte_carlo_integration/cover.png"><meta name=twitter:title content="Monte-Carlo Integration made easy"><meta name=twitter:description content="A practical Python explanation of Monte-Carlo integration"><meta property="og:title" content="Monte-Carlo Integration made easy"><meta property="og:description" content="A practical Python explanation of Monte-Carlo integration"><meta property="og:type" content="article"><meta property="og:url" content="https://cosmiccoding.com.au/tutorials/monte_carlo_integration/"><meta property="og:image" content="https://cosmiccoding.com.au/tutorials/monte_carlo_integration/cover.png"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2020-06-21T00:00:00+00:00"><meta property="article:modified_time" content="2020-06-21T00:00:00+00:00"><meta property="article:section" content="tutorial"><meta property="article:published_time" content="2020-06-21 00:00:00 +0000 UTC"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Monte-Carlo Integration made easy","genre":"tutorial","url":"https:\/\/cosmiccoding.com.au\/tutorials\/monte_carlo_integration\/","datePublished":"2020-06-21 00:00:00 \u002b0000 UTC","description":"A practical Python explanation of Monte-Carlo integration","author":{"@type":"Person","name":""}}</script><body><div class="flex flex-col min-h-screen overflow-hidden"><header class="absolute w-full z-30"><div class="max-w-6xl mx-auto px-4 sm:px-6"><div class="flex items-center justify-between h-20"><div class="flex-shrink-0 mr-4"><a class=block href=/ aria-label="Samuel Hinton"><h2 class=logo>SRH</h2></a></div><nav class="hidden md:flex md:flex-grow"><ul class="flex flex-grow justify-end flex-wrap items-center"><li><a href=/#books class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Books</a></li><li><a href=/reviews class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Reviews</a></li><li><a href=/tutorials class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Tutorials</a></li><li><a href=/blogs class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Blog</a></li><li><a href=/#courses class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">CV</a></li></ul></nav><div class=md:hidden x-data="{ expanded: false }"><button class=hamburger :class="{ 'active': expanded }" @click.stop="expanded = !expanded" aria-controls=mobile-nav :aria-expanded=expanded>
<span class=sr-only>Menu</span><svg class="w-6 h-6 fill-current text-gray-300 hover:text-gray-200 transition duration-150 ease-in-out" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect y="4" width="24" height="2" rx="1"/><rect y="11" width="24" height="2" rx="1"/><rect y="18" width="24" height="2" rx="1"/></svg></button><nav id=mobile-nav class="absolute top-full z-20 left-0 w-full px-4 sm:px-6 overflow-hidden transition-all duration-300 ease-in-out" x-ref=mobileNav :style="expanded ? 'max-height: ' + $refs.mobileNav.scrollHeight + 'px; opacity: 1' : 'max-height: 0; opacity: .8'" @click.away="expanded = false" @keydown.escape.window="expanded = false" x-cloak><ul class="bg-gray-800 px-4 py-2"><li><a href=/#books class="flex text-gray-300 hover:text-gray-200 py-2">Books</a></li><li><a href=/reviews class="flex text-gray-300 hover:text-gray-200 py-2">Reviews</a></li><li><a href=/tutorials class="flex text-gray-300 hover:text-gray-200 py-2">Tutorials</a></li><li><a href=/blogs class="flex text-gray-300 hover:text-gray-200 py-2">Blog</a></li><li><a href=/#courses class="flex text-gray-300 hover:text-gray-200 py-2">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="flex text-gray-300 hover:text-gray-200 py-2">CV</a></li></ul></nav></div></div></div></header><div class=flex-grow><div id=post-container class="content content-wider blog-post relative"><div class="section-header blog"><h1 class=title>Monte-Carlo Integration made easy</h1><p>6th June 2020</p><p>A practical Python explanation of Monte-Carlo integration</p></div><div><ul class="grid gap-6 w-full md:grid-cols-2" style=list-style:none;padding-left:0><li><input type=radio id=show-code name=code-toggle value=show-code class="hidden peer" onchange=clickCheckbox(this) required checked>
<label for=show-code class="inline-flex justify-between items-center p-5 w-full text-gray-500 bg-gray-800 rounded-lg border border-gray-200 cursor-pointer peer-checked:border-2 peer-checked:border-main-300 peer-checked:text-white peer-checked:bg-gray-700 hover:text-gray-200 hover:bg-gray-700"><div class="block w-full"><div class="w-full text-center text-lg font-semibold">Show me everything!</div><div class="w-full text-center text-sm">Oh yeah, coding time.</div></div></label></li><li><input type=radio id=hide-code name=code-toggle value=hide-code class="hidden peer" onchange=clickCheckbox(this)>
<label for=hide-code class="inline-flex justify-between items-center p-5 w-full text-gray-500 bg-gray-800 rounded-lg border border-gray-200 cursor-pointer peer-checked:border-2 peer-checked:border-main-300 peer-checked:text-white peer-checked:bg-gray-700 hover:text-gray-200 hover:bg-gray-700"><div class="block w-full"><div class="w-full text-center text-lg font-semibold">Just the plots</div><div class="w-full text-center text-sm">Code is nasty.</div></div></label></li></ul></div><script>function clickCheckbox(e){e.id=="show-code"?document.getElementById("post-container").classList.remove("hide-code"):document.getElementById("post-container").classList.add("hide-code")}</script><p>Integrating a function is tricky. A lot of the time, the math is beyond us. Or beyond me, at the very least, and so I turn to my computer, placing the burden on its silent, silicon shoulders. And yet this isn&rsquo;t the end of it, because there are a host of ways to perform numerical integration.</p><p>Do we want the simple rectangle rule? The superior trapezoidal rule? Simpson&rsquo;s rule? Do we want to adaptively sample? How many dimensions is this in anyway - 1D, 2D, 3D&mldr; 100D?</p><p>Unfortunately, every algorithm listed above falls over at higher dimensionality, simply because most of them are based off a grid. If you have a 100 points in a grid, for a 1D integral, thats easy, 100 points. For a 2D grid, well now its 10 thousand cells. For a 3D grid, thats a million voxels. This is exponential scaling. This is bad news.</p><p>So instead we turn to the amazing algorithm of Monte-Carlo integration. Monte-Carlo here means its based off random numbers (yes, I&rsquo;m glossing over a lot), and so we perform Monte-Carlo integration essentially by just taking the average of our function after evaluating it at some random points.</p><p>Let&rsquo;s just illustrate this with an example, starting with Simpson&rsquo;s rule. Let&rsquo;s integrate the super simple function:</p><p>$$ \int_0^{1.5\pi} \sin(x) \ dx $$</p><div class=width-65 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> matplotlib.pyplot <span style=color:#ff6ac1>as</span> plt
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> scipy.integrate <span style=color:#ff6ac1>import</span> simps
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>fn</span>(x):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> np<span style=color:#ff6ac1>.</span>sin(x) <span style=color:#ff6ac1>+</span> <span style=color:#ff9f43>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>xs <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>linspace(<span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>1.5</span> <span style=color:#ff6ac1>*</span> np<span style=color:#ff6ac1>.</span>pi, <span style=color:#ff9f43>100</span>)
</span></span><span style=display:flex><span>ys <span style=color:#ff6ac1>=</span> fn(xs)
</span></span><span style=display:flex><span>area <span style=color:#ff6ac1>=</span> simps(ys, x<span style=color:#ff6ac1>=</span>xs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Function&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, <span style=color:#ff9f43>0</span>, ys, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff9f43>1</span>, <span style=color:#ff9f43>0.75</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Area from Simps is </span><span style=color:#5af78e>{</span>area<span style=color:#5af78e>:</span><span style=color:#5af78e>0.3f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), plt<span style=color:#ff6ac1>.</span>legend();
</span></span></code></pre></div></div><p><div><figure class=rounded><picture><source srcset=/tutorials/monte_carlo_integration/2020-06-21-Monte_Carlo_Integration_files/2020-06-21-Monte_Carlo_Integration_1_0_hu6b888e07e55c7fd3409def562787b0c0_108802_1920x0_resize_q90_h2_box_3.webp width=1920 height=1051 type=image/webp><source srcset=/tutorials/monte_carlo_integration/2020-06-21-Monte_Carlo_Integration_files/2020-06-21-Monte_Carlo_Integration_1_0.png width=2731 height=1495 type=image/png><img width=2731 height=1495 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Great, so how would we use Monte-Carlo integration to get another esimtate?</p><div class=width-76 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>width <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1.5</span> <span style=color:#ff6ac1>*</span> np<span style=color:#ff6ac1>.</span>pi <span style=color:#ff6ac1>-</span> <span style=color:#ff9f43>0</span>  <span style=color:#78787e># The width from 0 to 1.5pi</span>
</span></span><span style=display:flex><span>samples <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>uniform(low<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>, high<span style=color:#ff6ac1>=</span>width, size<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1000000</span>)
</span></span><span style=display:flex><span>mc_area <span style=color:#ff6ac1>=</span> fn(samples)<span style=color:#ff6ac1>.</span>mean() <span style=color:#ff6ac1>*</span> width
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Function&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, <span style=color:#ff9f43>0</span>, ys, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff9f43>1</span>, <span style=color:#ff9f43>0.75</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Area from Simps is </span><span style=color:#5af78e>{</span>area<span style=color:#5af78e>:</span><span style=color:#5af78e>0.3f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff9f43>1</span>, <span style=color:#ff9f43>0.5</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Area from MC Integration is </span><span style=color:#5af78e>{</span>mc_area<span style=color:#5af78e>:</span><span style=color:#5af78e>0.3f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), plt<span style=color:#ff6ac1>.</span>legend();
</span></span></code></pre></div></div><p><div><figure class=rounded><picture><source srcset=/tutorials/monte_carlo_integration/2020-06-21-Monte_Carlo_Integration_files/2020-06-21-Monte_Carlo_Integration_3_0_hua5d69f9042175d1c28728192511fb677_135840_1920x0_resize_q90_h2_box_3.webp width=1920 height=1051 type=image/webp><source srcset=/tutorials/monte_carlo_integration/2020-06-21-Monte_Carlo_Integration_files/2020-06-21-Monte_Carlo_Integration_3_0.png width=2731 height=1495 type=image/png><img width=2731 height=1495 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Alright, so let&rsquo;s dig into this a bit:</p><ol><li>Why does this work?</li><li>What is <code>width</code>?</li><li>Why did I have to ask for a million samples!?!?</li></ol><p>Lets start with #1: <strong>How does this work?</strong></p><p>Monte-Carlo integration is all about that <a href=https://en.wikipedia.org/wiki/Law_of_large_numbers>Law of Large Numbers</a>. To summarise the Wiki page, the LLN states that if you do an experiment over and over, the average of your experiment should converge to the expected value. Our experiment here is &ldquo;sampling the function (uniformly)&rdquo;, so the LLN says if we keep sampling it, the average result should converge to the mean of the function. This should be intuitive - if you roll a fair 6-sided die a lot and take an average, you&rsquo;d expect that you&rsquo;d get around the same amount of each number, which would give you an average of 3.5.</p><p>Let&rsquo;s merge in <strong>What is <code>width</code></strong> now. If we have the average of a function over some arbitrary $x$-domain, to get the area we need to factor in how big that $x$-domain is. We are essentially finding the area of a rectangle <code>width</code> wide, with an average height given by our samples.</p><p>If we want to be more formal about this, what we are doing is combining both our original function</p><p>$$ f(x) = \sin(x), $$</p><p>and the probability density function that describes how we draw our samples. In our case, this function is - in English - uniformly between $0$ and $1.5\pi$, and in mathematics:</p><p>$$p(x) =
\begin{cases}
\frac{1}{1.5\pi}, & \text{if}\ 0 &lt; x &lt; 1.5\pi \
0, & \text{otherwise}
\end{cases}$$</p><p>The &ldquo;width&rdquo; comes in to our final result when you add the probability in to our equation:</p><p>$$\begin{align}\int_0^{1.5\pi} \sin(x)\ dx &= \int_0^{1.5\pi} \sin(x)\ \ \frac{1.5\pi}{1.5\pi} \ dx\
&= \int_0^{1.5\pi} 1.5\pi\sin(x) \ \ p(x) \ dx
\end{align}$$</p><p>Sorry for the math, but hopefully you can see that if we separate the equation so that we can get our sample function on the right, the <code>width</code> factor comes out naturally. Conceptually, it&rsquo;s easier to think of it using the rectangle analogy above, but that doesn&rsquo;t generalise too well.</p><p>Finally, <strong>why did we need so many samples?</strong></p><p>The answer is that I wanted to make sure it agreed very well with the result from Simpsons&rsquo; rule. Monte-Carlo integration has uncertainty, but you can quantify that:</p><p>$$ \text{error} = \frac{\sigma(x)}{\sqrt{N}}$$</p><p>where $\sigma$ is the standard deviation, $x$ is what we average (so really our samples times our width), and $N$ is the number of points. For us, the plot should really look like this:</p><div class="expanded-code width-92" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>error <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>std(samples <span style=color:#ff6ac1>*</span> width) <span style=color:#ff6ac1>/</span> np<span style=color:#ff6ac1>.</span>sqrt(samples<span style=color:#ff6ac1>.</span>size)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Function&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, <span style=color:#ff9f43>0</span>, ys, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff9f43>0.7</span>, <span style=color:#ff9f43>0.75</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Area from Simps is </span><span style=color:#5af78e>{</span>area<span style=color:#5af78e>:</span><span style=color:#5af78e>0.3f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff9f43>0.7</span>, <span style=color:#ff9f43>0.5</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Area from MC Integration is </span><span style=color:#5af78e>{</span>mc_area<span style=color:#5af78e>:</span><span style=color:#5af78e>0.3f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>±</span><span style=color:#5af78e>{</span>error<span style=color:#5af78e>:</span><span style=color:#5af78e>0.3f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), plt<span style=color:#ff6ac1>.</span>legend();
</span></span></code></pre></div></div><p><div><figure class=rounded><picture><source srcset=/tutorials/monte_carlo_integration/2020-06-21-Monte_Carlo_Integration_files/2020-06-21-Monte_Carlo_Integration_5_0_hu6bd43f5dcc098cd1b34fb3dc1190c596_141039_1920x0_resize_q90_h2_box_3.webp width=1920 height=1051 type=image/webp><source srcset=/tutorials/monte_carlo_integration/2020-06-21-Monte_Carlo_Integration_files/2020-06-21-Monte_Carlo_Integration_5_0.png width=2731 height=1495 type=image/png><img width=2731 height=1495 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Of course, Simpsons&rsquo; rule has error too, let&rsquo;s not forget that!</p><h2 id=importance-sampling>Importance sampling!</h2><p>Importance sampling is the way that we can improve the accuracy of our estimates. It&rsquo;s conceptually simple - in the plot above, we could get better accuracy if we estimated the peak between 1 and 2 more throughly than if we estimated the area after 4 more thoroughly. So why are we uniformly sampling our distribution, when some areas are much more important??</p><p>For a super easy example, lets change the function. We now care about</p><p>$$\int_{-\infty}^{\infty} \frac{1 + x^2}{\sqrt{2\pi}} e^{-x^2/2}\ dx.$$</p><p>Uniformly sampling this would be crazy - how can we sample from $-\infty$ to $\infty$??? Instead, what we do is we look at the function and we separate it out. We say, &ldquo;Hey, this looks like a polynomial times a normal distribution&rdquo;. Or more formally:</p><p>$$\int_{-\infty}^{\infty} (1+x^2) \ \ \mathcal{N}(0, 1)\ dx,$$</p><p>where $\mathcal{N}(0,1)$ is a normal distribution, centered at 0, with a width of 1. And just like before, we now have two parts - the first part to calculate, and the second part we can sample from. To do this, and then create a plot showing each sample, is simple:</p><div class="expanded-code width-88" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#78787e># MC integration here</span>
</span></span><span style=display:flex><span>samples_2 <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>normal(size<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1000</span>)
</span></span><span style=display:flex><span>fn_2 <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>+</span> samples_2 <span style=color:#ff6ac1>**</span> <span style=color:#ff9f43>2</span>
</span></span><span style=display:flex><span>area_2 <span style=color:#ff6ac1>=</span> fn_2<span style=color:#ff6ac1>.</span>mean()
</span></span><span style=display:flex><span>error_2 <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>std(fn_2) <span style=color:#ff6ac1>/</span> np<span style=color:#ff6ac1>.</span>sqrt(fn_2<span style=color:#ff6ac1>.</span>size)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Simps integration here</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>fn2</span>(xs):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> (<span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>+</span> xs<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>2</span>) <span style=color:#ff6ac1>*</span> np<span style=color:#ff6ac1>.</span>exp(<span style=color:#ff6ac1>-</span>(xs<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>2</span>)<span style=color:#ff6ac1>/</span><span style=color:#ff9f43>2</span>) <span style=color:#ff6ac1>/</span> np<span style=color:#ff6ac1>.</span>sqrt(<span style=color:#ff9f43>2</span> <span style=color:#ff6ac1>*</span> np<span style=color:#ff6ac1>.</span>pi)
</span></span><span style=display:flex><span>xs <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>linspace(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>5</span>, <span style=color:#ff9f43>5</span>, <span style=color:#ff9f43>200</span>)
</span></span><span style=display:flex><span>ys <span style=color:#ff6ac1>=</span> fn2(xs)
</span></span><span style=display:flex><span>area_simps <span style=color:#ff6ac1>=</span> simps(ys, x<span style=color:#ff6ac1>=</span>xs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># And of course, plotting here</span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Function&#34;</span>, lw<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>3</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, <span style=color:#ff9f43>0</span>, ys, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>4.8</span>, <span style=color:#ff9f43>0.5</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;MC Area=</span><span style=color:#5af78e>{</span>area_2<span style=color:#5af78e>:</span><span style=color:#5af78e>0.2f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>±</span><span style=color:#5af78e>{</span>error_2<span style=color:#5af78e>:</span><span style=color:#5af78e>0.2f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>4.8</span>, <span style=color:#ff9f43>0.43</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Simps Area=</span><span style=color:#5af78e>{</span>area_simps<span style=color:#5af78e>:</span><span style=color:#5af78e>0.2f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot((samples_2, samples_2), ([<span style=color:#ff9f43>0</span> <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> samples_2], [fn2(i) <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> samples_2]), 
</span></span><span style=display:flex><span>         c<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#39;#1c93e8&#39;</span>, lw<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>, ls<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#39;-&#39;</span>, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>1</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.5</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), plt<span style=color:#ff6ac1>.</span>legend();
</span></span></code></pre></div></div><p><div><figure class="img-main rounded"><picture><source srcset=/tutorials/monte_carlo_integration/cover_hu7f8a9d6af9b6027427366971f45e7e79_107947_1920x0_resize_q90_h2_box_3.webp width=1920 height=1066 type=image/webp><source srcset=/tutorials/monte_carlo_integration/cover.png width=2693 height=1495 type=image/png><img width=2693 height=1495 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Where each blue horiztonal line shows us one specific sample.
You can see that for us to get close to Simpons&rsquo; rule we need far less samples, because we&rsquo;re sampling more efficiently.</p><p>When using importance sampling, note that you don&rsquo;t need to have a probability function you can sample with <em>perfectly</em> in your equation. You can put any PDF in (just like we did with the uniform distribution), and simply divide the original equation by that PDF. Imaging if we changed our function from above just a tiny bit:</p><p>$$\int_{-\infty}^{\infty} \frac{1 + x^2}{\sqrt{2\pi}} e^{-x^4/4}\ dx.$$</p><div class=width-64 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>fn3</span>(xs):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> (<span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>+</span> xs<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>2</span>) <span style=color:#ff6ac1>*</span> np<span style=color:#ff6ac1>.</span>exp(<span style=color:#ff6ac1>-</span>(xs<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>4</span>)<span style=color:#ff6ac1>/</span><span style=color:#ff9f43>4</span>) <span style=color:#ff6ac1>/</span> np<span style=color:#ff6ac1>.</span>sqrt(<span style=color:#ff9f43>2</span> <span style=color:#ff6ac1>*</span> np<span style=color:#ff6ac1>.</span>pi)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ys3 <span style=color:#ff6ac1>=</span> fn3(xs)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Original&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys3, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Modified to be $x^4/4$&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>legend(); plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>);
</span></span></code></pre></div></div><p><div><figure class=rounded><picture><source srcset=/tutorials/monte_carlo_integration/2020-06-21-Monte_Carlo_Integration_files/2020-06-21-Monte_Carlo_Integration_9_0_hu38b012be4750c5e041dccc50d67d201e_128091_1920x0_resize_q90_h2_box_3.webp width=1920 height=1066 type=image/webp><source srcset=/tutorials/monte_carlo_integration/2020-06-21-Monte_Carlo_Integration_files/2020-06-21-Monte_Carlo_Integration_9_0.png width=2693 height=1495 type=image/png><img width=2693 height=1495 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>That&rsquo;s fine! We can still use that normal distribution from before, we just add it into the equation. Normally, your function will not be nice and analytic like the one we&rsquo;ve tried to use, so we can state in general:</p><p>$$\begin{align} \text{integral} &= \int_{-\infty}^{\infty} f(x) dx\
&= \frac{f(x)}{p(x)} \ p(x) \ dx\
\end{align}$$</p><p>where $p(x)$ in our example will be the normal distribution.</p><div class=width-76 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>from</span> scipy.stats <span style=color:#ff6ac1>import</span> norm
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># MC integration here</span>
</span></span><span style=display:flex><span>x_samp <span style=color:#ff6ac1>=</span> norm<span style=color:#ff6ac1>.</span>rvs(size<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>2000</span>)
</span></span><span style=display:flex><span>p_of_x <span style=color:#ff6ac1>=</span> norm<span style=color:#ff6ac1>.</span>pdf(x_samp)
</span></span><span style=display:flex><span>vals <span style=color:#ff6ac1>=</span> fn3(x_samp) <span style=color:#ff6ac1>/</span> p_of_x
</span></span><span style=display:flex><span>area <span style=color:#ff6ac1>=</span> vals<span style=color:#ff6ac1>.</span>mean()
</span></span><span style=display:flex><span>error <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>std(vals) <span style=color:#ff6ac1>/</span> np<span style=color:#ff6ac1>.</span>sqrt(vals<span style=color:#ff6ac1>.</span>size)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Simps integration here</span>
</span></span><span style=display:flex><span>xs <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>linspace(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>5</span>, <span style=color:#ff9f43>5</span>, <span style=color:#ff9f43>200</span>)
</span></span><span style=display:flex><span>ys <span style=color:#ff6ac1>=</span> fn3(xs)
</span></span><span style=display:flex><span>area_simps <span style=color:#ff6ac1>=</span> simps(ys, x<span style=color:#ff6ac1>=</span>xs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># And of course, plotting here</span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Function&#34;</span>, lw<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>3</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, <span style=color:#ff9f43>0</span>, ys, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>4.8</span>, <span style=color:#ff9f43>0.5</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;MC Area=</span><span style=color:#5af78e>{</span>area<span style=color:#5af78e>:</span><span style=color:#5af78e>0.2f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>±</span><span style=color:#5af78e>{</span>error<span style=color:#5af78e>:</span><span style=color:#5af78e>0.2f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>4.8</span>, <span style=color:#ff9f43>0.43</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Simps Area=</span><span style=color:#5af78e>{</span>area_simps<span style=color:#5af78e>:</span><span style=color:#5af78e>0.2f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot((x_samp, x_samp), ([<span style=color:#ff9f43>0</span> <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> x_samp], [fn3(i) <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> x_samp]), 
</span></span><span style=display:flex><span>         c<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#39;#e89a1c&#39;</span>, lw<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>, ls<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#39;-&#39;</span>, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>1</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), plt<span style=color:#ff6ac1>.</span>legend();
</span></span></code></pre></div></div><p><div><figure class=rounded><picture><source srcset=/tutorials/monte_carlo_integration/2020-06-21-Monte_Carlo_Integration_files/2020-06-21-Monte_Carlo_Integration_12_0_huf79518ddf9dd1d05327a9d3ebf29b00b_102763_1920x0_resize_q90_h2_box_3.webp width=1920 height=1066 type=image/webp><source srcset=/tutorials/monte_carlo_integration/2020-06-21-Monte_Carlo_Integration_files/2020-06-21-Monte_Carlo_Integration_12_0.png width=2693 height=1495 type=image/png><img width=2693 height=1495 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>So hopefully you can see how this would be useful. To summarise, the general process for Monte-Carlo integration is:</p><ol><li>Have your function to integrate. 1D, 2D, 3D, doesn&rsquo;t matter.</li><li>Pick a distribution that looks <em>something</em> like your function, or just use a Uniform distribution</li><li>Sample points from that distribution</li><li>Get the function at those points, and divide by $p(x)$.</li><li>Take the mean for the estimate, and the standard deviation / root(N) for the error.</li><li>Celebrate</li></ol><p>Finally, obviously I&rsquo;ve kept the examples here to 1D for simplicity, but I really should stress that MC integration shines in higher dimensions. If you have a 10 dimensional function that looks roughly Gaussian (like a normal), you can sample from a 10 dimensional normal, and apply all the same steps above, nothing at all changes.</p><hr><p>For your convenience, here&rsquo;s the code in one block:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> matplotlib.pyplot <span style=color:#ff6ac1>as</span> plt
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> scipy.integrate <span style=color:#ff6ac1>import</span> simps
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>fn</span>(x):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> np<span style=color:#ff6ac1>.</span>sin(x) <span style=color:#ff6ac1>+</span> <span style=color:#ff9f43>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>xs <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>linspace(<span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>1.5</span> <span style=color:#ff6ac1>*</span> np<span style=color:#ff6ac1>.</span>pi, <span style=color:#ff9f43>100</span>)
</span></span><span style=display:flex><span>ys <span style=color:#ff6ac1>=</span> fn(xs)
</span></span><span style=display:flex><span>area <span style=color:#ff6ac1>=</span> simps(ys, x<span style=color:#ff6ac1>=</span>xs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Function&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, <span style=color:#ff9f43>0</span>, ys, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff9f43>1</span>, <span style=color:#ff9f43>0.75</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Area from Simps is </span><span style=color:#5af78e>{</span>area<span style=color:#5af78e>:</span><span style=color:#5af78e>0.3f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), plt<span style=color:#ff6ac1>.</span>legend();
</span></span><span style=display:flex><span>width <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1.5</span> <span style=color:#ff6ac1>*</span> np<span style=color:#ff6ac1>.</span>pi <span style=color:#ff6ac1>-</span> <span style=color:#ff9f43>0</span>  <span style=color:#78787e># The width from 0 to 1.5pi</span>
</span></span><span style=display:flex><span>samples <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>uniform(low<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>, high<span style=color:#ff6ac1>=</span>width, size<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1000000</span>)
</span></span><span style=display:flex><span>mc_area <span style=color:#ff6ac1>=</span> fn(samples)<span style=color:#ff6ac1>.</span>mean() <span style=color:#ff6ac1>*</span> width
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Function&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, <span style=color:#ff9f43>0</span>, ys, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff9f43>1</span>, <span style=color:#ff9f43>0.75</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Area from Simps is </span><span style=color:#5af78e>{</span>area<span style=color:#5af78e>:</span><span style=color:#5af78e>0.3f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff9f43>1</span>, <span style=color:#ff9f43>0.5</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Area from MC Integration is </span><span style=color:#5af78e>{</span>mc_area<span style=color:#5af78e>:</span><span style=color:#5af78e>0.3f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), plt<span style=color:#ff6ac1>.</span>legend();
</span></span><span style=display:flex><span>error <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>std(samples <span style=color:#ff6ac1>*</span> width) <span style=color:#ff6ac1>/</span> np<span style=color:#ff6ac1>.</span>sqrt(samples<span style=color:#ff6ac1>.</span>size)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Function&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, <span style=color:#ff9f43>0</span>, ys, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff9f43>0.7</span>, <span style=color:#ff9f43>0.75</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Area from Simps is </span><span style=color:#5af78e>{</span>area<span style=color:#5af78e>:</span><span style=color:#5af78e>0.3f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff9f43>0.7</span>, <span style=color:#ff9f43>0.5</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Area from MC Integration is </span><span style=color:#5af78e>{</span>mc_area<span style=color:#5af78e>:</span><span style=color:#5af78e>0.3f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>±</span><span style=color:#5af78e>{</span>error<span style=color:#5af78e>:</span><span style=color:#5af78e>0.3f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), plt<span style=color:#ff6ac1>.</span>legend();
</span></span><span style=display:flex><span><span style=color:#78787e># MC integration here</span>
</span></span><span style=display:flex><span>samples_2 <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>normal(size<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1000</span>)
</span></span><span style=display:flex><span>fn_2 <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>+</span> samples_2 <span style=color:#ff6ac1>**</span> <span style=color:#ff9f43>2</span>
</span></span><span style=display:flex><span>area_2 <span style=color:#ff6ac1>=</span> fn_2<span style=color:#ff6ac1>.</span>mean()
</span></span><span style=display:flex><span>error_2 <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>std(fn_2) <span style=color:#ff6ac1>/</span> np<span style=color:#ff6ac1>.</span>sqrt(fn_2<span style=color:#ff6ac1>.</span>size)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Simps integration here</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>fn2</span>(xs):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> (<span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>+</span> xs<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>2</span>) <span style=color:#ff6ac1>*</span> np<span style=color:#ff6ac1>.</span>exp(<span style=color:#ff6ac1>-</span>(xs<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>2</span>)<span style=color:#ff6ac1>/</span><span style=color:#ff9f43>2</span>) <span style=color:#ff6ac1>/</span> np<span style=color:#ff6ac1>.</span>sqrt(<span style=color:#ff9f43>2</span> <span style=color:#ff6ac1>*</span> np<span style=color:#ff6ac1>.</span>pi)
</span></span><span style=display:flex><span>xs <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>linspace(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>5</span>, <span style=color:#ff9f43>5</span>, <span style=color:#ff9f43>200</span>)
</span></span><span style=display:flex><span>ys <span style=color:#ff6ac1>=</span> fn2(xs)
</span></span><span style=display:flex><span>area_simps <span style=color:#ff6ac1>=</span> simps(ys, x<span style=color:#ff6ac1>=</span>xs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># And of course, plotting here</span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Function&#34;</span>, lw<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>3</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, <span style=color:#ff9f43>0</span>, ys, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>4.8</span>, <span style=color:#ff9f43>0.5</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;MC Area=</span><span style=color:#5af78e>{</span>area_2<span style=color:#5af78e>:</span><span style=color:#5af78e>0.2f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>±</span><span style=color:#5af78e>{</span>error_2<span style=color:#5af78e>:</span><span style=color:#5af78e>0.2f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>4.8</span>, <span style=color:#ff9f43>0.43</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Simps Area=</span><span style=color:#5af78e>{</span>area_simps<span style=color:#5af78e>:</span><span style=color:#5af78e>0.2f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot((samples_2, samples_2), ([<span style=color:#ff9f43>0</span> <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> samples_2], [fn2(i) <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> samples_2]), 
</span></span><span style=display:flex><span>         c<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#39;#1c93e8&#39;</span>, lw<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>, ls<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#39;-&#39;</span>, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>1</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.5</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), plt<span style=color:#ff6ac1>.</span>legend();
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>fn3</span>(xs):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> (<span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>+</span> xs<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>2</span>) <span style=color:#ff6ac1>*</span> np<span style=color:#ff6ac1>.</span>exp(<span style=color:#ff6ac1>-</span>(xs<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>4</span>)<span style=color:#ff6ac1>/</span><span style=color:#ff9f43>4</span>) <span style=color:#ff6ac1>/</span> np<span style=color:#ff6ac1>.</span>sqrt(<span style=color:#ff9f43>2</span> <span style=color:#ff6ac1>*</span> np<span style=color:#ff6ac1>.</span>pi)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ys3 <span style=color:#ff6ac1>=</span> fn3(xs)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Original&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys3, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Modified to be $x^4/4$&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>legend(); plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> scipy.stats <span style=color:#ff6ac1>import</span> norm
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># MC integration here</span>
</span></span><span style=display:flex><span>x_samp <span style=color:#ff6ac1>=</span> norm<span style=color:#ff6ac1>.</span>rvs(size<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>2000</span>)
</span></span><span style=display:flex><span>p_of_x <span style=color:#ff6ac1>=</span> norm<span style=color:#ff6ac1>.</span>pdf(x_samp)
</span></span><span style=display:flex><span>vals <span style=color:#ff6ac1>=</span> fn3(x_samp) <span style=color:#ff6ac1>/</span> p_of_x
</span></span><span style=display:flex><span>area <span style=color:#ff6ac1>=</span> vals<span style=color:#ff6ac1>.</span>mean()
</span></span><span style=display:flex><span>error <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>std(vals) <span style=color:#ff6ac1>/</span> np<span style=color:#ff6ac1>.</span>sqrt(vals<span style=color:#ff6ac1>.</span>size)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Simps integration here</span>
</span></span><span style=display:flex><span>xs <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>linspace(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>5</span>, <span style=color:#ff9f43>5</span>, <span style=color:#ff9f43>200</span>)
</span></span><span style=display:flex><span>ys <span style=color:#ff6ac1>=</span> fn3(xs)
</span></span><span style=display:flex><span>area_simps <span style=color:#ff6ac1>=</span> simps(ys, x<span style=color:#ff6ac1>=</span>xs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># And of course, plotting here</span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ys, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Function&#34;</span>, lw<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>3</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, <span style=color:#ff9f43>0</span>, ys, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>4.8</span>, <span style=color:#ff9f43>0.5</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;MC Area=</span><span style=color:#5af78e>{</span>area<span style=color:#5af78e>:</span><span style=color:#5af78e>0.2f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>±</span><span style=color:#5af78e>{</span>error<span style=color:#5af78e>:</span><span style=color:#5af78e>0.2f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>4.8</span>, <span style=color:#ff9f43>0.43</span>, <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Simps Area=</span><span style=color:#5af78e>{</span>area_simps<span style=color:#5af78e>:</span><span style=color:#5af78e>0.2f</span><span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>12</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot((x_samp, x_samp), ([<span style=color:#ff9f43>0</span> <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> x_samp], [fn3(i) <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> x_samp]), 
</span></span><span style=display:flex><span>         c<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#39;#e89a1c&#39;</span>, lw<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>, ls<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#39;-&#39;</span>, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>1</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), plt<span style=color:#ff6ac1>.</span>legend();
</span></span></code></pre></div><div class="relative max-w-xl mx-auto my-20"><div class="fancy_card horizontal"><div class=card_translator><div class="card_rotator tiny_rot card_layer"><div class="card_layer newsletter p-2"><div class="newsletter-inner h-full"><div class="relative h-full sib-form-container" id=sib-form-container><div class="mb-6 lg:mb-12 text-center"><h3 class="text-main-200 mb-2 lg:mb-8">Stay in the loop!</h3><p class="text-main-100 text-lg text-opacity-70">For new releases, exclusive giveaways, and reviews.</p></div><form action="https://Cosmiccoding.us5.list-manage.com/subscribe/post?u=aebe5de1d2e40dccb3aeca491&id=3987dd4a1f" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class="validate w-full" target=_blank novalidate><div><input type=email class="w-full appearance-none bg-main-600 mb-4 border border-main-600 bg-opacity-5 focus:border-main-300 rounded-sm px-4 py-3 text-main-100 placeholder-main-100 required" placeholder="Your best email…" aria-label="Your best email…" name=EMAIL required data-required=true id=EMAIL><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_aebe5de1d2e40dccb3aeca491_3987dd4a1f tabindex=-1></div><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class="button btn bg-main-600 hover:bg-main-400 shadow w-full"></div><p id=mce-error-response style=display:none class="text-center mt-2 opacity-50 text-main-200">There was a problem, please try again.</p><p id=mce-success-response style=display:none class="text-center mt-2 opacity-50 text-main-200">Thanks mate, won't let ya down.</p></form></div></div></div><div class="card_layer card_effect card_soft_glare" style=pointer-events:none></div></div></div></div></div></div><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script></div><script language=javascript type=text/javascript src=https://cosmiccoding.com.au/js/main.min.11673d10a962fb5205229607e62ea1d23424d35dad33db7bfe2a09a63d5409fa.js></script>
<script async defer src="https://www.googletagmanager.com/gtag/js?id=G-GRX6QE03YR"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GRX6QE03YR")</script></div></body></html>