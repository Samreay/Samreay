<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Visualising Patient Contributions for the CCCC - Samuel Hinton</title><link rel=stylesheet href="https://cosmiccoding.com.au/css/main.min.5400481537df6ded7c631d7584eaeb522e0bea3c952908a01d5163e524dfbcde.css" integrity="sha256-VABIFTffbe18Yx11hOrrUi4L6jyVKQigHVFj5STfvN4="><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel="shortcut icon" href=https://cosmiccoding.com.au/img/favicon.png type=image/x-icon></head><meta name=description content="A visual thank you to our contributing sites"><meta name=robots content="noodp"><link rel=canonical href=https://cosmiccoding.com.au/tutorials/cccc_institutions/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cosmiccoding.com.au/tutorials/cccc_institutions/cover.png"><meta name=twitter:title content="Visualising Patient Contributions for the CCCC"><meta name=twitter:description content="A visual thank you to our contributing sites"><meta property="og:title" content="Visualising Patient Contributions for the CCCC"><meta property="og:description" content="A visual thank you to our contributing sites"><meta property="og:type" content="article"><meta property="og:url" content="https://cosmiccoding.com.au/tutorials/cccc_institutions/"><meta property="og:image" content="https://cosmiccoding.com.au/tutorials/cccc_institutions/cover.png"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2020-07-31T00:00:00+00:00"><meta property="article:modified_time" content="2020-07-31T00:00:00+00:00"><meta property="article:section" content="tutorial"><meta property="article:published_time" content="2020-07-31 00:00:00 +0000 UTC"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Visualising Patient Contributions for the CCCC","genre":"tutorial","url":"https:\/\/cosmiccoding.com.au\/tutorials\/cccc_institutions\/","datePublished":"2020-07-31 00:00:00 \u002b0000 UTC","description":"A visual thank you to our contributing sites","author":{"@type":"Person","name":""}}</script><body><div class="flex flex-col min-h-screen overflow-hidden"><header class="absolute w-full z-30"><div class="max-w-6xl mx-auto px-4 sm:px-6"><div class="flex items-center justify-between h-20"><div class="flex-shrink-0 mr-4"><a class=block href=/ aria-label="Samuel Hinton"><h2 class=logo>SRH</h2></a></div><nav class="hidden md:flex md:flex-grow"><ul class="flex flex-grow justify-end flex-wrap items-center"><li><a href=/#books class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Books</a></li><li><a href=/reviews class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Reviews</a></li><li><a href=/tutorials class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Tutorials</a></li><li><a href=/blogs class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Blog</a></li><li><a href=/#courses class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">CV</a></li></ul></nav><div class=md:hidden x-data="{ expanded: false }"><button class=hamburger :class="{ 'active': expanded }" @click.stop="expanded = !expanded" aria-controls=mobile-nav :aria-expanded=expanded>
<span class=sr-only>Menu</span><svg class="w-6 h-6 fill-current text-gray-300 hover:text-gray-200 transition duration-150 ease-in-out" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect y="4" width="24" height="2" rx="1"/><rect y="11" width="24" height="2" rx="1"/><rect y="18" width="24" height="2" rx="1"/></svg></button><nav id=mobile-nav class="absolute top-full z-20 left-0 w-full px-4 sm:px-6 overflow-hidden transition-all duration-300 ease-in-out" x-ref=mobileNav :style="expanded ? 'max-height: ' + $refs.mobileNav.scrollHeight + 'px; opacity: 1' : 'max-height: 0; opacity: .8'" @click.away="expanded = false" @keydown.escape.window="expanded = false" x-cloak><ul class="bg-gray-800 px-4 py-2"><li><a href=/#books class="flex text-gray-300 hover:text-gray-200 py-2">Books</a></li><li><a href=/reviews class="flex text-gray-300 hover:text-gray-200 py-2">Reviews</a></li><li><a href=/tutorials class="flex text-gray-300 hover:text-gray-200 py-2">Tutorials</a></li><li><a href=/blogs class="flex text-gray-300 hover:text-gray-200 py-2">Blog</a></li><li><a href=/#courses class="flex text-gray-300 hover:text-gray-200 py-2">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="flex text-gray-300 hover:text-gray-200 py-2">CV</a></li></ul></nav></div></div></div></header><div class=flex-grow><div id=post-container class="content content-wider blog-post relative"><div class="section-header blog"><h1 class=title>Visualising Patient Contributions for the CCCC</h1><p>6th July 2020</p><p>A visual thank you to our contributing sites</p></div><div><ul class="grid gap-6 w-full md:grid-cols-2" style=list-style:none;padding-left:0><li><input type=radio id=show-code name=code-toggle value=show-code class="hidden peer" onchange=clickCheckbox(this) required checked>
<label for=show-code class="inline-flex justify-between items-center p-5 w-full text-gray-500 bg-gray-800 rounded-lg border border-gray-200 cursor-pointer peer-checked:border-2 peer-checked:border-main-300 peer-checked:text-white peer-checked:bg-gray-700 hover:text-gray-200 hover:bg-gray-700"><div class="block w-full"><div class="w-full text-center text-lg font-semibold">Show me everything!</div><div class="w-full text-center text-sm">Oh yeah, coding time.</div></div></label></li><li><input type=radio id=hide-code name=code-toggle value=hide-code class="hidden peer" onchange=clickCheckbox(this)>
<label for=hide-code class="inline-flex justify-between items-center p-5 w-full text-gray-500 bg-gray-800 rounded-lg border border-gray-200 cursor-pointer peer-checked:border-2 peer-checked:border-main-300 peer-checked:text-white peer-checked:bg-gray-700 hover:text-gray-200 hover:bg-gray-700"><div class="block w-full"><div class="w-full text-center text-lg font-semibold">Just the plots</div><div class="w-full text-center text-sm">Code is nasty.</div></div></label></li></ul></div><script>function clickCheckbox(e){e.id=="show-code"?document.getElementById("post-container").classList.remove("hide-code"):document.getElementById("post-container").classList.add("hide-code")}</script><p>The COVID-19 Critical Care Consortium is an international collaboration of hundreds of hospital sites from dozens of countries around the world. Our sites have been slowly but steadily gathering data for critical cases of COVID-19 since earlier in the year, and we thought it would be good to show just how international the collaboration is.</p><p>To that end, in my role as one of the technical leads (responsible for the data pipeline and ingestion), I created out a simple (and no-risk) data product simply containing a list of our participant sites, and how many patients they have enrolled in our study at a given date. The details for those patients are - of course - not contained in this data product in any way.</p><p>This is what we&rsquo;re going to be making.</p><p><div class=video><video preload=auto playsinline plays-inline controls autoplay loop muted>
<source src=/tutorials/cccc_institutions/contributions.mp4 type=video/mp4></video></div></p><h1 id=basic-dataset-prep>Basic Dataset Prep</h1><p>So let&rsquo;s start things up, and load in the enrolment data.</p><div class="expanded-code width-85" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> pandas <span style=color:#ff6ac1>as</span> pd
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span>data <span style=color:#ff6ac1>=</span> pd<span style=color:#ff6ac1>.</span>read_csv(<span style=color:#5af78e>&#34;cccc_enrolment/enrolment_site.csv&#34;</span>, parse_dates<span style=color:#ff6ac1>=</span>[<span style=color:#ff9f43>0</span>], index_col<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>)
</span></span><span style=display:flex><span>data <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>fillna(<span style=color:#ff9f43>0</span>)<span style=color:#ff6ac1>.</span>astype(<span style=color:#ff5c57>int</span>)
</span></span><span style=display:flex><span>data<span style=color:#ff6ac1>.</span>iloc[<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>5</span>:, :<span style=color:#ff9f43>5</span>]
</span></span></code></pre></div></div><div><table class="table-auto table dataframe"><thead><tr style=text-align:right><th></th><th>00543-Medical University of Vienna</th><th>00544-Lancaster General Health</th><th>00546-Penn Medicine</th><th>00547-Oklahoma Heart Institute</th><th>00548-UH Cleveland Hospital</th></tr><tr><th>date_enrolment</th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2020-09-24</th><td>9</td><td>39</td><td>42</td><td>2</td><td>26</td></tr><tr><th>2020-09-25</th><td>9</td><td>39</td><td>42</td><td>2</td><td>26</td></tr><tr><th>2020-09-26</th><td>9</td><td>39</td><td>42</td><td>2</td><td>26</td></tr><tr><th>2020-09-27</th><td>9</td><td>39</td><td>42</td><td>2</td><td>26</td></tr><tr><th>2020-09-28</th><td>9</td><td>39</td><td>42</td><td>2</td><td>26</td></tr></tbody></table></div><p>Great, so you can see we have the vetical axis representing the date, and each site is a column, with its numeric identifier first. Lets remove those IDs, because they are useful in a database, but not for us.</p><div class=width-69 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>sites <span style=color:#ff6ac1>=</span> [c<span style=color:#ff6ac1>.</span>split(<span style=color:#5af78e>&#34;-&#34;</span>, <span style=color:#ff9f43>1</span>)[<span style=color:#ff9f43>1</span>] <span style=color:#ff6ac1>if</span> <span style=color:#5af78e>&#34;-&#34;</span> <span style=color:#ff6ac1>in</span> c <span style=color:#ff6ac1>else</span> c <span style=color:#ff6ac1>for</span> c <span style=color:#ff6ac1>in</span> data<span style=color:#ff6ac1>.</span>columns]
</span></span><span style=display:flex><span><span style=color:#ff5c57>print</span>(sites[<span style=color:#ff9f43>60</span>:<span style=color:#ff9f43>70</span>])
</span></span></code></pre></div></div><pre><code>['Fukuoka University', 'Mater Dei Hospital', 'Yokohama City University Medical Center', 'Nagoya University Hospital', 'PICU Saiful Anwar Hospital', 'Adult ICU Saiful Anwar Hospital', 'KourituTouseiHospital', 'HokkaidoUniversityHospital', 'ChibaUniversityHospital', 'UniversityofAlabamaatBirminghamHospital']
</code></pre><p>Looking good so far. However, I know that some of the sites have - for some reason - had all whitespace removed. So lets write a small parser to go from CamelCase to normal words.</p><div class="expanded-code width-81" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#78787e># Some of the sites are missing spaces for some reason</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>fix_site</span>(site):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> <span style=color:#5af78e>&#34; &#34;</span> <span style=color:#ff6ac1>not</span> <span style=color:#ff6ac1>in</span> site:
</span></span><span style=display:flex><span>        <span style=color:#78787e># Dont fix a sitename which is an acryonym</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>if</span> site <span style=color:#ff6ac1>!=</span> site<span style=color:#ff6ac1>.</span>upper():
</span></span><span style=display:flex><span>            site <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#39;&#39;</span><span style=color:#ff6ac1>.</span>join(<span style=color:#ff5c57>map</span>(<span style=color:#ff6ac1>lambda</span> x: x <span style=color:#ff6ac1>if</span> x<span style=color:#ff6ac1>.</span>islower() <span style=color:#ff6ac1>else</span> <span style=color:#5af78e>&#34; &#34;</span> <span style=color:#ff6ac1>+</span> x, site))   
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> site<span style=color:#ff6ac1>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sites_fixed <span style=color:#ff6ac1>=</span> [fix_site(s) <span style=color:#ff6ac1>for</span> s <span style=color:#ff6ac1>in</span> sites]
</span></span><span style=display:flex><span><span style=color:#ff5c57>print</span>(sites_fixed[<span style=color:#ff9f43>60</span>:<span style=color:#ff9f43>70</span>])
</span></span></code></pre></div></div><pre><code>['Fukuoka University', 'Mater Dei Hospital', 'Yokohama City University Medical Center', 'Nagoya University Hospital', 'PICU Saiful Anwar Hospital', 'Adult ICU Saiful Anwar Hospital', 'Kouritu Tousei Hospital', 'Hokkaido University Hospital', 'Chiba University Hospital', 'Universityof Alabamaat Birmingham Hospital']
</code></pre><p>This is probably as good as we can get it right now. So lets copy the dataframe so we don&rsquo;t clobber the original, and update the columns.</p><div class="reduced-code width-32" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>data_fixed <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>copy()
</span></span><span style=display:flex><span>data_fixed<span style=color:#ff6ac1>.</span>columns <span style=color:#ff6ac1>=</span> sites_fixed
</span></span><span style=display:flex><span>data_fixed<span style=color:#ff6ac1>.</span>iloc[<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>5</span>:, :<span style=color:#ff9f43>5</span>]
</span></span></code></pre></div></div><div><table class="table-auto table dataframe"><thead><tr style=text-align:right><th></th><th>Medical University of Vienna</th><th>Lancaster General Health</th><th>Penn Medicine</th><th>Oklahoma Heart Institute</th><th>UH Cleveland Hospital</th></tr><tr><th>date_enrolment</th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2020-09-24</th><td>9</td><td>39</td><td>42</td><td>2</td><td>26</td></tr><tr><th>2020-09-25</th><td>9</td><td>39</td><td>42</td><td>2</td><td>26</td></tr><tr><th>2020-09-26</th><td>9</td><td>39</td><td>42</td><td>2</td><td>26</td></tr><tr><th>2020-09-27</th><td>9</td><td>39</td><td>42</td><td>2</td><td>26</td></tr><tr><th>2020-09-28</th><td>9</td><td>39</td><td>42</td><td>2</td><td>26</td></tr></tbody></table></div><p>Now, I do want to make an animation out of this, with more frames than days, so we&rsquo;ll just do a super simple interpolation to add extra evenly spaced datetimes that will correspond to each frame. In addition, I&rsquo;ll start the clock ticking from February first.</p><div class="expanded-code width-90" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#78787e># Interpolation</span>
</span></span><span style=display:flex><span>fr <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>30</span>  <span style=color:#78787e># frame rate</span>
</span></span><span style=display:flex><span>t <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>12</span>  <span style=color:#78787e># seconds</span>
</span></span><span style=display:flex><span>new_index <span style=color:#ff6ac1>=</span> pd<span style=color:#ff6ac1>.</span>date_range(<span style=color:#5af78e>&#34;2020-02-01&#34;</span>, data_fixed<span style=color:#ff6ac1>.</span>index<span style=color:#ff6ac1>.</span>max(), fr <span style=color:#ff6ac1>*</span> t)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Combine index, interp, remove original index</span>
</span></span><span style=display:flex><span>data_fixed <span style=color:#ff6ac1>=</span> data_fixed<span style=color:#ff6ac1>.</span>reindex(new_index <span style=color:#ff6ac1>|</span> data_fixed<span style=color:#ff6ac1>.</span>index)<span style=color:#ff6ac1>.</span>interpolate()<span style=color:#ff6ac1>.</span>loc[new_index]
</span></span></code></pre></div></div><p>And I also want to have the animation flash or brighten a bit when sites add new patients, so to get a feel for that, we&rsquo;ll simply take the difference in rows (and fillna to put zero in the first row).</p><div class="reduced-code width-47" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>data_fixed_change <span style=color:#ff6ac1>=</span> data_fixed<span style=color:#ff6ac1>.</span>diff()<span style=color:#ff6ac1>.</span>fillna(<span style=color:#ff9f43>0</span>)
</span></span></code></pre></div></div><h1 id=getting-coordinates>Getting coordinates</h1><p>Each site obviously represents a specific physical location on the planet. Alas, I do not know this - all I have is a name. So, lets use <code>opencage</code> to do a search for each site name, and extract the latitude and longitude for each site if we can find it. I don&rsquo;t expect this to work for them all, but I&rsquo;d rather manually look up ten sites than a hundred.</p><p>Let&rsquo;s set up the library with our token to start with:</p><div class="reduced-code width-60" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>from</span> opencage.geocoder <span style=color:#ff6ac1>import</span> OpenCageGeocode
</span></span><span style=display:flex><span>key <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;&#34;</span> <span style=color:#78787e># The trial version allows you do this all for free</span>
</span></span><span style=display:flex><span>geocoder <span style=color:#ff6ac1>=</span> OpenCageGeocode(key)
</span></span></code></pre></div></div><p>And then write a little function that - when given a query - will try and find the latitude, longitude and country. If it can&rsquo;t find anything, we&rsquo;ll return None and I&rsquo;ll do it myself.</p><div class="reduced-code width-49" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_lat_long_from_site</span>(query):
</span></span><span style=display:flex><span>    results <span style=color:#ff6ac1>=</span> geocoder<span style=color:#ff6ac1>.</span>geocode(query)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> <span style=color:#ff6ac1>not</span> <span style=color:#ff5c57>len</span>(results):
</span></span><span style=display:flex><span>        <span style=color:#ff5c57>print</span>(<span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;</span><span style=color:#5af78e>{</span>query<span style=color:#5af78e>}</span><span style=color:#5af78e> unable to be located&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> <span style=color:#ff6ac1>None</span>
</span></span><span style=display:flex><span>    lat <span style=color:#ff6ac1>=</span> results[<span style=color:#ff9f43>0</span>][<span style=color:#5af78e>&#39;geometry&#39;</span>][<span style=color:#5af78e>&#39;lat&#39;</span>]
</span></span><span style=display:flex><span>    long <span style=color:#ff6ac1>=</span> results[<span style=color:#ff9f43>0</span>][<span style=color:#5af78e>&#39;geometry&#39;</span>][<span style=color:#5af78e>&#39;lng&#39;</span>]
</span></span><span style=display:flex><span>    country <span style=color:#ff6ac1>=</span> results[<span style=color:#ff9f43>0</span>][<span style=color:#5af78e>&#34;components&#34;</span>][<span style=color:#5af78e>&#34;country&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> (lat, long, country)
</span></span></code></pre></div></div><p>And to make sure I don&rsquo;t spam this API over and over, we&rsquo;ll run this once, save it out to JSON, and when I run this again in the future we can just read the file in.</p><div class="expanded-code width-101" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> os
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>filename <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;cccc_enrolment/site_locations.json&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Check if file exists</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>if</span> os<span style=color:#ff6ac1>.</span>path<span style=color:#ff6ac1>.</span>exists(filename):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>with</span> <span style=color:#ff5c57>open</span>(filename) <span style=color:#ff6ac1>as</span> f:
</span></span><span style=display:flex><span>        coords <span style=color:#ff6ac1>=</span> json<span style=color:#ff6ac1>.</span>load(f)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Add manual ones that I know wont be found</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Uniklinik (University Hospital Frankfurt)&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>50.0936204</span>, <span style=color:#ff9f43>8.6506709</span>, <span style=color:#5af78e>&#34;Germany&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Prof Dr R. D. Kandou Central Hospital - Paediatric&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1.453734</span>, <span style=color:#ff9f43>124.8056623</span>, <span style=color:#5af78e>&#34;Indonesia&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Prof Dr R. D. Kandou Central Hospital - Adult&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1.45</span>, <span style=color:#ff9f43>124.80</span>, <span style=color:#5af78e>&#34;Indonesia&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Kyoto Prefectural University of Medicine&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>35.0243414</span>, <span style=color:#ff9f43>135.7682285</span>, <span style=color:#5af78e>&#34;Japan&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;ISMETT&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>38.1084401</span>, <span style=color:#ff9f43>13.3613329</span>, <span style=color:#5af78e>&#34;Italy&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Kuwait ECLS program, Al-Amiri &amp; Jaber Al-Ahmed Hospitals&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>29.3876968</span>, <span style=color:#ff9f43>47.9881274</span>, <span style=color:#5af78e>&#34;Kuwait&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Dr Sardjito Government Hospital - Paediatric&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>-</span><span style=color:#ff9f43>7.768611</span>, <span style=color:#ff9f43>110.3712855</span>, <span style=color:#5af78e>&#34;Indonesia&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Hospitaldel Torax&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>41.594067</span>, <span style=color:#ff9f43>2.007054</span>, <span style=color:#5af78e>&#34;Spain&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Check we have all the sites we need</span>
</span></span><span style=display:flex><span>save <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>False</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>for</span> s <span style=color:#ff6ac1>in</span> sites_fixed:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> s <span style=color:#ff6ac1>not</span> <span style=color:#ff6ac1>in</span> coords:
</span></span><span style=display:flex><span>        coords[s] <span style=color:#ff6ac1>=</span> get_lat_long_from_site(s)
</span></span><span style=display:flex><span>        save <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>True</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#78787e># If we&#39;ve updated, save it out</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> save:
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span> <span style=color:#ff5c57>open</span>(filename, <span style=color:#5af78e>&#34;w&#34;</span>) <span style=color:#ff6ac1>as</span> f:
</span></span><span style=display:flex><span>            json<span style=color:#ff6ac1>.</span>dump(coords, f)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>print</span>(<span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;We now have </span><span style=color:#5af78e>{</span><span style=color:#ff5c57>len</span>(coords<span style=color:#ff6ac1>.</span>keys())<span style=color:#5af78e>}</span><span style=color:#5af78e> sites ready to go!&#34;</span>)
</span></span></code></pre></div></div><pre><code>We now have 148 sites ready to go!
</code></pre><p>Great! Onto the next part&mldr;</p><h1 id=plotting-a-specific-datetime>Plotting a specific datetime</h1><p>Our dataframe is broken up into a lot of rows, where each row now represents a frame in the animation. Lets write a function to extract a row and put it into something easier to work with when plotting.</p><div class=width-69 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_row</span>(date):
</span></span><span style=display:flex><span>    row <span style=color:#ff6ac1>=</span> data_fixed<span style=color:#ff6ac1>.</span>loc[date]<span style=color:#ff6ac1>.</span>to_frame()<span style=color:#ff6ac1>.</span>reset_index()
</span></span><span style=display:flex><span>    change <span style=color:#ff6ac1>=</span> data_fixed_change<span style=color:#ff6ac1>.</span>loc[date]<span style=color:#ff6ac1>.</span>to_frame()<span style=color:#ff6ac1>.</span>reset_index()
</span></span><span style=display:flex><span>    row<span style=color:#ff6ac1>.</span>columns <span style=color:#ff6ac1>=</span> [<span style=color:#5af78e>&#34;site&#34;</span>, <span style=color:#5af78e>&#34;enrolment&#34;</span>]
</span></span><span style=display:flex><span>    change<span style=color:#ff6ac1>.</span>columns <span style=color:#ff6ac1>=</span> [<span style=color:#5af78e>&#34;site&#34;</span>, <span style=color:#5af78e>&#34;change&#34;</span>]
</span></span><span style=display:flex><span>    row <span style=color:#ff6ac1>=</span> row<span style=color:#ff6ac1>.</span>merge(change, on<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;site&#34;</span>)
</span></span><span style=display:flex><span>    row[<span style=color:#5af78e>&#34;date&#34;</span>] <span style=color:#ff6ac1>=</span> date
</span></span><span style=display:flex><span>    row[<span style=color:#5af78e>&#34;coord&#34;</span>] <span style=color:#ff6ac1>=</span> row[<span style=color:#5af78e>&#34;site&#34;</span>]<span style=color:#ff6ac1>.</span>map(coords)
</span></span><span style=display:flex><span>    row[<span style=color:#5af78e>&#34;lat&#34;</span>] <span style=color:#ff6ac1>=</span> row[<span style=color:#5af78e>&#34;coord&#34;</span>]<span style=color:#ff6ac1>.</span>str[<span style=color:#ff9f43>0</span>]
</span></span><span style=display:flex><span>    row[<span style=color:#5af78e>&#34;long&#34;</span>] <span style=color:#ff6ac1>=</span> row[<span style=color:#5af78e>&#34;coord&#34;</span>]<span style=color:#ff6ac1>.</span>str[<span style=color:#ff9f43>1</span>]
</span></span><span style=display:flex><span>    row[<span style=color:#5af78e>&#34;country&#34;</span>] <span style=color:#ff6ac1>=</span> row[<span style=color:#5af78e>&#34;coord&#34;</span>]<span style=color:#ff6ac1>.</span>str[<span style=color:#ff9f43>2</span>]
</span></span><span style=display:flex><span>    row <span style=color:#ff6ac1>=</span> row<span style=color:#ff6ac1>.</span>drop(columns<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;coord&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#78787e># Manually fix up the issues to separate HK and China</span>
</span></span><span style=display:flex><span>    hk <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>abs(row<span style=color:#ff6ac1>.</span>lat <span style=color:#ff6ac1>-</span> <span style=color:#ff9f43>22.3</span>) <span style=color:#ff6ac1>&lt;</span> <span style=color:#ff9f43>0.2</span>
</span></span><span style=display:flex><span>    row<span style=color:#ff6ac1>.</span>loc[hk, <span style=color:#5af78e>&#34;country&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;Hong Kong&#34;</span>
</span></span><span style=display:flex><span>    np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>seed(<span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    row<span style=color:#ff6ac1>.</span>loc[hk, <span style=color:#5af78e>&#34;lat&#34;</span>] <span style=color:#ff6ac1>+=</span> np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>normal(scale<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.5</span>, size<span style=color:#ff6ac1>=</span>hk<span style=color:#ff6ac1>.</span>sum())
</span></span><span style=display:flex><span>    row<span style=color:#ff6ac1>.</span>loc[hk, <span style=color:#5af78e>&#34;long&#34;</span>] <span style=color:#ff6ac1>+=</span> np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>normal(scale<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.5</span>, size<span style=color:#ff6ac1>=</span>hk<span style=color:#ff6ac1>.</span>sum())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> row
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test_row <span style=color:#ff6ac1>=</span> get_row(data_fixed<span style=color:#ff6ac1>.</span>index<span style=color:#ff6ac1>.</span>max())
</span></span><span style=display:flex><span>test_row
</span></span></code></pre></div></div><div><table class="table-auto table dataframe"><thead><tr style=text-align:right><th></th><th>site</th><th>enrolment</th><th>change</th><th>date</th><th>lat</th><th>long</th><th>country</th></tr></thead><tbody><tr><th>0</th><td>Medical University of Vienna</td><td>9.0</td><td>0.0</td><td>2020-09-28</td><td>48.208490</td><td>16.372080</td><td>Austria</td></tr><tr><th>1</th><td>Lancaster General Health</td><td>39.0</td><td>0.0</td><td>2020-09-28</td><td>54.016293</td><td>-2.793612</td><td>United Kingdom</td></tr><tr><th>2</th><td>Penn Medicine</td><td>42.0</td><td>0.0</td><td>2020-09-28</td><td>39.957043</td><td>-75.197520</td><td>United States of America</td></tr><tr><th>3</th><td>Oklahoma Heart Institute</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>36.029075</td><td>-95.869532</td><td>United States of America</td></tr><tr><th>4</th><td>UH Cleveland Hospital</td><td>26.0</td><td>0.0</td><td>2020-09-28</td><td>41.504861</td><td>-81.605748</td><td>United States of America</td></tr><tr><th>5</th><td>Ohio State University</td><td>121.0</td><td>0.0</td><td>2020-09-28</td><td>40.005709</td><td>-83.028663</td><td>United States of America</td></tr><tr><th>6</th><td>North Estonia Medical Centre, Tallin</td><td>20.0</td><td>0.0</td><td>2020-09-28</td><td>59.396168</td><td>24.698524</td><td>Estonia</td></tr><tr><th>7</th><td>Tartu University Hospital, Tartu</td><td>14.0</td><td>0.0</td><td>2020-09-28</td><td>58.369456</td><td>26.700090</td><td>Estonia</td></tr><tr><th>8</th><td>National Taiwan University Hospital</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>25.016828</td><td>121.538469</td><td>Taiwan</td></tr><tr><th>9</th><td>Hospital for Tropical Diseases, Vietnam</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>10.753047</td><td>106.678478</td><td>Vietnam</td></tr><tr><th>10</th><td>Keimyung University Dong San Hospital</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>11</th><td>Groote Schuur Hospital</td><td>207.0</td><td>0.0</td><td>2020-09-28</td><td>-33.941170</td><td>18.462639</td><td>South Africa</td></tr><tr><th>12</th><td>The Heart Hospital Baylor Plano</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>33.014781</td><td>-96.789958</td><td>United States of America</td></tr><tr><th>13</th><td>Baylor University Medical Centre</td><td>8.0</td><td>0.0</td><td>2020-09-28</td><td>32.786683</td><td>-96.781894</td><td>United States of America</td></tr><tr><th>14</th><td>Baylor Scott</td><td>3.0</td><td>0.0</td><td>2020-09-28</td><td>31.077858</td><td>-97.362730</td><td>United States of America</td></tr><tr><th>15</th><td>Hospital Nuestra Señora de Gracia Zaragoza</td><td>20.0</td><td>0.0</td><td>2020-09-28</td><td>32.502700</td><td>-117.003710</td><td>Mexico</td></tr><tr><th>16</th><td>São João Hospital Centre, Portugal</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>39.980168</td><td>-8.318848</td><td>Portugal</td></tr><tr><th>17</th><td>Piedmont Atlanta Hospital, USA</td><td>40.0</td><td>0.0</td><td>2020-09-28</td><td>33.789048</td><td>-84.371886</td><td>United States of America</td></tr><tr><th>18</th><td>Washington University in St. Louis, USA</td><td>20.0</td><td>0.0</td><td>2020-09-28</td><td>38.647240</td><td>-90.308402</td><td>United States of America</td></tr><tr><th>19</th><td>Medical College of Wisconsin, USA</td><td>31.0</td><td>0.0</td><td>2020-09-28</td><td>43.043867</td><td>-88.022453</td><td>United States of America</td></tr><tr><th>20</th><td>Policlinico di S. Orsola, Università di Bologn...</td><td>5.0</td><td>0.0</td><td>2020-09-28</td><td>44.496530</td><td>11.353080</td><td>Italy</td></tr><tr><th>21</th><td>Fundación Cardiovascular de Colombia, Colombia</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>-20.175830</td><td>-48.688890</td><td>Brazil</td></tr><tr><th>22</th><td>INOVA Fairfax Medical Center, USA</td><td>3.0</td><td>0.0</td><td>2020-09-28</td><td>41.620447</td><td>-86.228800</td><td>United States of America</td></tr><tr><th>23</th><td>Hospital de Clínicas, Argentina</td><td>7.0</td><td>0.0</td><td>2020-09-28</td><td>-34.599502</td><td>-58.400386</td><td>Argentina</td></tr><tr><th>24</th><td>Allegheny General Hospital</td><td>4.0</td><td>0.0</td><td>2020-09-28</td><td>40.456969</td><td>-80.003311</td><td>United States of America</td></tr><tr><th>25</th><td>Clinica Alemana De Santiago</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>-33.391999</td><td>-70.572619</td><td>Chile</td></tr><tr><th>26</th><td>Kyoto Medical Centre</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>-1.246694</td><td>116.862195</td><td>Indonesia</td></tr><tr><th>27</th><td>Hiroshima University</td><td>4.0</td><td>0.0</td><td>2020-09-28</td><td>34.401977</td><td>132.712320</td><td>Japan</td></tr><tr><th>28</th><td>Stanford University</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>37.431314</td><td>-122.169365</td><td>United States of America</td></tr><tr><th>29</th><td>Tufts Medical Centre</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>42.349559</td><td>-71.063411</td><td>United States of America</td></tr><tr><th>30</th><td>Carilion Clinic</td><td>13.0</td><td>0.0</td><td>2020-09-28</td><td>37.088584</td><td>-80.505764</td><td>United States of America</td></tr><tr><th>31</th><td>Beth Israel Deaconess Medical Center</td><td>11.0</td><td>0.0</td><td>2020-09-28</td><td>36.858403</td><td>-76.305431</td><td>United States of America</td></tr><tr><th>32</th><td>Clinica Las Condez, Chile</td><td>52.0</td><td>0.0</td><td>2020-09-28</td><td>-30.000000</td><td>-71.000000</td><td>Chile</td></tr><tr><th>33</th><td>Hyogo Prefectural Kakogawa Medical Center</td><td>16.0</td><td>0.0</td><td>2020-09-28</td><td>36.858403</td><td>-76.305431</td><td>United States of America</td></tr><tr><th>34</th><td>University of California San Francisco - Fresno</td><td>30.0</td><td>0.0</td><td>2020-09-28</td><td>36.747730</td><td>-119.772370</td><td>United States of America</td></tr><tr><th>35</th><td>Uniklinik (University Hospital Frankfurt)</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>50.093620</td><td>8.650671</td><td>Germany</td></tr><tr><th>36</th><td>Seoul National University Bundang Hospital</td><td>12.0</td><td>0.0</td><td>2020-09-28</td><td>37.349249</td><td>127.123941</td><td>South Korea</td></tr><tr><th>37</th><td>University of Iowa</td><td>12.0</td><td>0.0</td><td>2020-09-28</td><td>41.665850</td><td>-91.573107</td><td>United States of America</td></tr><tr><th>38</th><td>University of Cincinnati</td><td>9.0</td><td>0.0</td><td>2020-09-28</td><td>39.131853</td><td>-84.515762</td><td>United States of America</td></tr><tr><th>39</th><td>Rio Hortega University Hospital</td><td>12.0</td><td>0.0</td><td>2020-09-28</td><td>33.470630</td><td>-81.984130</td><td>United States of America</td></tr><tr><th>40</th><td>Hamad General Hospital</td><td>52.0</td><td>0.0</td><td>2020-09-28</td><td>25.293518</td><td>51.502231</td><td>Qatar</td></tr><tr><th>41</th><td>Presbyterian Hospital Services</td><td>51.0</td><td>0.0</td><td>2020-09-28</td><td>35.635979</td><td>-105.962692</td><td>United States of America</td></tr><tr><th>42</th><td>Clinica Valle de Lilli</td><td>46.0</td><td>0.0</td><td>2020-09-28</td><td>59.369440</td><td>25.359170</td><td>Estonia</td></tr><tr><th>43</th><td>University Hospital in Krakow</td><td>15.0</td><td>0.0</td><td>2020-09-28</td><td>50.061430</td><td>19.936580</td><td>Poland</td></tr><tr><th>44</th><td>The University of Utah</td><td>53.0</td><td>0.0</td><td>2020-09-28</td><td>40.762814</td><td>-111.836872</td><td>United States of America</td></tr><tr><th>45</th><td>Ospedale di Arco</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>45.915643</td><td>10.879765</td><td>Italy</td></tr><tr><th>46</th><td>Ospedale San Paolo</td><td>58.0</td><td>0.0</td><td>2020-09-28</td><td>41.117631</td><td>16.779988</td><td>Italy</td></tr><tr><th>47</th><td>Hospital Universitario Sant Joan d'Alacant</td><td>3.0</td><td>0.0</td><td>2020-09-28</td><td>38.401480</td><td>-0.436230</td><td>Spain</td></tr><tr><th>48</th><td>Kimitsu Chuo Hospital</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>35.327470</td><td>139.907261</td><td>Japan</td></tr><tr><th>49</th><td>Fatmawati Hospital</td><td>43.0</td><td>0.0</td><td>2020-09-28</td><td>-6.292454</td><td>106.792423</td><td>Indonesia</td></tr><tr><th>50</th><td>Rinku General Medical Center</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>34.411921</td><td>135.302686</td><td>Japan</td></tr><tr><th>51</th><td>Hospital Universitari Sagrat Cor</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>-31.413500</td><td>-64.181050</td><td>Argentina</td></tr><tr><th>52</th><td>Cleveland Clinic - Florida</td><td>3.0</td><td>0.0</td><td>2020-09-28</td><td>26.080382</td><td>-80.364079</td><td>United States of America</td></tr><tr><th>53</th><td>San Martino Hospital</td><td>4.0</td><td>0.0</td><td>2020-09-28</td><td>43.713059</td><td>10.404481</td><td>Italy</td></tr><tr><th>54</th><td>Hospital Alemán</td><td>6.0</td><td>0.0</td><td>2020-09-28</td><td>-34.591840</td><td>-58.401984</td><td>Argentina</td></tr><tr><th>55</th><td>San Pedro de Alcantara Hospital</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>36.486635</td><td>-4.990532</td><td>Spain</td></tr><tr><th>56</th><td>Legacy Emanuel Medical Center</td><td>11.0</td><td>0.0</td><td>2020-09-28</td><td>45.543893</td><td>-122.670033</td><td>United States of America</td></tr><tr><th>57</th><td>Kyoto Prefectural University of Medicine</td><td>20.0</td><td>0.0</td><td>2020-09-28</td><td>35.024341</td><td>135.768228</td><td>Japan</td></tr><tr><th>58</th><td>Lankenau Institute of Medical Research</td><td>36.0</td><td>0.0</td><td>2020-09-28</td><td>-37.700000</td><td>145.183330</td><td>Australia</td></tr><tr><th>59</th><td>Providence Saint John's Health Centre</td><td>8.0</td><td>0.0</td><td>2020-09-28</td><td>34.030577</td><td>-118.479544</td><td>United States of America</td></tr><tr><th>60</th><td>Fukuoka University</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>33.548443</td><td>130.364514</td><td>Japan</td></tr><tr><th>61</th><td>Mater Dei Hospital</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>35.901807</td><td>14.476600</td><td>Malta</td></tr><tr><th>62</th><td>Yokohama City University Medical Center</td><td>3.0</td><td>0.0</td><td>2020-09-28</td><td>32.240500</td><td>-110.945940</td><td>United States of America</td></tr><tr><th>63</th><td>Nagoya University Hospital</td><td>27.0</td><td>0.0</td><td>2020-09-28</td><td>35.153309</td><td>136.967781</td><td>Japan</td></tr><tr><th>64</th><td>PICU Saiful Anwar Hospital</td><td>21.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>65</th><td>Adult ICU Saiful Anwar Hospital</td><td>13.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>66</th><td>Kouritu Tousei Hospital</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>67</th><td>Hokkaido University Hospital</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>43.079008</td><td>141.337729</td><td>Japan</td></tr><tr><th>68</th><td>Chiba University Hospital</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>35.627869</td><td>140.103466</td><td>Japan</td></tr><tr><th>69</th><td>Universityof Alabamaat Birmingham Hospital</td><td>11.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>70</th><td>Universityof Florida</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>27.945565</td><td>-82.463843</td><td>United States of America</td></tr><tr><th>71</th><td>Saiseikai Senri Hospital</td><td>5.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>72</th><td>Rush University</td><td>26.0</td><td>0.0</td><td>2020-09-28</td><td>41.873644</td><td>-87.669498</td><td>United States of America</td></tr><tr><th>73</th><td>University of Chicago</td><td>14.0</td><td>0.0</td><td>2020-09-28</td><td>41.784977</td><td>-87.590524</td><td>United States of America</td></tr><tr><th>74</th><td>Johns Hopkins University</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>44.494770</td><td>11.355897</td><td>Italy</td></tr><tr><th>75</th><td>Hospitaldel Torax</td><td>5.0</td><td>0.0</td><td>2020-09-28</td><td>41.594067</td><td>2.007054</td><td>Spain</td></tr><tr><th>76</th><td>Persahabatan Hospital</td><td>92.0</td><td>0.0</td><td>2020-09-28</td><td>55.650621</td><td>37.501444</td><td>Russia</td></tr><tr><th>77</th><td>Universityof Oklahoma Health Sciences Center</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>7.250000</td><td>2.166670</td><td>Benin</td></tr><tr><th>78</th><td>The Christ Hospital</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>39.120839</td><td>-84.511113</td><td>United States of America</td></tr><tr><th>79</th><td>Hasan Sadikin Hospital ( Adult )</td><td>19.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>80</th><td>Kyung Pook National University Chilgok Hospital</td><td>8.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>81</th><td>Hospital Mount Sinai Medical Center</td><td>7.0</td><td>0.0</td><td>2020-09-28</td><td>25.813381</td><td>-80.140873</td><td>United States of America</td></tr><tr><th>82</th><td>Hospital Vergedela Cintade Tortosa</td><td>28.0</td><td>0.0</td><td>2020-09-28</td><td>40.812490</td><td>0.521600</td><td>Spain</td></tr><tr><th>83</th><td>Prof Dr R. D. Kandou Central Hospital - Paedia...</td><td>4.0</td><td>0.0</td><td>2020-09-28</td><td>1.453734</td><td>124.805662</td><td>Indonesia</td></tr><tr><th>84</th><td>Prof Dr R. D. Kandou Central Hospital - Adult</td><td>13.0</td><td>0.0</td><td>2020-09-28</td><td>1.450000</td><td>124.800000</td><td>Indonesia</td></tr><tr><th>85</th><td>Tokyo Metropolitan Tama Medical Center</td><td>3.0</td><td>0.0</td><td>2020-09-28</td><td>36.858403</td><td>-76.305431</td><td>United States of America</td></tr><tr><th>86</th><td>Universityof Maryland</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>38.992516</td><td>-76.991021</td><td>United States of America</td></tr><tr><th>87</th><td>Mar del Plata Medical Foundation Private Commu...</td><td>25.0</td><td>0.5</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>88</th><td>Dr Sardjito Government Hospital - Paediatric</td><td>3.0</td><td>0.0</td><td>2020-09-28</td><td>-7.768611</td><td>110.371285</td><td>Indonesia</td></tr><tr><th>89</th><td>London Health Sciences Centre</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>4.750000</td><td>11.833330</td><td>Cameroon</td></tr><tr><th>90</th><td>Hospital du Sacre Coeur</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>48.886806</td><td>2.343015</td><td>France</td></tr><tr><th>91</th><td>Mayo Clinic College of Medicine - Arizona</td><td>8.0</td><td>0.0</td><td>2020-09-28</td><td>32.973525</td><td>-111.515363</td><td>United States of America</td></tr><tr><th>92</th><td>Shizuoka Children's Hospital</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>93</th><td>Rochester General Hospital</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>43.192043</td><td>-77.588289</td><td>United States of America</td></tr><tr><th>94</th><td>Siriraj Hospital</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>13.757829</td><td>100.485379</td><td>Thailand</td></tr><tr><th>95</th><td>Obihiro-Kosei General Hospital</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>96</th><td>King Faisal Specialist Hospital and Research C...</td><td>22.0</td><td>0.0</td><td>2020-09-28</td><td>21.560019</td><td>39.148056</td><td>Saudi Arabia</td></tr><tr><th>97</th><td>University of Nebraska Medical Center</td><td>36.0</td><td>0.0</td><td>2020-09-28</td><td>41.256303</td><td>-95.977842</td><td>United States of America</td></tr><tr><th>98</th><td>Foothills Hospital</td><td>71.0</td><td>0.0</td><td>2020-09-28</td><td>40.016004</td><td>-105.236631</td><td>United States of America</td></tr><tr><th>99</th><td>Queen Mary Hospital the University of Hong Kong</td><td>14.0</td><td>0.0</td><td>2020-09-28</td><td>23.093693</td><td>114.571774</td><td>Hong Kong</td></tr><tr><th>100</th><td>Galway University Hospital</td><td>67.0</td><td>0.0</td><td>2020-09-28</td><td>53.277087</td><td>-9.066559</td><td>Ireland</td></tr><tr><th>101</th><td>Teine Keijinkai Hospital</td><td>16.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>102</th><td>Fondazione IRCCS Ca</td><td>75.0</td><td>0.0</td><td>2020-09-28</td><td>37.250220</td><td>-119.751260</td><td>United States of America</td></tr><tr><th>103</th><td>Fondazione Policlinico Universitario Agostino ...</td><td>12.0</td><td>0.0</td><td>2020-09-28</td><td>41.891930</td><td>12.511330</td><td>Italy</td></tr><tr><th>104</th><td>Ospedale Molinette Torino</td><td>20.0</td><td>0.0</td><td>2020-09-28</td><td>45.039464</td><td>7.674405</td><td>Italy</td></tr><tr><th>105</th><td>Oregon Health and Science University Hospital</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>45.499038</td><td>-122.685695</td><td>United States of America</td></tr><tr><th>106</th><td>Hospital Clinic, Barcelona</td><td>58.0</td><td>0.0</td><td>2020-09-28</td><td>41.388062</td><td>2.150639</td><td>Spain</td></tr><tr><th>107</th><td>Columbia University</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>40.807949</td><td>-73.961797</td><td>United States of America</td></tr><tr><th>108</th><td>Klinik für Innere Medizin II</td><td>55.0</td><td>0.0</td><td>2020-09-28</td><td>54.089022</td><td>12.109247</td><td>Germany</td></tr><tr><th>109</th><td>Hospital Vall D Hebron</td><td>22.0</td><td>0.0</td><td>2020-09-28</td><td>48.600046</td><td>1.675945</td><td>France</td></tr><tr><th>110</th><td>Pamela Youde Nethersole Eastern Hospital</td><td>5.0</td><td>0.0</td><td>2020-09-28</td><td>21.964346</td><td>113.086001</td><td>Hong Kong</td></tr><tr><th>111</th><td>Maastricht University Medical Centre</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>50.857985</td><td>5.696988</td><td>The Netherlands</td></tr><tr><th>112</th><td>Sozialmedizinisches Zentrum S</td><td>7.0</td><td>0.0</td><td>2020-09-28</td><td>48.173496</td><td>16.350574</td><td>Austria</td></tr><tr><th>113</th><td>Saiseikai Utsunomiya Hospital</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>114</th><td>Chonnam National University Hospital</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>35.176906</td><td>126.906909</td><td>South Korea</td></tr><tr><th>115</th><td>Ospedale San Gerardo</td><td>55.0</td><td>0.0</td><td>2020-09-28</td><td>45.602154</td><td>9.260360</td><td>Italy</td></tr><tr><th>116</th><td>Policlinico of Padova, Padova</td><td>13.0</td><td>0.0</td><td>2020-09-28</td><td>45.349274</td><td>11.786716</td><td>Italy</td></tr><tr><th>117</th><td>Barmherzige Brüder Regensburg</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>49.052150</td><td>12.079680</td><td>Germany</td></tr><tr><th>118</th><td>Civil Hospital Marie Curie, Brussels</td><td>44.0</td><td>0.0</td><td>2020-09-28</td><td>50.850450</td><td>4.348780</td><td>Belgium</td></tr><tr><th>119</th><td>St. Marianna University School of Medicine</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>35.600212</td><td>139.548866</td><td>Japan</td></tr><tr><th>120</th><td>ISMETT</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>38.108440</td><td>13.361333</td><td>Italy</td></tr><tr><th>121</th><td>Mater Misericordiae University Hospital, Ireland</td><td>31.0</td><td>0.0</td><td>2020-09-28</td><td>53.359704</td><td>-6.267077</td><td>Ireland</td></tr><tr><th>122</th><td>Harapan Kita National Heart Centre Hospital (P...</td><td>10.0</td><td>0.0</td><td>2020-09-28</td><td>52.473060</td><td>-8.430560</td><td>Ireland</td></tr><tr><th>123</th><td>Princess Margaret Hospital, Hong Kong</td><td>6.0</td><td>0.0</td><td>2020-09-28</td><td>22.077152</td><td>115.006972</td><td>Hong Kong</td></tr><tr><th>124</th><td>Queen Elizabeth Hospital, Hong Kong</td><td>7.0</td><td>0.0</td><td>2020-09-28</td><td>21.772608</td><td>113.794131</td><td>Hong Kong</td></tr><tr><th>125</th><td>Klinikum Passau</td><td>2.0</td><td>0.0</td><td>2020-09-28</td><td>48.565036</td><td>13.445336</td><td>Germany</td></tr><tr><th>126</th><td>Hartford HealthCare</td><td>31.0</td><td>0.0</td><td>2020-09-28</td><td>41.681286</td><td>-71.912487</td><td>United States of America</td></tr><tr><th>127</th><td>Hospitales Puerta de Hierro, Mexico</td><td>4.0</td><td>0.0</td><td>2020-09-28</td><td>23.000000</td><td>-102.000000</td><td>Mexico</td></tr><tr><th>128</th><td>Kuwait ECLS program, Al-Amiri & Jaber Al-Ahmed...</td><td>17.0</td><td>0.0</td><td>2020-09-28</td><td>29.387697</td><td>47.988127</td><td>Kuwait</td></tr><tr><th>129</th><td>Hospital Universitario Virgen de Valme</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>37.318825</td><td>-5.971218</td><td>Spain</td></tr><tr><th>130</th><td>Severance Hospital, Seoul</td><td>1.0</td><td>0.0</td><td>2020-09-28</td><td>37.562258</td><td>126.940570</td><td>South Korea</td></tr><tr><th>131</th><td>Al-Adan Hospital</td><td>8.0</td><td>0.0</td><td>2020-09-28</td><td>5.258065</td><td>96.007263</td><td>Indonesia</td></tr><tr><th>132</th><td>Medizinische Klinik und Poliklinik II, Munich</td><td>21.0</td><td>0.0</td><td>2020-09-28</td><td>48.137430</td><td>11.575490</td><td>Germany</td></tr><tr><th>133</th><td>Barwon Health, VIC</td><td>0.0</td><td>0.0</td><td>2020-09-28</td><td>-38.152080</td><td>144.365610</td><td>Australia</td></tr><tr><th>134</th><td>Box Hill Hospital, VIC</td><td>0.0</td><td>0.0</td><td>2020-09-28</td><td>-37.813614</td><td>145.118405</td><td>Australia</td></tr><tr><th>135</th><td>Gold Coast Hospital, QLD</td><td>0.0</td><td>0.0</td><td>2020-09-28</td><td>-28.002373</td><td>153.414599</td><td>Australia</td></tr><tr><th>136</th><td>Launceston Hospital, TAS</td><td>0.0</td><td>0.0</td><td>2020-09-28</td><td>-41.434081</td><td>147.137350</td><td>Australia</td></tr><tr><th>137</th><td>Royal Adelaide Hospital, SA</td><td>0.0</td><td>0.0</td><td>2020-09-28</td><td>-34.920724</td><td>138.586599</td><td>Australia</td></tr><tr><th>138</th><td>Royal Children's Hospital, VIC</td><td>0.0</td><td>0.0</td><td>2020-09-28</td><td>-37.793427</td><td>144.949575</td><td>Australia</td></tr><tr><th>139</th><td>Royal North Shore Hospital, NSW</td><td>0.0</td><td>0.0</td><td>2020-09-28</td><td>-33.821411</td><td>151.191138</td><td>Australia</td></tr><tr><th>140</th><td>Royal Prince Alfred Hospital, NSW</td><td>0.0</td><td>0.0</td><td>2020-09-28</td><td>-33.889744</td><td>151.181500</td><td>Australia</td></tr><tr><th>141</th><td>St George Hospital, NSW</td><td>0.0</td><td>0.0</td><td>2020-09-28</td><td>-33.967165</td><td>151.134025</td><td>Australia</td></tr><tr><th>142</th><td>St Vincent's Hospital Sydney, NSW</td><td>0.0</td><td>0.0</td><td>2020-09-28</td><td>-33.880568</td><td>151.220564</td><td>Australia</td></tr><tr><th>143</th><td>The Alfred Hospital, VIC</td><td>0.0</td><td>0.0</td><td>2020-09-28</td><td>-37.846075</td><td>144.982554</td><td>Australia</td></tr><tr><th>144</th><td>Westmead Hospital, NSW</td><td>0.0</td><td>0.0</td><td>2020-09-28</td><td>-33.802939</td><td>150.987761</td><td>Australia</td></tr></tbody></table></div><h1 id=basemap-time>Basemap time</h1><p>This is the hard part now. Not coding wise, but installing basemap can be a real pain. So I&rsquo;m going to skip over it. We start by defining a nice dark base figure:</p><div class=width-68 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>from</span> mpl_toolkits.basemap <span style=color:#ff6ac1>import</span> Basemap
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> matplotlib.pyplot <span style=color:#ff6ac1>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_base_fig</span>():
</span></span><span style=display:flex><span>    <span style=color:#78787e># Lets define some colors</span>
</span></span><span style=display:flex><span>    bg_color <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#000000&#34;</span>
</span></span><span style=display:flex><span>    coast_color <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#333333&#34;</span>
</span></span><span style=display:flex><span>    country_color <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#222222&#34;</span>
</span></span><span style=display:flex><span>    fig <span style=color:#ff6ac1>=</span> plt<span style=color:#ff6ac1>.</span>figure(figsize<span style=color:#ff6ac1>=</span>(<span style=color:#ff9f43>12</span>, <span style=color:#ff9f43>6</span>))
</span></span><span style=display:flex><span>    m <span style=color:#ff6ac1>=</span> Basemap(projection<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#39;cyl&#39;</span>, llcrnrlat<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>70</span>,urcrnrlat<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>90</span>, 
</span></span><span style=display:flex><span>                llcrnrlon<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>170</span>, urcrnrlon<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>190</span>, area_thresh<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10000.</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>fillcontinents(color<span style=color:#ff6ac1>=</span>bg_color, lake_color<span style=color:#ff6ac1>=</span>bg_color, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>2</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>drawcoastlines(color<span style=color:#ff6ac1>=</span>coast_color, linewidth<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.7</span>, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>drawcountries(color<span style=color:#ff6ac1>=</span>country_color, linewidth<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.7</span>, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>drawmapboundary(fill_color<span style=color:#ff6ac1>=</span>bg_color, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> fig, m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_base_fig();
</span></span></code></pre></div></div><p><div><figure class=rounded><picture><source srcset=/tutorials/cccc_institutions/2020-07-31-CCCC_Institutions_files/2020-07-31-CCCC_Institutions_23_1_hu2cbeb5af2f308083562ca9894a13abbb_330430_1920x0_resize_q90_h2_box_3.webp width=1920 height=881 type=image/webp><source srcset=/tutorials/cccc_institutions/2020-07-31-CCCC_Institutions_files/2020-07-31-CCCC_Institutions_23_1.png width=2291 height=1051 type=image/png><img width=2291 height=1051 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><h2 id=add-each-site>Add each site</h2><p>Instead of randomly assigning colours, I&rsquo;ve tried to make the colour for each country somewhat related to the country itself. Normally via primary flag colour, although the fact most flags only use a very small subset of colours is quite difficult to work with.</p><p>Let&rsquo;s just get a snapshot for the final day in our dataset.</p><div class=width-78 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Colours based roughly on primary colour in countries flag</span>
</span></span><span style=display:flex><span>colors <span style=color:#ff6ac1>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Australia&#34;</span>: <span style=color:#5af78e>&#34;#FFD54F&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;United States of America&#34;</span>: <span style=color:#5af78e>&#34;#1e88e5&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;United Kingdom&#34;</span>: <span style=color:#5af78e>&#34;#4FC3F7&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Estonia&#34;</span>: <span style=color:#5af78e>&#34;#1E88E5&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Taiwan&#34;</span>: <span style=color:#5af78e>&#34;#E53935&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Vietnam&#34;</span>: <span style=color:#5af78e>&#34;#C62828&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Ireland&#34;</span>: <span style=color:#5af78e>&#34;#FFA726&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Brazil&#34;</span>: <span style=color:#5af78e>&#34;#4CAF50&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Argentina&#34;</span>: <span style=color:#5af78e>&#34;#4FC3F7&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Chile&#34;</span>: <span style=color:#5af78e>&#34;#F44336&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Indonesia&#34;</span>: <span style=color:#5af78e>&#34;#FF8A80&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Japan&#34;</span>: <span style=color:#5af78e>&#34;#C62828&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Germany&#34;</span>: <span style=color:#5af78e>&#34;#E040FB&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;South Korea&#34;</span>: <span style=color:#5af78e>&#34;#BBDEFB&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Qatar&#34;</span>: <span style=color:#5af78e>&#34;#AD1457&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Poland&#34;</span>: <span style=color:#5af78e>&#34;#E53935&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Spain&#34;</span>: <span style=color:#5af78e>&#34;#FFB300&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Australia&#34;</span>: <span style=color:#5af78e>&#34;#FFCA28&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Russia&#34;</span>: <span style=color:#5af78e>&#34;#3F51B5&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Benin&#34;</span>: <span style=color:#5af78e>&#34;#558B2F&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Saudi Arabia&#34;</span>: <span style=color:#5af78e>&#34;#1B5E20&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Hong Kong&#34;</span>: <span style=color:#5af78e>&#34;#D84315&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;France&#34;</span>: <span style=color:#5af78e>&#34;#01579B&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;The Netherlands&#34;</span>: <span style=color:#5af78e>&#34;#B71C1C&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Belgium&#34;</span>: <span style=color:#5af78e>&#34;#FDD835&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Kuwait&#34;</span>: <span style=color:#5af78e>&#34;#4CAF50&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Yemen&#34;</span>: <span style=color:#5af78e>&#34;#D81B60&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Italy&#34;</span>: <span style=color:#5af78e>&#34;#8BC34A&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Austria&#34;</span>: <span style=color:#5af78e>&#34;#C62828&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Mexico&#34;</span>: <span style=color:#5af78e>&#34;#4CAF50&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Portugal&#34;</span>: <span style=color:#5af78e>&#34;#F44336&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;South Africa&#34;</span>: <span style=color:#5af78e>&#34;#8BC34A&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Cameroon&#34;</span>: <span style=color:#5af78e>&#34;#2bab7a&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Malta&#34;</span>: <span style=color:#5af78e>&#34;#ed2f3c&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Thailand&#34;</span>: <span style=color:#5af78e>&#34;#458eed&#34;</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_scatter</span>(data):
</span></span><span style=display:flex><span>    fig, m <span style=color:#ff6ac1>=</span> get_base_fig()
</span></span><span style=display:flex><span>    <span style=color:#78787e># Loop over each country and its institutions</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>for</span> country <span style=color:#ff6ac1>in</span> np<span style=color:#ff6ac1>.</span>unique(data<span style=color:#ff6ac1>.</span>country):
</span></span><span style=display:flex><span>        c <span style=color:#ff6ac1>=</span> colors<span style=color:#ff6ac1>.</span>get(country, <span style=color:#5af78e>&#34;#FF99FF&#34;</span>)
</span></span><span style=display:flex><span>        subset <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>loc[(data<span style=color:#ff6ac1>.</span>country <span style=color:#ff6ac1>==</span> country) <span style=color:#ff6ac1>&amp;</span> (data<span style=color:#ff6ac1>.</span>enrolment <span style=color:#ff6ac1>&gt;</span> <span style=color:#ff9f43>0</span>), :]
</span></span><span style=display:flex><span>        s <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>10</span> <span style=color:#ff6ac1>+</span> subset<span style=color:#ff6ac1>.</span>enrolment
</span></span><span style=display:flex><span>        m<span style=color:#ff6ac1>.</span>scatter(subset<span style=color:#ff6ac1>.</span>long, subset<span style=color:#ff6ac1>.</span>lat, latlon<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, c<span style=color:#ff6ac1>=</span>c, s<span style=color:#ff6ac1>=</span>s, zorder<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_scatter(test_row);
</span></span></code></pre></div></div><p><div><figure class=rounded><picture><source srcset=/tutorials/cccc_institutions/2020-07-31-CCCC_Institutions_files/2020-07-31-CCCC_Institutions_25_1_hu9fc7acbab3afb686684bfe50fc05ad36_349696_1920x0_resize_q90_h2_box_3.webp width=1920 height=881 type=image/webp><source srcset=/tutorials/cccc_institutions/2020-07-31-CCCC_Institutions_files/2020-07-31-CCCC_Institutions_25_1.png width=2291 height=1051 type=image/png><img width=2291 height=1051 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>I mean&mldr; it&rsquo;s nice. But <em>cool</em> graphics glow and have changing colours. So I&rsquo;ll define a colormap that allows me to brighten the colour of each site when new patients come in, so that they flicker, glow and grow as they add patients into the system.</p><div class="expanded-code width-116" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>from</span> matplotlib.colors <span style=color:#ff6ac1>import</span> LinearSegmentedColormap <span style=color:#ff6ac1>as</span> LSC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_shaded</span>(data, date, frame<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>, show<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>False</span>):
</span></span><span style=display:flex><span>    fig, m <span style=color:#ff6ac1>=</span> get_base_fig()
</span></span><span style=display:flex><span>    <span style=color:#78787e># Loop over each country and its institutions</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    max_v <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>change<span style=color:#ff6ac1>.</span>max() <span style=color:#ff6ac1>+</span> <span style=color:#ff9f43>1</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>for</span> country <span style=color:#ff6ac1>in</span> np<span style=color:#ff6ac1>.</span>unique(data<span style=color:#ff6ac1>.</span>country):
</span></span><span style=display:flex><span>        c <span style=color:#ff6ac1>=</span> colors<span style=color:#ff6ac1>.</span>get(country)
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>if</span> c <span style=color:#ff6ac1>is</span> <span style=color:#ff6ac1>None</span>:
</span></span><span style=display:flex><span>            c <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#FF99FF&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff5c57>print</span>(<span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Cannot find colour for country </span><span style=color:#5af78e>{</span>country<span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#78787e># From base colour, increase intensity of patients added today</span>
</span></span><span style=display:flex><span>        cmap <span style=color:#ff6ac1>=</span> LSC<span style=color:#ff6ac1>.</span>from_list(<span style=color:#5af78e>&#34;fade&#34;</span>, [c, <span style=color:#5af78e>&#34;#FFFFFF&#34;</span>], N<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>100</span>)
</span></span><span style=display:flex><span>        subset <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>loc[(data<span style=color:#ff6ac1>.</span>country <span style=color:#ff6ac1>==</span> country) <span style=color:#ff6ac1>&amp;</span> (data<span style=color:#ff6ac1>.</span>enrolment <span style=color:#ff6ac1>&gt;</span> <span style=color:#ff9f43>0</span>), :]
</span></span><span style=display:flex><span>        s <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>10</span> <span style=color:#ff6ac1>+</span> subset<span style=color:#ff6ac1>.</span>enrolment
</span></span><span style=display:flex><span>        cs <span style=color:#ff6ac1>=</span> cmap(<span style=color:#ff9f43>2</span> <span style=color:#ff6ac1>*</span> subset<span style=color:#ff6ac1>.</span>change <span style=color:#ff6ac1>/</span> max_v)
</span></span><span style=display:flex><span>        m<span style=color:#ff6ac1>.</span>scatter(subset<span style=color:#ff6ac1>.</span>long, subset<span style=color:#ff6ac1>.</span>lat, latlon<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, c<span style=color:#ff6ac1>=</span>cs, s<span style=color:#ff6ac1>=</span>s, zorder<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#78787e># Set the title, and make the background black</span>
</span></span><span style=display:flex><span>    plt<span style=color:#ff6ac1>.</span>title(<span style=color:#5af78e>&#34;CCCC Patient Contributions&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>16</span>, 
</span></span><span style=display:flex><span>              color<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;#EEEEEE&#34;</span>, fontname<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Open Sans&#34;</span>, y<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1.03</span>)
</span></span><span style=display:flex><span>    d <span style=color:#ff6ac1>=</span> pd<span style=color:#ff6ac1>.</span>to_datetime(date)<span style=color:#ff6ac1>.</span>strftime(<span style=color:#5af78e>&#34;</span><span style=color:#5af78e>%d</span><span style=color:#5af78e> - %B&#34;</span>)
</span></span><span style=display:flex><span>    ax <span style=color:#ff6ac1>=</span> fig<span style=color:#ff6ac1>.</span>get_axes()[<span style=color:#ff9f43>0</span>]
</span></span><span style=display:flex><span>    plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff9f43>0.5</span>, <span style=color:#ff9f43>1.02</span>, d, c<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;#AAAAAA&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>14</span>, 
</span></span><span style=display:flex><span>             verticalalignment<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;top&#34;</span>, horizontalalignment<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;center&#34;</span>,
</span></span><span style=display:flex><span>             transform<span style=color:#ff6ac1>=</span>ax<span style=color:#ff6ac1>.</span>transAxes)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fig<span style=color:#ff6ac1>.</span>patch<span style=color:#ff6ac1>.</span>set_facecolor(<span style=color:#5af78e>&#34;#000000&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> show:
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> fig
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>        name <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;cccc_enrolment/output/</span><span style=color:#5af78e>{</span>frame<span style=color:#5af78e>:</span><span style=color:#5af78e>04d</span><span style=color:#5af78e>}</span><span style=color:#5af78e>.png&#34;</span>
</span></span><span style=display:flex><span>        fig<span style=color:#ff6ac1>.</span>savefig(name, bbox_inches<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;tight&#34;</span>, padding<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>, facecolor<span style=color:#ff6ac1>=</span>fig<span style=color:#ff6ac1>.</span>get_facecolor(), transparent<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>False</span>, dpi<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>300</span>)
</span></span><span style=display:flex><span>        plt<span style=color:#ff6ac1>.</span>close(fig)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_shaded(test_row, <span style=color:#5af78e>&#34;2020-03-23&#34;</span>, show<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>);
</span></span></code></pre></div></div><p><div><figure class="img-main rounded"><picture><source srcset=/tutorials/cccc_institutions/cover_hu5c95fa185b27c1fd08ca76f55bd9e75b_372537_1920x0_resize_q90_h2_box_3.webp width=1920 height=956 type=image/webp><source srcset=/tutorials/cccc_institutions/cover.png width=2291 height=1141 type=image/png><img width=2291 height=1141 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Now let&rsquo;s test this whole thing animated, so lets loop over every row and output a frame that I&rsquo;ll stitch together using <code>ffmpeg</code>. Normally I&rsquo;d use <code>joblib</code> for this&mldr; but <code>basemap</code> really doesn&rsquo;t like that.</p><div class="reduced-code width-43" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>plot_date</span>(i, date):
</span></span><span style=display:flex><span>    data <span style=color:#ff6ac1>=</span> get_row(date)
</span></span><span style=display:flex><span>    get_shaded(data, date, i)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#ff6ac1>for</span> i, date <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>enumerate</span>(data_fixed<span style=color:#ff6ac1>.</span>index):
</span></span><span style=display:flex><span>    plot_date(i, date)
</span></span></code></pre></div></div><p>Now that we have a bunch of frames, lets turn it into a ncie MP4 video. But lets be fancy, and have this bad boy glow. To do this, Im going to load in a mask (to make sure the title doesnt glow), and run it through a filter complex that took me 4 hours to debug until it worked. It will also add a few seconds of pause at the end, so on looping players people can still see the final result.</p><div class="expanded-code width-116" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>ffmpeg -r 30 -i cccc_enrolment/output/%04d.png -i cccc_enrolment/mask.png -filter_complex &#34;      [1]setsar=sar=0[p],
</span></span><span style=display:flex><span>[0]split[a][b],
</span></span><span style=display:flex><span>[a][p]overlay,lumakey=0:tolerance=0.3:softness=0.3[x];
</span></span><span style=display:flex><span>color=black,format=rgb24[c];
</span></span><span style=display:flex><span>[c][x]scale2ref[c][i];
</span></span><span style=display:flex><span>[c][i]overlay=format=auto:shortest=1,
</span></span><span style=display:flex><span>setsar=sar=1,
</span></span><span style=display:flex><span>gblur=30:3,
</span></span><span style=display:flex><span>curves=all=&#39;0/0 0.5/0.9 1/0.9&#39;[d],
</span></span><span style=display:flex><span>[b]setsar=sar=1[e],
</span></span><span style=display:flex><span>[d][e]blend=all_mode=addition,
</span></span><span style=display:flex><span>scale=1920:-2,
</span></span><span style=display:flex><span>tpad=stop_mode=clone:stop_duration=4
</span></span><span style=display:flex><span>&#34; -vcodec libx264 -crf 23 -movflags faststart -pix_fmt yuv420p cccc_enrolment/contributions.mp4
</span></span></code></pre></div></div><p></p><p>And there it is! Perhaps soon I&rsquo;ll go through and manually add all the site names in, but for now, I feel this does a pretty good job of showing just how international our collaboration is.</p><hr><p>For your convenience, here&rsquo;s the code in one block:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> pandas <span style=color:#ff6ac1>as</span> pd
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span>data <span style=color:#ff6ac1>=</span> pd<span style=color:#ff6ac1>.</span>read_csv(<span style=color:#5af78e>&#34;cccc_enrolment/enrolment_site.csv&#34;</span>, parse_dates<span style=color:#ff6ac1>=</span>[<span style=color:#ff9f43>0</span>], index_col<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>)
</span></span><span style=display:flex><span>data <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>fillna(<span style=color:#ff9f43>0</span>)<span style=color:#ff6ac1>.</span>astype(<span style=color:#ff5c57>int</span>)
</span></span><span style=display:flex><span>data<span style=color:#ff6ac1>.</span>iloc[<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>5</span>:, :<span style=color:#ff9f43>5</span>]
</span></span><span style=display:flex><span>sites <span style=color:#ff6ac1>=</span> [c<span style=color:#ff6ac1>.</span>split(<span style=color:#5af78e>&#34;-&#34;</span>, <span style=color:#ff9f43>1</span>)[<span style=color:#ff9f43>1</span>] <span style=color:#ff6ac1>if</span> <span style=color:#5af78e>&#34;-&#34;</span> <span style=color:#ff6ac1>in</span> c <span style=color:#ff6ac1>else</span> c <span style=color:#ff6ac1>for</span> c <span style=color:#ff6ac1>in</span> data<span style=color:#ff6ac1>.</span>columns]
</span></span><span style=display:flex><span><span style=color:#ff5c57>print</span>(sites[<span style=color:#ff9f43>60</span>:<span style=color:#ff9f43>70</span>])
</span></span><span style=display:flex><span><span style=color:#78787e># Some of the sites are missing spaces for some reason</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>fix_site</span>(site):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> <span style=color:#5af78e>&#34; &#34;</span> <span style=color:#ff6ac1>not</span> <span style=color:#ff6ac1>in</span> site:
</span></span><span style=display:flex><span>        <span style=color:#78787e># Dont fix a sitename which is an acryonym</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>if</span> site <span style=color:#ff6ac1>!=</span> site<span style=color:#ff6ac1>.</span>upper():
</span></span><span style=display:flex><span>            site <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#39;&#39;</span><span style=color:#ff6ac1>.</span>join(<span style=color:#ff5c57>map</span>(<span style=color:#ff6ac1>lambda</span> x: x <span style=color:#ff6ac1>if</span> x<span style=color:#ff6ac1>.</span>islower() <span style=color:#ff6ac1>else</span> <span style=color:#5af78e>&#34; &#34;</span> <span style=color:#ff6ac1>+</span> x, site))   
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> site<span style=color:#ff6ac1>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sites_fixed <span style=color:#ff6ac1>=</span> [fix_site(s) <span style=color:#ff6ac1>for</span> s <span style=color:#ff6ac1>in</span> sites]
</span></span><span style=display:flex><span><span style=color:#ff5c57>print</span>(sites_fixed[<span style=color:#ff9f43>60</span>:<span style=color:#ff9f43>70</span>])
</span></span><span style=display:flex><span>data_fixed <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>copy()
</span></span><span style=display:flex><span>data_fixed<span style=color:#ff6ac1>.</span>columns <span style=color:#ff6ac1>=</span> sites_fixed
</span></span><span style=display:flex><span>data_fixed<span style=color:#ff6ac1>.</span>iloc[<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>5</span>:, :<span style=color:#ff9f43>5</span>]
</span></span><span style=display:flex><span><span style=color:#78787e># Interpolation</span>
</span></span><span style=display:flex><span>fr <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>30</span>  <span style=color:#78787e># frame rate</span>
</span></span><span style=display:flex><span>t <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>12</span>  <span style=color:#78787e># seconds</span>
</span></span><span style=display:flex><span>new_index <span style=color:#ff6ac1>=</span> pd<span style=color:#ff6ac1>.</span>date_range(<span style=color:#5af78e>&#34;2020-02-01&#34;</span>, data_fixed<span style=color:#ff6ac1>.</span>index<span style=color:#ff6ac1>.</span>max(), fr <span style=color:#ff6ac1>*</span> t)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Combine index, interp, remove original index</span>
</span></span><span style=display:flex><span>data_fixed <span style=color:#ff6ac1>=</span> data_fixed<span style=color:#ff6ac1>.</span>reindex(new_index <span style=color:#ff6ac1>|</span> data_fixed<span style=color:#ff6ac1>.</span>index)<span style=color:#ff6ac1>.</span>interpolate()<span style=color:#ff6ac1>.</span>loc[new_index]
</span></span><span style=display:flex><span>data_fixed_change <span style=color:#ff6ac1>=</span> data_fixed<span style=color:#ff6ac1>.</span>diff()<span style=color:#ff6ac1>.</span>fillna(<span style=color:#ff9f43>0</span>)
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> opencage.geocoder <span style=color:#ff6ac1>import</span> OpenCageGeocode
</span></span><span style=display:flex><span>key <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;&#34;</span> <span style=color:#78787e># The trial version allows you do this all for free</span>
</span></span><span style=display:flex><span>geocoder <span style=color:#ff6ac1>=</span> OpenCageGeocode(key)
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_lat_long_from_site</span>(query):
</span></span><span style=display:flex><span>    results <span style=color:#ff6ac1>=</span> geocoder<span style=color:#ff6ac1>.</span>geocode(query)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> <span style=color:#ff6ac1>not</span> <span style=color:#ff5c57>len</span>(results):
</span></span><span style=display:flex><span>        <span style=color:#ff5c57>print</span>(<span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;</span><span style=color:#5af78e>{</span>query<span style=color:#5af78e>}</span><span style=color:#5af78e> unable to be located&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> <span style=color:#ff6ac1>None</span>
</span></span><span style=display:flex><span>    lat <span style=color:#ff6ac1>=</span> results[<span style=color:#ff9f43>0</span>][<span style=color:#5af78e>&#39;geometry&#39;</span>][<span style=color:#5af78e>&#39;lat&#39;</span>]
</span></span><span style=display:flex><span>    long <span style=color:#ff6ac1>=</span> results[<span style=color:#ff9f43>0</span>][<span style=color:#5af78e>&#39;geometry&#39;</span>][<span style=color:#5af78e>&#39;lng&#39;</span>]
</span></span><span style=display:flex><span>    country <span style=color:#ff6ac1>=</span> results[<span style=color:#ff9f43>0</span>][<span style=color:#5af78e>&#34;components&#34;</span>][<span style=color:#5af78e>&#34;country&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> (lat, long, country)
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> os
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>filename <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;cccc_enrolment/site_locations.json&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Check if file exists</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>if</span> os<span style=color:#ff6ac1>.</span>path<span style=color:#ff6ac1>.</span>exists(filename):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>with</span> <span style=color:#ff5c57>open</span>(filename) <span style=color:#ff6ac1>as</span> f:
</span></span><span style=display:flex><span>        coords <span style=color:#ff6ac1>=</span> json<span style=color:#ff6ac1>.</span>load(f)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Add manual ones that I know wont be found</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Uniklinik (University Hospital Frankfurt)&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>50.0936204</span>, <span style=color:#ff9f43>8.6506709</span>, <span style=color:#5af78e>&#34;Germany&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Prof Dr R. D. Kandou Central Hospital - Paediatric&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1.453734</span>, <span style=color:#ff9f43>124.8056623</span>, <span style=color:#5af78e>&#34;Indonesia&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Prof Dr R. D. Kandou Central Hospital - Adult&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1.45</span>, <span style=color:#ff9f43>124.80</span>, <span style=color:#5af78e>&#34;Indonesia&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Kyoto Prefectural University of Medicine&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>35.0243414</span>, <span style=color:#ff9f43>135.7682285</span>, <span style=color:#5af78e>&#34;Japan&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;ISMETT&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>38.1084401</span>, <span style=color:#ff9f43>13.3613329</span>, <span style=color:#5af78e>&#34;Italy&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Kuwait ECLS program, Al-Amiri &amp; Jaber Al-Ahmed Hospitals&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>29.3876968</span>, <span style=color:#ff9f43>47.9881274</span>, <span style=color:#5af78e>&#34;Kuwait&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Dr Sardjito Government Hospital - Paediatric&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>-</span><span style=color:#ff9f43>7.768611</span>, <span style=color:#ff9f43>110.3712855</span>, <span style=color:#5af78e>&#34;Indonesia&#34;</span>
</span></span><span style=display:flex><span>coords[<span style=color:#5af78e>&#34;Hospitaldel Torax&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>41.594067</span>, <span style=color:#ff9f43>2.007054</span>, <span style=color:#5af78e>&#34;Spain&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Check we have all the sites we need</span>
</span></span><span style=display:flex><span>save <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>False</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>for</span> s <span style=color:#ff6ac1>in</span> sites_fixed:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> s <span style=color:#ff6ac1>not</span> <span style=color:#ff6ac1>in</span> coords:
</span></span><span style=display:flex><span>        coords[s] <span style=color:#ff6ac1>=</span> get_lat_long_from_site(s)
</span></span><span style=display:flex><span>        save <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>True</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#78787e># If we&#39;ve updated, save it out</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> save:
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span> <span style=color:#ff5c57>open</span>(filename, <span style=color:#5af78e>&#34;w&#34;</span>) <span style=color:#ff6ac1>as</span> f:
</span></span><span style=display:flex><span>            json<span style=color:#ff6ac1>.</span>dump(coords, f)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>print</span>(<span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;We now have </span><span style=color:#5af78e>{</span><span style=color:#ff5c57>len</span>(coords<span style=color:#ff6ac1>.</span>keys())<span style=color:#5af78e>}</span><span style=color:#5af78e> sites ready to go!&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_row</span>(date):
</span></span><span style=display:flex><span>    row <span style=color:#ff6ac1>=</span> data_fixed<span style=color:#ff6ac1>.</span>loc[date]<span style=color:#ff6ac1>.</span>to_frame()<span style=color:#ff6ac1>.</span>reset_index()
</span></span><span style=display:flex><span>    change <span style=color:#ff6ac1>=</span> data_fixed_change<span style=color:#ff6ac1>.</span>loc[date]<span style=color:#ff6ac1>.</span>to_frame()<span style=color:#ff6ac1>.</span>reset_index()
</span></span><span style=display:flex><span>    row<span style=color:#ff6ac1>.</span>columns <span style=color:#ff6ac1>=</span> [<span style=color:#5af78e>&#34;site&#34;</span>, <span style=color:#5af78e>&#34;enrolment&#34;</span>]
</span></span><span style=display:flex><span>    change<span style=color:#ff6ac1>.</span>columns <span style=color:#ff6ac1>=</span> [<span style=color:#5af78e>&#34;site&#34;</span>, <span style=color:#5af78e>&#34;change&#34;</span>]
</span></span><span style=display:flex><span>    row <span style=color:#ff6ac1>=</span> row<span style=color:#ff6ac1>.</span>merge(change, on<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;site&#34;</span>)
</span></span><span style=display:flex><span>    row[<span style=color:#5af78e>&#34;date&#34;</span>] <span style=color:#ff6ac1>=</span> date
</span></span><span style=display:flex><span>    row[<span style=color:#5af78e>&#34;coord&#34;</span>] <span style=color:#ff6ac1>=</span> row[<span style=color:#5af78e>&#34;site&#34;</span>]<span style=color:#ff6ac1>.</span>map(coords)
</span></span><span style=display:flex><span>    row[<span style=color:#5af78e>&#34;lat&#34;</span>] <span style=color:#ff6ac1>=</span> row[<span style=color:#5af78e>&#34;coord&#34;</span>]<span style=color:#ff6ac1>.</span>str[<span style=color:#ff9f43>0</span>]
</span></span><span style=display:flex><span>    row[<span style=color:#5af78e>&#34;long&#34;</span>] <span style=color:#ff6ac1>=</span> row[<span style=color:#5af78e>&#34;coord&#34;</span>]<span style=color:#ff6ac1>.</span>str[<span style=color:#ff9f43>1</span>]
</span></span><span style=display:flex><span>    row[<span style=color:#5af78e>&#34;country&#34;</span>] <span style=color:#ff6ac1>=</span> row[<span style=color:#5af78e>&#34;coord&#34;</span>]<span style=color:#ff6ac1>.</span>str[<span style=color:#ff9f43>2</span>]
</span></span><span style=display:flex><span>    row <span style=color:#ff6ac1>=</span> row<span style=color:#ff6ac1>.</span>drop(columns<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;coord&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#78787e># Manually fix up the issues to separate HK and China</span>
</span></span><span style=display:flex><span>    hk <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>abs(row<span style=color:#ff6ac1>.</span>lat <span style=color:#ff6ac1>-</span> <span style=color:#ff9f43>22.3</span>) <span style=color:#ff6ac1>&lt;</span> <span style=color:#ff9f43>0.2</span>
</span></span><span style=display:flex><span>    row<span style=color:#ff6ac1>.</span>loc[hk, <span style=color:#5af78e>&#34;country&#34;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;Hong Kong&#34;</span>
</span></span><span style=display:flex><span>    np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>seed(<span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    row<span style=color:#ff6ac1>.</span>loc[hk, <span style=color:#5af78e>&#34;lat&#34;</span>] <span style=color:#ff6ac1>+=</span> np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>normal(scale<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.5</span>, size<span style=color:#ff6ac1>=</span>hk<span style=color:#ff6ac1>.</span>sum())
</span></span><span style=display:flex><span>    row<span style=color:#ff6ac1>.</span>loc[hk, <span style=color:#5af78e>&#34;long&#34;</span>] <span style=color:#ff6ac1>+=</span> np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>normal(scale<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.5</span>, size<span style=color:#ff6ac1>=</span>hk<span style=color:#ff6ac1>.</span>sum())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> row
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test_row <span style=color:#ff6ac1>=</span> get_row(data_fixed<span style=color:#ff6ac1>.</span>index<span style=color:#ff6ac1>.</span>max())
</span></span><span style=display:flex><span>test_row
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> mpl_toolkits.basemap <span style=color:#ff6ac1>import</span> Basemap
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> matplotlib.pyplot <span style=color:#ff6ac1>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_base_fig</span>():
</span></span><span style=display:flex><span>    <span style=color:#78787e># Lets define some colors</span>
</span></span><span style=display:flex><span>    bg_color <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#000000&#34;</span>
</span></span><span style=display:flex><span>    coast_color <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#333333&#34;</span>
</span></span><span style=display:flex><span>    country_color <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#222222&#34;</span>
</span></span><span style=display:flex><span>    fig <span style=color:#ff6ac1>=</span> plt<span style=color:#ff6ac1>.</span>figure(figsize<span style=color:#ff6ac1>=</span>(<span style=color:#ff9f43>12</span>, <span style=color:#ff9f43>6</span>))
</span></span><span style=display:flex><span>    m <span style=color:#ff6ac1>=</span> Basemap(projection<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#39;cyl&#39;</span>, llcrnrlat<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>70</span>,urcrnrlat<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>90</span>, 
</span></span><span style=display:flex><span>                llcrnrlon<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>170</span>, urcrnrlon<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>190</span>, area_thresh<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10000.</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>fillcontinents(color<span style=color:#ff6ac1>=</span>bg_color, lake_color<span style=color:#ff6ac1>=</span>bg_color, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>2</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>drawcoastlines(color<span style=color:#ff6ac1>=</span>coast_color, linewidth<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.7</span>, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>drawcountries(color<span style=color:#ff6ac1>=</span>country_color, linewidth<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.7</span>, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>drawmapboundary(fill_color<span style=color:#ff6ac1>=</span>bg_color, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> fig, m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_base_fig();
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Colours based roughly on primary colour in countries flag</span>
</span></span><span style=display:flex><span>colors <span style=color:#ff6ac1>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Australia&#34;</span>: <span style=color:#5af78e>&#34;#FFD54F&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;United States of America&#34;</span>: <span style=color:#5af78e>&#34;#1e88e5&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;United Kingdom&#34;</span>: <span style=color:#5af78e>&#34;#4FC3F7&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Estonia&#34;</span>: <span style=color:#5af78e>&#34;#1E88E5&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Taiwan&#34;</span>: <span style=color:#5af78e>&#34;#E53935&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Vietnam&#34;</span>: <span style=color:#5af78e>&#34;#C62828&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Ireland&#34;</span>: <span style=color:#5af78e>&#34;#FFA726&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Brazil&#34;</span>: <span style=color:#5af78e>&#34;#4CAF50&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Argentina&#34;</span>: <span style=color:#5af78e>&#34;#4FC3F7&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Chile&#34;</span>: <span style=color:#5af78e>&#34;#F44336&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Indonesia&#34;</span>: <span style=color:#5af78e>&#34;#FF8A80&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Japan&#34;</span>: <span style=color:#5af78e>&#34;#C62828&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Germany&#34;</span>: <span style=color:#5af78e>&#34;#E040FB&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;South Korea&#34;</span>: <span style=color:#5af78e>&#34;#BBDEFB&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Qatar&#34;</span>: <span style=color:#5af78e>&#34;#AD1457&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Poland&#34;</span>: <span style=color:#5af78e>&#34;#E53935&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Spain&#34;</span>: <span style=color:#5af78e>&#34;#FFB300&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Australia&#34;</span>: <span style=color:#5af78e>&#34;#FFCA28&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Russia&#34;</span>: <span style=color:#5af78e>&#34;#3F51B5&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Benin&#34;</span>: <span style=color:#5af78e>&#34;#558B2F&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Saudi Arabia&#34;</span>: <span style=color:#5af78e>&#34;#1B5E20&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Hong Kong&#34;</span>: <span style=color:#5af78e>&#34;#D84315&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;France&#34;</span>: <span style=color:#5af78e>&#34;#01579B&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;The Netherlands&#34;</span>: <span style=color:#5af78e>&#34;#B71C1C&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Belgium&#34;</span>: <span style=color:#5af78e>&#34;#FDD835&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Kuwait&#34;</span>: <span style=color:#5af78e>&#34;#4CAF50&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Yemen&#34;</span>: <span style=color:#5af78e>&#34;#D81B60&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Italy&#34;</span>: <span style=color:#5af78e>&#34;#8BC34A&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Austria&#34;</span>: <span style=color:#5af78e>&#34;#C62828&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Mexico&#34;</span>: <span style=color:#5af78e>&#34;#4CAF50&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Portugal&#34;</span>: <span style=color:#5af78e>&#34;#F44336&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;South Africa&#34;</span>: <span style=color:#5af78e>&#34;#8BC34A&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Cameroon&#34;</span>: <span style=color:#5af78e>&#34;#2bab7a&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Malta&#34;</span>: <span style=color:#5af78e>&#34;#ed2f3c&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Thailand&#34;</span>: <span style=color:#5af78e>&#34;#458eed&#34;</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_scatter</span>(data):
</span></span><span style=display:flex><span>    fig, m <span style=color:#ff6ac1>=</span> get_base_fig()
</span></span><span style=display:flex><span>    <span style=color:#78787e># Loop over each country and its institutions</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>for</span> country <span style=color:#ff6ac1>in</span> np<span style=color:#ff6ac1>.</span>unique(data<span style=color:#ff6ac1>.</span>country):
</span></span><span style=display:flex><span>        c <span style=color:#ff6ac1>=</span> colors<span style=color:#ff6ac1>.</span>get(country, <span style=color:#5af78e>&#34;#FF99FF&#34;</span>)
</span></span><span style=display:flex><span>        subset <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>loc[(data<span style=color:#ff6ac1>.</span>country <span style=color:#ff6ac1>==</span> country) <span style=color:#ff6ac1>&amp;</span> (data<span style=color:#ff6ac1>.</span>enrolment <span style=color:#ff6ac1>&gt;</span> <span style=color:#ff9f43>0</span>), :]
</span></span><span style=display:flex><span>        s <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>10</span> <span style=color:#ff6ac1>+</span> subset<span style=color:#ff6ac1>.</span>enrolment
</span></span><span style=display:flex><span>        m<span style=color:#ff6ac1>.</span>scatter(subset<span style=color:#ff6ac1>.</span>long, subset<span style=color:#ff6ac1>.</span>lat, latlon<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, c<span style=color:#ff6ac1>=</span>c, s<span style=color:#ff6ac1>=</span>s, zorder<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_scatter(test_row);
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> matplotlib.colors <span style=color:#ff6ac1>import</span> LinearSegmentedColormap <span style=color:#ff6ac1>as</span> LSC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_shaded</span>(data, date, frame<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>, show<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>False</span>):
</span></span><span style=display:flex><span>    fig, m <span style=color:#ff6ac1>=</span> get_base_fig()
</span></span><span style=display:flex><span>    <span style=color:#78787e># Loop over each country and its institutions</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    max_v <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>change<span style=color:#ff6ac1>.</span>max() <span style=color:#ff6ac1>+</span> <span style=color:#ff9f43>1</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>for</span> country <span style=color:#ff6ac1>in</span> np<span style=color:#ff6ac1>.</span>unique(data<span style=color:#ff6ac1>.</span>country):
</span></span><span style=display:flex><span>        c <span style=color:#ff6ac1>=</span> colors<span style=color:#ff6ac1>.</span>get(country)
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>if</span> c <span style=color:#ff6ac1>is</span> <span style=color:#ff6ac1>None</span>:
</span></span><span style=display:flex><span>            c <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#FF99FF&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff5c57>print</span>(<span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Cannot find colour for country </span><span style=color:#5af78e>{</span>country<span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#78787e># From base colour, increase intensity of patients added today</span>
</span></span><span style=display:flex><span>        cmap <span style=color:#ff6ac1>=</span> LSC<span style=color:#ff6ac1>.</span>from_list(<span style=color:#5af78e>&#34;fade&#34;</span>, [c, <span style=color:#5af78e>&#34;#FFFFFF&#34;</span>], N<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>100</span>)
</span></span><span style=display:flex><span>        subset <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>loc[(data<span style=color:#ff6ac1>.</span>country <span style=color:#ff6ac1>==</span> country) <span style=color:#ff6ac1>&amp;</span> (data<span style=color:#ff6ac1>.</span>enrolment <span style=color:#ff6ac1>&gt;</span> <span style=color:#ff9f43>0</span>), :]
</span></span><span style=display:flex><span>        s <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>10</span> <span style=color:#ff6ac1>+</span> subset<span style=color:#ff6ac1>.</span>enrolment
</span></span><span style=display:flex><span>        cs <span style=color:#ff6ac1>=</span> cmap(<span style=color:#ff9f43>2</span> <span style=color:#ff6ac1>*</span> subset<span style=color:#ff6ac1>.</span>change <span style=color:#ff6ac1>/</span> max_v)
</span></span><span style=display:flex><span>        m<span style=color:#ff6ac1>.</span>scatter(subset<span style=color:#ff6ac1>.</span>long, subset<span style=color:#ff6ac1>.</span>lat, latlon<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, c<span style=color:#ff6ac1>=</span>cs, s<span style=color:#ff6ac1>=</span>s, zorder<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#78787e># Set the title, and make the background black</span>
</span></span><span style=display:flex><span>    plt<span style=color:#ff6ac1>.</span>title(<span style=color:#5af78e>&#34;CCCC Patient Contributions&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>16</span>, 
</span></span><span style=display:flex><span>              color<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;#EEEEEE&#34;</span>, fontname<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Open Sans&#34;</span>, y<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1.03</span>)
</span></span><span style=display:flex><span>    d <span style=color:#ff6ac1>=</span> pd<span style=color:#ff6ac1>.</span>to_datetime(date)<span style=color:#ff6ac1>.</span>strftime(<span style=color:#5af78e>&#34;</span><span style=color:#5af78e>%d</span><span style=color:#5af78e> - %B&#34;</span>)
</span></span><span style=display:flex><span>    ax <span style=color:#ff6ac1>=</span> fig<span style=color:#ff6ac1>.</span>get_axes()[<span style=color:#ff9f43>0</span>]
</span></span><span style=display:flex><span>    plt<span style=color:#ff6ac1>.</span>text(<span style=color:#ff9f43>0.5</span>, <span style=color:#ff9f43>1.02</span>, d, c<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;#AAAAAA&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>14</span>, 
</span></span><span style=display:flex><span>             verticalalignment<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;top&#34;</span>, horizontalalignment<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;center&#34;</span>,
</span></span><span style=display:flex><span>             transform<span style=color:#ff6ac1>=</span>ax<span style=color:#ff6ac1>.</span>transAxes)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fig<span style=color:#ff6ac1>.</span>patch<span style=color:#ff6ac1>.</span>set_facecolor(<span style=color:#5af78e>&#34;#000000&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> show:
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> fig
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>        name <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;cccc_enrolment/output/</span><span style=color:#5af78e>{</span>frame<span style=color:#5af78e>:</span><span style=color:#5af78e>04d</span><span style=color:#5af78e>}</span><span style=color:#5af78e>.png&#34;</span>
</span></span><span style=display:flex><span>        fig<span style=color:#ff6ac1>.</span>savefig(name, bbox_inches<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;tight&#34;</span>, padding<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>, facecolor<span style=color:#ff6ac1>=</span>fig<span style=color:#ff6ac1>.</span>get_facecolor(), transparent<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>False</span>, dpi<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>300</span>)
</span></span><span style=display:flex><span>        plt<span style=color:#ff6ac1>.</span>close(fig)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_shaded(test_row, <span style=color:#5af78e>&#34;2020-03-23&#34;</span>, show<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>);
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>plot_date</span>(i, date):
</span></span><span style=display:flex><span>    data <span style=color:#ff6ac1>=</span> get_row(date)
</span></span><span style=display:flex><span>    get_shaded(data, date, i)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#ff6ac1>for</span> i, date <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>enumerate</span>(data_fixed<span style=color:#ff6ac1>.</span>index):
</span></span><span style=display:flex><span>    plot_date(i, date)
</span></span></code></pre></div><div class="relative max-w-xl mx-auto my-20"><div class="fancy_card horizontal"><div class=card_translator><div class="card_rotator tiny_rot card_layer"><div class="card_layer newsletter p-2"><div class="newsletter-inner h-full"><div class="relative h-full sib-form-container" id=sib-form-container><div class="mb-6 lg:mb-12 text-center"><h3 class="text-main-200 mb-2 lg:mb-8">Stay in the loop!</h3><p class="text-main-100 text-lg text-opacity-70">For new releases, exclusive giveaways, and reviews.</p></div><form action="https://Cosmiccoding.us5.list-manage.com/subscribe/post?u=aebe5de1d2e40dccb3aeca491&amp;id=3987dd4a1f" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class="validate w-full" target=_blank novalidate><div><input type=email class="w-full appearance-none bg-main-600 mb-4 border border-main-600 bg-opacity-5 focus:border-main-300 rounded-sm px-4 py-3 text-main-100 placeholder-main-100 required" placeholder="Your best email…" aria-label="Your best email…" name=EMAIL required data-required=true id=EMAIL><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_aebe5de1d2e40dccb3aeca491_3987dd4a1f tabindex=-1></div><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class="button btn bg-main-600 hover:bg-main-400 shadow w-full"></div><p id=mce-error-response style=display:none class="text-center mt-2 opacity-50 text-main-200">There was a problem, please try again.</p><p id=mce-success-response style=display:none class="text-center mt-2 opacity-50 text-main-200">Thanks mate, won't let ya down.</p></form></div></div></div><div class="card_layer card_effect card_soft_glare" style=pointer-events:none></div></div></div></div></div></div><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script></div><script language=javascript type=text/javascript src=https://cosmiccoding.com.au/js/main.min.11673d10a962fb5205229607e62ea1d23424d35dad33db7bfe2a09a63d5409fa.js></script>
<script async defer src="https://www.googletagmanager.com/gtag/js?id=G-GRX6QE03YR"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GRX6QE03YR")</script></div></body></html>