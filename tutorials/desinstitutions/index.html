<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Visualising with Basemap - Samuel Hinton</title><link rel=stylesheet href="https://cosmiccoding.com.au/css/main.min.b842bc4f8d358708f7b5666fe7108ed6474cd18dad036996cd6f85d3bb7b6a42.css" integrity="sha256-uEK8T401hwj3tWZv5xCO1kdM0Y2tA2mWzW+F07t7akI="><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel="shortcut icon" href=https://cosmiccoding.com.au/img/favicon.png type=image/x-icon></head><meta name=description content="Plotting DES institutions in a beautiful way"><meta name=robots content="noodp"><link rel=canonical href=https://cosmiccoding.com.au/tutorials/desinstitutions/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cosmiccoding.com.au/tutorials/desinstitutions/cover.png"><meta name=twitter:title content="Visualising with Basemap"><meta name=twitter:description content="Plotting DES institutions in a beautiful way"><meta property="og:title" content="Visualising with Basemap"><meta property="og:description" content="Plotting DES institutions in a beautiful way"><meta property="og:type" content="article"><meta property="og:url" content="https://cosmiccoding.com.au/tutorials/desinstitutions/"><meta property="og:image" content="https://cosmiccoding.com.au/tutorials/desinstitutions/cover.png"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2019-08-10T00:00:00+00:00"><meta property="article:modified_time" content="2019-08-10T00:00:00+00:00"><meta property="article:section" content="tutorial"><meta property="article:published_time" content="2019-08-10 00:00:00 +0000 UTC"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Visualising with Basemap","genre":"tutorial","url":"https:\/\/cosmiccoding.com.au\/tutorials\/desinstitutions\/","datePublished":"2019-08-10 00:00:00 \u002b0000 UTC","description":"Plotting DES institutions in a beautiful way","author":{"@type":"Person","name":""}}</script><body><div class="flex flex-col min-h-screen overflow-hidden"><header class="absolute w-full z-30"><div class="max-w-6xl mx-auto px-4 sm:px-6"><div class="flex items-center justify-between h-20"><div class="flex-shrink-0 mr-4"><a class=block href=/ aria-label="Samuel Hinton"><h2 class=logo>SRH</h2></a></div><nav class="hidden md:flex md:flex-grow"><ul class="flex flex-grow justify-end flex-wrap items-center"><li><a href=/#books class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Books</a></li><li><a href=/reviews class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Reviews</a></li><li><a href=/tutorials class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Tutorials</a></li><li><a href=/blogs class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Blog</a></li><li><a href=/#courses class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">CV</a></li></ul></nav><div class=md:hidden x-data="{ expanded: false }"><button class=hamburger :class="{ 'active': expanded }" @click.stop="expanded = !expanded" aria-controls=mobile-nav :aria-expanded=expanded>
<span class=sr-only>Menu</span><svg class="w-6 h-6 fill-current text-gray-300 hover:text-gray-200 transition duration-150 ease-in-out" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect y="4" width="24" height="2" rx="1"/><rect y="11" width="24" height="2" rx="1"/><rect y="18" width="24" height="2" rx="1"/></svg></button><nav id=mobile-nav class="absolute top-full z-20 left-0 w-full px-4 sm:px-6 overflow-hidden transition-all duration-300 ease-in-out" x-ref=mobileNav :style="expanded ? 'max-height: ' + $refs.mobileNav.scrollHeight + 'px; opacity: 1' : 'max-height: 0; opacity: .8'" @click.away="expanded = false" @keydown.escape.window="expanded = false" x-cloak><ul class="bg-gray-800 px-4 py-2"><li><a href=/#books class="flex text-gray-300 hover:text-gray-200 py-2">Books</a></li><li><a href=/reviews class="flex text-gray-300 hover:text-gray-200 py-2">Reviews</a></li><li><a href=/tutorials class="flex text-gray-300 hover:text-gray-200 py-2">Tutorials</a></li><li><a href=/blogs class="flex text-gray-300 hover:text-gray-200 py-2">Blog</a></li><li><a href=/#courses class="flex text-gray-300 hover:text-gray-200 py-2">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="flex text-gray-300 hover:text-gray-200 py-2">CV</a></li></ul></nav></div></div></div></header><div class=flex-grow><div id=post-container class="content content-wider blog-post relative"><div class="section-header blog"><h1 class=title>Visualising with Basemap</h1><p>6th August 2019</p><p>Plotting DES institutions in a beautiful way</p></div><div><ul class="grid gap-6 w-full md:grid-cols-2" style=list-style:none;padding-left:0><li><input type=radio id=show-code name=code-toggle value=show-code class="hidden peer" onchange=clickCheckbox(this) required checked>
<label for=show-code class="inline-flex justify-between items-center p-5 w-full text-gray-500 bg-gray-800 rounded-lg border border-gray-200 cursor-pointer peer-checked:border-2 peer-checked:border-main-300 peer-checked:text-white peer-checked:bg-gray-700 hover:text-gray-200 hover:bg-gray-700"><div class="block w-full"><div class="w-full text-center text-lg font-semibold">Show me everything!</div><div class="w-full text-center text-sm">Oh yeah, coding time.</div></div></label></li><li><input type=radio id=hide-code name=code-toggle value=hide-code class="hidden peer" onchange=clickCheckbox(this)>
<label for=hide-code class="inline-flex justify-between items-center p-5 w-full text-gray-500 bg-gray-800 rounded-lg border border-gray-200 cursor-pointer peer-checked:border-2 peer-checked:border-main-300 peer-checked:text-white peer-checked:bg-gray-700 hover:text-gray-200 hover:bg-gray-700"><div class="block w-full"><div class="w-full text-center text-lg font-semibold">Just the plots</div><div class="w-full text-center text-sm">Code is nasty.</div></div></label></li></ul></div><script>function clickCheckbox(e){e.id=="show-code"?document.getElementById("post-container").classList.remove("hide-code"):document.getElementById("post-container").classList.add("hide-code")}</script><p>I&rsquo;m scheduled to give a talk for the Dark Energy Survey - a massive collection of researchers, engineers and institutions working together to try and constrain the nature of Dark Energy. To help give my presentations some pizzaz, I thought it would be nice to visualise the spread of institutions around the world that makes DES the wonderful organisation that it is.</p><h2 id=wheres-the-data>Wheres the data</h2><p>Unfortunately&mldr; I had to collect it by hand. Going through the DES website, writing down each partner, manually gettings its latitude and longitude (yes I know there&rsquo;s an API, but that would have taken longer). You can find it <a href=/static/notebooks/desinstitutions/institutions.csv>here</a>.</p><div class="reduced-code width-54" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> pandas <span style=color:#ff6ac1>as</span> pd
</span></span><span style=display:flex><span>data <span style=color:#ff6ac1>=</span> pd<span style=color:#ff6ac1>.</span>read_csv(<span style=color:#5af78e>&#34;desinstitutions\institutions.csv&#34;</span>)
</span></span><span style=display:flex><span>data<span style=color:#ff6ac1>.</span>head()
</span></span></code></pre></div></div><div><table class="table-auto table dataframe"><thead><tr style=text-align:right><th></th><th>shortname</th><th>longname</th><th>long</th><th>lat</th><th>country</th></tr></thead><tbody><tr><th>0</th><td>Fermilab</td><td>Fermi National Accelerator Laboratory</td><td>41.840944</td><td>-88.279393</td><td>US</td></tr><tr><th>1</th><td>Chicago</td><td>University of Chicago</td><td>41.788536</td><td>-87.598960</td><td>US</td></tr><tr><th>2</th><td>UIUC</td><td>University of Illinois</td><td>41.865848</td><td>-87.645245</td><td>US</td></tr><tr><th>3</th><td>NCSA</td><td>National Center for Supercomputing Applications</td><td>40.115045</td><td>-88.224302</td><td>US</td></tr><tr><th>4</th><td>LBNL</td><td>Lawrence Berkeley National Laboratory</td><td>37.875526</td><td>-122.252252</td><td>US</td></tr></tbody></table></div><h2 id=using-basemap>Using basemap</h2><p>Le&rsquo;s start with just a generic outline.</p><div class="expanded-code width-82" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> os
</span></span><span style=display:flex><span><span style=color:#78787e># Sorry about this, shouldn&#39;t have install it in the root env, but ah well</span>
</span></span><span style=display:flex><span>os<span style=color:#ff6ac1>.</span>environ[<span style=color:#5af78e>&#39;PROJ_LIB&#39;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>r</span><span style=color:#5af78e>&#39;C:\Anaconda3\pkgs\proj4-5.2.0-ha925a31_1\Library\share&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> mpl_toolkits.basemap <span style=color:#ff6ac1>import</span> Basemap
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> matplotlib.pyplot <span style=color:#ff6ac1>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_base_fig</span>():
</span></span><span style=display:flex><span>    <span style=color:#78787e># Lets define some colors</span>
</span></span><span style=display:flex><span>    bg_color <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#000000&#34;</span>
</span></span><span style=display:flex><span>    coast_color <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#333333&#34;</span>
</span></span><span style=display:flex><span>    country_color <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#222222&#34;</span>
</span></span><span style=display:flex><span>    plt<span style=color:#ff6ac1>.</span>figure(figsize<span style=color:#ff6ac1>=</span>(<span style=color:#ff9f43>12</span>, <span style=color:#ff9f43>6</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    m <span style=color:#ff6ac1>=</span> Basemap(projection<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#39;cyl&#39;</span>, llcrnrlat<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>80</span>,urcrnrlat<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>90</span>, 
</span></span><span style=display:flex><span>                llcrnrlon<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>170</span>, urcrnrlon<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>190</span>, area_thresh<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10000.</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>fillcontinents(color<span style=color:#ff6ac1>=</span>bg_color, lake_color<span style=color:#ff6ac1>=</span>bg_color, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>2</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>drawcoastlines(color<span style=color:#ff6ac1>=</span>coast_color, linewidth<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1.0</span>, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>drawcountries(color<span style=color:#ff6ac1>=</span>country_color, linewidth<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1.0</span>, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>drawmapboundary(fill_color<span style=color:#ff6ac1>=</span>bg_color, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_base_fig();
</span></span></code></pre></div></div><pre><code>  from ipykernel import kernelapp as app
</code></pre><p><div><figure class=rounded><picture><source srcset=/tutorials/desinstitutions/2019-08-10-DESInstitutions_files/2019-08-10-DESInstitutions_3_1_hu4c27e913065bb5f09fa90d0cb89e68c6_136119_1145x0_resize_q90_h2_box_3.webp width=1145 height=556 type=image/webp><source srcset=/tutorials/desinstitutions/2019-08-10-DESInstitutions_files/2019-08-10-DESInstitutions_3_1.png width=1145 height=556 type=image/png><img width=1145 height=556 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Great. It a pain to remove the larger rivers, involves downloading a new shape file, so we&rsquo;ll live with it.</p><h1 id=add-the-dots>Add the dots</h1><p>Let&rsquo;s see what it looks like if we just add some dots, with each country having a unique colour.</p><div class=width-75 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>colors <span style=color:#ff6ac1>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Australia&#34;</span>: <span style=color:#5af78e>&#34;#FFB300&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;US&#34;</span>: <span style=color:#5af78e>&#34;#1976D2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;UK&#34;</span>: <span style=color:#5af78e>&#34;#4DD0E1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Germany&#34;</span>: <span style=color:#5af78e>&#34;#98e63e&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Spain&#34;</span>: <span style=color:#5af78e>&#34;#E91E63&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Switzerland&#34;</span>: <span style=color:#5af78e>&#34;#FB8C00&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Brazil&#34;</span>: <span style=color:#5af78e>&#34;#43A047&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;South Africa&#34;</span>: <span style=color:#5af78e>&#34;#8956e3&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Chile&#34;</span>: <span style=color:#5af78e>&#34;#f74f98&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_scatter</span>():
</span></span><span style=display:flex><span>    m <span style=color:#ff6ac1>=</span> get_base_fig()
</span></span><span style=display:flex><span>    <span style=color:#78787e># Loop over each country and its institutions</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>for</span> country <span style=color:#ff6ac1>in</span> np<span style=color:#ff6ac1>.</span>unique(data<span style=color:#ff6ac1>.</span>country):
</span></span><span style=display:flex><span>        c <span style=color:#ff6ac1>=</span> colors[country]
</span></span><span style=display:flex><span>        subset <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>loc[data<span style=color:#ff6ac1>.</span>country <span style=color:#ff6ac1>==</span> country, :]
</span></span><span style=display:flex><span>        m<span style=color:#ff6ac1>.</span>scatter(subset<span style=color:#ff6ac1>.</span>long, subset<span style=color:#ff6ac1>.</span>lat, latlon<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, c<span style=color:#ff6ac1>=</span>c, s<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>4</span>, zorder<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_scatter();
</span></span></code></pre></div></div><pre><code>  from ipykernel import kernelapp as app
</code></pre><p><div><figure class=rounded><picture><source srcset=/tutorials/desinstitutions/2019-08-10-DESInstitutions_files/2019-08-10-DESInstitutions_5_1_hu070181058f8e7e4d49a91f0ce68d464b_138562_1145x0_resize_q90_h2_box_3.webp width=1145 height=556 type=image/webp><source srcset=/tutorials/desinstitutions/2019-08-10-DESInstitutions_files/2019-08-10-DESInstitutions_5_1.png width=1145 height=556 type=image/png><img width=1145 height=556 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>I mean&mldr; it&rsquo;s nice. But <em>cool</em> graphics glow. So let&rsquo;s put in a super nasty manual glow effect, and then replot the scatter point in translucent white above it. To do this, we&rsquo;ll create one hell of a <code>meshgred</code>. Efficient&mldr; no. Easy&mldr; still no.</p><div class=width-69 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>from</span> matplotlib.colors <span style=color:#ff6ac1>import</span> LinearSegmentedColormap <span style=color:#ff6ac1>as</span> LSC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_shaded</span>():
</span></span><span style=display:flex><span>    m <span style=color:#ff6ac1>=</span> get_scatter()
</span></span><span style=display:flex><span>    <span style=color:#78787e># Compute the limits and mesh</span>
</span></span><span style=display:flex><span>    x0, y0 <span style=color:#ff6ac1>=</span> m(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>170</span>, <span style=color:#ff6ac1>-</span><span style=color:#ff9f43>80</span>)
</span></span><span style=display:flex><span>    x1, y1 <span style=color:#ff6ac1>=</span> m(<span style=color:#ff9f43>190</span>, <span style=color:#ff9f43>90</span>)
</span></span><span style=display:flex><span>    xs, ys <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>linspace(x0, x1, <span style=color:#ff9f43>2000</span>), np<span style=color:#ff6ac1>.</span>linspace(y0, y1, <span style=color:#ff9f43>2000</span>)
</span></span><span style=display:flex><span>    X, Y <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>meshgrid(xs, ys)
</span></span><span style=display:flex><span>    zs <span style=color:#ff6ac1>=</span> []
</span></span><span style=display:flex><span>    scale <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1.2</span>  <span style=color:#78787e># The size of the blur</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>for</span> country <span style=color:#ff6ac1>in</span> np<span style=color:#ff6ac1>.</span>unique(data<span style=color:#ff6ac1>.</span>country):
</span></span><span style=display:flex><span>        <span style=color:#78787e># Find the colour and create a smooth colour ramp</span>
</span></span><span style=display:flex><span>        c <span style=color:#ff6ac1>=</span> colors[country]
</span></span><span style=display:flex><span>        cmap <span style=color:#ff6ac1>=</span> LSC<span style=color:#ff6ac1>.</span>from_list(<span style=color:#5af78e>&#34;fade&#34;</span>, [c <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>&#34;00&#34;</span>, c,<span style=color:#5af78e>&#34;#FFFFFF&#34;</span>], N<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1000</span>)
</span></span><span style=display:flex><span>        subset <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>loc[data<span style=color:#ff6ac1>.</span>country <span style=color:#ff6ac1>==</span> country, :]
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#78787e># Find a vmax that looks good on all countries</span>
</span></span><span style=display:flex><span>        vmax <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>min</span>(<span style=color:#ff9f43>2</span>, <span style=color:#ff9f43>0.7</span> <span style=color:#ff6ac1>*</span> subset<span style=color:#ff6ac1>.</span>shape[<span style=color:#ff9f43>0</span>]<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>0.7</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#78787e># Compute the mesh values</span>
</span></span><span style=display:flex><span>        z <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>zeros(X<span style=color:#ff6ac1>.</span>shape)
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> row <span style=color:#ff6ac1>in</span> subset<span style=color:#ff6ac1>.</span>itertuples(index<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>False</span>):
</span></span><span style=display:flex><span>            x, y <span style=color:#ff6ac1>=</span> m(row<span style=color:#ff6ac1>.</span>lat, row<span style=color:#ff6ac1>.</span>long)
</span></span><span style=display:flex><span>            dist <span style=color:#ff6ac1>=</span> ((x <span style=color:#ff6ac1>-</span> X)<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>2</span> <span style=color:#ff6ac1>+</span> (y <span style=color:#ff6ac1>-</span> Y)<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>2</span>)<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>0.25</span> <span style=color:#78787e># Sharp falloff</span>
</span></span><span style=display:flex><span>            z <span style=color:#ff6ac1>+=</span> np<span style=color:#ff6ac1>.</span>exp(<span style=color:#ff6ac1>-</span>dist <span style=color:#ff6ac1>*</span> scale)
</span></span><span style=display:flex><span>        <span style=color:#78787e># Show the mesh and add the white dots</span>
</span></span><span style=display:flex><span>        m<span style=color:#ff6ac1>.</span>imshow(z, origin<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;lower&#34;</span>, extent<span style=color:#ff6ac1>=</span>[x0,x1,y0,y1], 
</span></span><span style=display:flex><span>                 cmap<span style=color:#ff6ac1>=</span>cmap, vmax<span style=color:#ff6ac1>=</span>vmax, zorder<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>2</span>)
</span></span><span style=display:flex><span>        m<span style=color:#ff6ac1>.</span>scatter(subset<span style=color:#ff6ac1>.</span>lat, subset<span style=color:#ff6ac1>.</span>long, latlon<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, c<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;#FFFFFF&#34;</span>, 
</span></span><span style=display:flex><span>                  alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.8</span>, s<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>2</span>, zorder<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>3</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#78787e># Set the title, and make the background black</span>
</span></span><span style=display:flex><span>    plt<span style=color:#ff6ac1>.</span>title(<span style=color:#5af78e>&#34;DES Institutions around the world&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>14</span>, 
</span></span><span style=display:flex><span>              color<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;#EEEEEE&#34;</span>, fontname<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Open Sans&#34;</span>)
</span></span><span style=display:flex><span>    fig <span style=color:#ff6ac1>=</span> plt<span style=color:#ff6ac1>.</span>gcf()
</span></span><span style=display:flex><span>    fig<span style=color:#ff6ac1>.</span>patch<span style=color:#ff6ac1>.</span>set_facecolor(<span style=color:#5af78e>&#34;#000000&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_shaded();
</span></span></code></pre></div></div><pre><code>  from ipykernel import kernelapp as app
</code></pre><p><div><figure class="img-main poster rounded"><picture><source srcset=/tutorials/desinstitutions/cover_hu0b69e36b12499ce25b40c1e6797395ed_218460_1145x0_resize_q90_h2_box_3.webp width=1145 height=584 type=image/webp><source srcset=/tutorials/desinstitutions/cover.png width=1145 height=584 type=image/png><img width=1145 height=584 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Great, well that&rsquo;s something I would call good enough for now. Of course&mldr; it would be better if it was animated. But that is definitely not something I intend to do in a notebook! In fact, I&rsquo;ve done it already, you can see it below:</p><p></p><hr><p>For your convenience, here&rsquo;s the code in one block:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> pandas <span style=color:#ff6ac1>as</span> pd
</span></span><span style=display:flex><span>data <span style=color:#ff6ac1>=</span> pd<span style=color:#ff6ac1>.</span>read_csv(<span style=color:#5af78e>&#34;desinstitutions\institutions.csv&#34;</span>)
</span></span><span style=display:flex><span>data<span style=color:#ff6ac1>.</span>head()
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> os
</span></span><span style=display:flex><span><span style=color:#78787e># Sorry about this, shouldn&#39;t have install it in the root env, but ah well</span>
</span></span><span style=display:flex><span>os<span style=color:#ff6ac1>.</span>environ[<span style=color:#5af78e>&#39;PROJ_LIB&#39;</span>] <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>r</span><span style=color:#5af78e>&#39;C:\Anaconda3\pkgs\proj4-5.2.0-ha925a31_1\Library\share&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> mpl_toolkits.basemap <span style=color:#ff6ac1>import</span> Basemap
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> matplotlib.pyplot <span style=color:#ff6ac1>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_base_fig</span>():
</span></span><span style=display:flex><span>    <span style=color:#78787e># Lets define some colors</span>
</span></span><span style=display:flex><span>    bg_color <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#000000&#34;</span>
</span></span><span style=display:flex><span>    coast_color <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#333333&#34;</span>
</span></span><span style=display:flex><span>    country_color <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;#222222&#34;</span>
</span></span><span style=display:flex><span>    plt<span style=color:#ff6ac1>.</span>figure(figsize<span style=color:#ff6ac1>=</span>(<span style=color:#ff9f43>12</span>, <span style=color:#ff9f43>6</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    m <span style=color:#ff6ac1>=</span> Basemap(projection<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#39;cyl&#39;</span>, llcrnrlat<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>80</span>,urcrnrlat<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>90</span>, 
</span></span><span style=display:flex><span>                llcrnrlon<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>170</span>, urcrnrlon<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>190</span>, area_thresh<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10000.</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>fillcontinents(color<span style=color:#ff6ac1>=</span>bg_color, lake_color<span style=color:#ff6ac1>=</span>bg_color, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>2</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>drawcoastlines(color<span style=color:#ff6ac1>=</span>coast_color, linewidth<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1.0</span>, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>drawcountries(color<span style=color:#ff6ac1>=</span>country_color, linewidth<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1.0</span>, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    m<span style=color:#ff6ac1>.</span>drawmapboundary(fill_color<span style=color:#ff6ac1>=</span>bg_color, zorder<span style=color:#ff6ac1>=-</span><span style=color:#ff9f43>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_base_fig();
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>colors <span style=color:#ff6ac1>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Australia&#34;</span>: <span style=color:#5af78e>&#34;#FFB300&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;US&#34;</span>: <span style=color:#5af78e>&#34;#1976D2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;UK&#34;</span>: <span style=color:#5af78e>&#34;#4DD0E1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Germany&#34;</span>: <span style=color:#5af78e>&#34;#98e63e&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Spain&#34;</span>: <span style=color:#5af78e>&#34;#E91E63&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Switzerland&#34;</span>: <span style=color:#5af78e>&#34;#FB8C00&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Brazil&#34;</span>: <span style=color:#5af78e>&#34;#43A047&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;South Africa&#34;</span>: <span style=color:#5af78e>&#34;#8956e3&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;Chile&#34;</span>: <span style=color:#5af78e>&#34;#f74f98&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_scatter</span>():
</span></span><span style=display:flex><span>    m <span style=color:#ff6ac1>=</span> get_base_fig()
</span></span><span style=display:flex><span>    <span style=color:#78787e># Loop over each country and its institutions</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>for</span> country <span style=color:#ff6ac1>in</span> np<span style=color:#ff6ac1>.</span>unique(data<span style=color:#ff6ac1>.</span>country):
</span></span><span style=display:flex><span>        c <span style=color:#ff6ac1>=</span> colors[country]
</span></span><span style=display:flex><span>        subset <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>loc[data<span style=color:#ff6ac1>.</span>country <span style=color:#ff6ac1>==</span> country, :]
</span></span><span style=display:flex><span>        m<span style=color:#ff6ac1>.</span>scatter(subset<span style=color:#ff6ac1>.</span>long, subset<span style=color:#ff6ac1>.</span>lat, latlon<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, c<span style=color:#ff6ac1>=</span>c, s<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>4</span>, zorder<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_scatter();
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> matplotlib.colors <span style=color:#ff6ac1>import</span> LinearSegmentedColormap <span style=color:#ff6ac1>as</span> LSC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_shaded</span>():
</span></span><span style=display:flex><span>    m <span style=color:#ff6ac1>=</span> get_scatter()
</span></span><span style=display:flex><span>    <span style=color:#78787e># Compute the limits and mesh</span>
</span></span><span style=display:flex><span>    x0, y0 <span style=color:#ff6ac1>=</span> m(<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>170</span>, <span style=color:#ff6ac1>-</span><span style=color:#ff9f43>80</span>)
</span></span><span style=display:flex><span>    x1, y1 <span style=color:#ff6ac1>=</span> m(<span style=color:#ff9f43>190</span>, <span style=color:#ff9f43>90</span>)
</span></span><span style=display:flex><span>    xs, ys <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>linspace(x0, x1, <span style=color:#ff9f43>2000</span>), np<span style=color:#ff6ac1>.</span>linspace(y0, y1, <span style=color:#ff9f43>2000</span>)
</span></span><span style=display:flex><span>    X, Y <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>meshgrid(xs, ys)
</span></span><span style=display:flex><span>    zs <span style=color:#ff6ac1>=</span> []
</span></span><span style=display:flex><span>    scale <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1.2</span>  <span style=color:#78787e># The size of the blur</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>for</span> country <span style=color:#ff6ac1>in</span> np<span style=color:#ff6ac1>.</span>unique(data<span style=color:#ff6ac1>.</span>country):
</span></span><span style=display:flex><span>        <span style=color:#78787e># Find the colour and create a smooth colour ramp</span>
</span></span><span style=display:flex><span>        c <span style=color:#ff6ac1>=</span> colors[country]
</span></span><span style=display:flex><span>        cmap <span style=color:#ff6ac1>=</span> LSC<span style=color:#ff6ac1>.</span>from_list(<span style=color:#5af78e>&#34;fade&#34;</span>, [c <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>&#34;00&#34;</span>, c,<span style=color:#5af78e>&#34;#FFFFFF&#34;</span>], N<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1000</span>)
</span></span><span style=display:flex><span>        subset <span style=color:#ff6ac1>=</span> data<span style=color:#ff6ac1>.</span>loc[data<span style=color:#ff6ac1>.</span>country <span style=color:#ff6ac1>==</span> country, :]
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#78787e># Find a vmax that looks good on all countries</span>
</span></span><span style=display:flex><span>        vmax <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>min</span>(<span style=color:#ff9f43>2</span>, <span style=color:#ff9f43>0.7</span> <span style=color:#ff6ac1>*</span> subset<span style=color:#ff6ac1>.</span>shape[<span style=color:#ff9f43>0</span>]<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>0.7</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#78787e># Compute the mesh values</span>
</span></span><span style=display:flex><span>        z <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>zeros(X<span style=color:#ff6ac1>.</span>shape)
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> row <span style=color:#ff6ac1>in</span> subset<span style=color:#ff6ac1>.</span>itertuples(index<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>False</span>):
</span></span><span style=display:flex><span>            x, y <span style=color:#ff6ac1>=</span> m(row<span style=color:#ff6ac1>.</span>lat, row<span style=color:#ff6ac1>.</span>long)
</span></span><span style=display:flex><span>            dist <span style=color:#ff6ac1>=</span> ((x <span style=color:#ff6ac1>-</span> X)<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>2</span> <span style=color:#ff6ac1>+</span> (y <span style=color:#ff6ac1>-</span> Y)<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>2</span>)<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>0.25</span> <span style=color:#78787e># Sharp falloff</span>
</span></span><span style=display:flex><span>            z <span style=color:#ff6ac1>+=</span> np<span style=color:#ff6ac1>.</span>exp(<span style=color:#ff6ac1>-</span>dist <span style=color:#ff6ac1>*</span> scale)
</span></span><span style=display:flex><span>        <span style=color:#78787e># Show the mesh and add the white dots</span>
</span></span><span style=display:flex><span>        m<span style=color:#ff6ac1>.</span>imshow(z, origin<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;lower&#34;</span>, extent<span style=color:#ff6ac1>=</span>[x0,x1,y0,y1], 
</span></span><span style=display:flex><span>                 cmap<span style=color:#ff6ac1>=</span>cmap, vmax<span style=color:#ff6ac1>=</span>vmax, zorder<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>2</span>)
</span></span><span style=display:flex><span>        m<span style=color:#ff6ac1>.</span>scatter(subset<span style=color:#ff6ac1>.</span>lat, subset<span style=color:#ff6ac1>.</span>long, latlon<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, c<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;#FFFFFF&#34;</span>, 
</span></span><span style=display:flex><span>                  alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.8</span>, s<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>2</span>, zorder<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>3</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#78787e># Set the title, and make the background black</span>
</span></span><span style=display:flex><span>    plt<span style=color:#ff6ac1>.</span>title(<span style=color:#5af78e>&#34;DES Institutions around the world&#34;</span>, fontsize<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>14</span>, 
</span></span><span style=display:flex><span>              color<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;#EEEEEE&#34;</span>, fontname<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Open Sans&#34;</span>)
</span></span><span style=display:flex><span>    fig <span style=color:#ff6ac1>=</span> plt<span style=color:#ff6ac1>.</span>gcf()
</span></span><span style=display:flex><span>    fig<span style=color:#ff6ac1>.</span>patch<span style=color:#ff6ac1>.</span>set_facecolor(<span style=color:#5af78e>&#34;#000000&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_shaded();
</span></span></code></pre></div><div class="relative max-w-xl mx-auto my-20"><div class="fancy_card horizontal"><div class=card_translator><div class="card_rotator tiny_rot card_layer"><div class="card_layer newsletter p-2"><div class="newsletter-inner h-full"><div class="relative h-full sib-form-container" id=sib-form-container><div class="mb-6 lg:mb-12 text-center"><h3 class="text-main-200 mb-2 lg:mb-8">Stay in the loop!</h3><p class="text-main-100 text-lg text-opacity-70">For new releases, exclusive giveaways, and reviews.</p></div><form action="https://Cosmiccoding.us5.list-manage.com/subscribe/post?u=aebe5de1d2e40dccb3aeca491&id=3987dd4a1f" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class="validate w-full" target=_blank novalidate><div><input type=email class="w-full appearance-none bg-main-600 mb-4 border border-main-600 bg-opacity-5 focus:border-main-300 rounded-sm px-4 py-3 text-main-100 placeholder-main-100 required" placeholder="Your best email…" aria-label="Your best email…" name=EMAIL required data-required=true id=EMAIL><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_aebe5de1d2e40dccb3aeca491_3987dd4a1f tabindex=-1></div><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class="button btn bg-main-600 hover:bg-main-400 shadow w-full"></div><p id=mce-error-response style=display:none class="text-center mt-2 opacity-50 text-main-200">There was a problem, please try again.</p><p id=mce-success-response style=display:none class="text-center mt-2 opacity-50 text-main-200">Thanks mate, won't let ya down.</p></form></div></div></div><div class="card_layer card_effect card_soft_glare" style=pointer-events:none></div></div></div></div></div></div><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script></div><script language=javascript type=text/javascript src=https://cosmiccoding.com.au/js/main.min.11673d10a962fb5205229607e62ea1d23424d35dad33db7bfe2a09a63d5409fa.js></script>
<script async defer src="https://www.googletagmanager.com/gtag/js?id=UA-72691106-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-72691106-1")</script></div></body></html>