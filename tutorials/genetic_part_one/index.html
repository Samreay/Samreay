<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>- Samuel Hinton</title><link rel=stylesheet href="https://cosmiccoding.com.au/css/main.min.5400481537df6ded7c631d7584eaeb522e0bea3c952908a01d5163e524dfbcde.css" integrity="sha256-VABIFTffbe18Yx11hOrrUi4L6jyVKQigHVFj5STfvN4="><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel="shortcut icon" href=https://cosmiccoding.com.au/img/favicon.png type=image/x-icon></head><meta name=description content="A gentle introduction to genetic algorithms by recreating painting classics?"><meta name=robots content="noodp"><link rel=canonical href=https://cosmiccoding.com.au/tutorials/genetic_part_one/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cosmiccoding.com.au/tutorials/genetic_part_one/cover.png"><meta name=twitter:title content><meta name=twitter:description content="A gentle introduction to genetic algorithms by recreating painting classics?"><meta property="og:title" content><meta property="og:description" content="A gentle introduction to genetic algorithms by recreating painting classics?"><meta property="og:type" content="article"><meta property="og:url" content="https://cosmiccoding.com.au/tutorials/genetic_part_one/"><meta property="og:image" content="https://cosmiccoding.com.au/tutorials/genetic_part_one/cover.png"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2021-03-19T00:00:00+00:00"><meta property="article:modified_time" content="2021-03-19T00:00:00+00:00"><meta property="article:section" content="tutorial"><meta property="article:published_time" content="2021-03-19 00:00:00 +0000 UTC"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"","genre":"tutorial","url":"https:\/\/cosmiccoding.com.au\/tutorials\/genetic_part_one\/","datePublished":"2021-03-19 00:00:00 \u002b0000 UTC","description":"A gentle introduction to genetic algorithms by recreating painting classics?","author":{"@type":"Person","name":""}}</script><body><div class="flex flex-col min-h-screen overflow-hidden"><header class="absolute w-full z-30"><div class="max-w-6xl mx-auto px-4 sm:px-6"><div class="flex items-center justify-between h-20"><div class="flex-shrink-0 mr-4"><a class=block href=/ aria-label="Samuel Hinton"><h2 class=logo>SRH</h2></a></div><nav class="hidden md:flex md:flex-grow"><ul class="flex flex-grow justify-end flex-wrap items-center"><li><a href=/#books class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Books</a></li><li><a href=/reviews class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Reviews</a></li><li><a href=/tutorials class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Tutorials</a></li><li><a href=/blogs class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Blog</a></li><li><a href=/#courses class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">CV</a></li></ul></nav><div class=md:hidden x-data="{ expanded: false }"><button class=hamburger :class="{ 'active': expanded }" @click.stop="expanded = !expanded" aria-controls=mobile-nav :aria-expanded=expanded>
<span class=sr-only>Menu</span><svg class="w-6 h-6 fill-current text-gray-300 hover:text-gray-200 transition duration-150 ease-in-out" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect y="4" width="24" height="2" rx="1"/><rect y="11" width="24" height="2" rx="1"/><rect y="18" width="24" height="2" rx="1"/></svg></button><nav id=mobile-nav class="absolute top-full z-20 left-0 w-full px-4 sm:px-6 overflow-hidden transition-all duration-300 ease-in-out" x-ref=mobileNav :style="expanded ? 'max-height: ' + $refs.mobileNav.scrollHeight + 'px; opacity: 1' : 'max-height: 0; opacity: .8'" @click.away="expanded = false" @keydown.escape.window="expanded = false" x-cloak><ul class="bg-gray-800 px-4 py-2"><li><a href=/#books class="flex text-gray-300 hover:text-gray-200 py-2">Books</a></li><li><a href=/reviews class="flex text-gray-300 hover:text-gray-200 py-2">Reviews</a></li><li><a href=/tutorials class="flex text-gray-300 hover:text-gray-200 py-2">Tutorials</a></li><li><a href=/blogs class="flex text-gray-300 hover:text-gray-200 py-2">Blog</a></li><li><a href=/#courses class="flex text-gray-300 hover:text-gray-200 py-2">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="flex text-gray-300 hover:text-gray-200 py-2">CV</a></li></ul></nav></div></div></div></header><div class=flex-grow><div id=post-container class="content content-wider blog-post relative"><div class="section-header blog"><h1 class=title></h1><p>6th March 2021</p><p>A gentle introduction to genetic algorithms by recreating painting classics?</p></div><div><ul class="grid gap-6 w-full md:grid-cols-2" style=list-style:none;padding-left:0><li><input type=radio id=show-code name=code-toggle value=show-code class="hidden peer" onchange=clickCheckbox(this) required checked>
<label for=show-code class="inline-flex justify-between items-center p-5 w-full text-gray-500 bg-gray-800 rounded-lg border border-gray-200 cursor-pointer peer-checked:border-2 peer-checked:border-main-300 peer-checked:text-white peer-checked:bg-gray-700 hover:text-gray-200 hover:bg-gray-700"><div class="block w-full"><div class="w-full text-center text-lg font-semibold">Show me everything!</div><div class="w-full text-center text-sm">Oh yeah, coding time.</div></div></label></li><li><input type=radio id=hide-code name=code-toggle value=hide-code class="hidden peer" onchange=clickCheckbox(this)>
<label for=hide-code class="inline-flex justify-between items-center p-5 w-full text-gray-500 bg-gray-800 rounded-lg border border-gray-200 cursor-pointer peer-checked:border-2 peer-checked:border-main-300 peer-checked:text-white peer-checked:bg-gray-700 hover:text-gray-200 hover:bg-gray-700"><div class="block w-full"><div class="w-full text-center text-lg font-semibold">Just the plots</div><div class="w-full text-center text-sm">Code is nasty.</div></div></label></li></ul></div><script>function clickCheckbox(e){e.id=="show-code"?document.getElementById("post-container").classList.remove("hide-code"):document.getElementById("post-container").classList.add("hide-code")}</script><p>This is what we&rsquo;re going to make in this tutorial. It may not look like much, but then again, this is but the first step into genetic algorithms. If you&rsquo;ve guessed that this is the Starry Night (or bothered to read the title, description or anything else), fantastic.</p><p><div class="video img-small"><video preload=auto playsinline plays-inline controls autoplay loop muted>
<source src=/tutorials/genetic_part_one/output.mp4 type=video/mp4></video></div></p><p>The idea behind Genetic Algorithms is simple - each algorithm can be evaluated to get its fitness, and algorithms are mutated, bred and culled, according to their performance. The broad steps of a genetic algorithm are as follows:</p><ol><li>Start with an initial population</li><li>Determine the fitness of members of the population</li><li>Select the fitest members for survival</li><li>Breed those members (for example, using crossover, which we&rsquo;ll cover next)</li><li>Mutate them for fun!</li><li>Continue from step 2</li></ol><p>To get us started with genetic algorithms, we are going to forget for now about a population and breeding, instead we shall have a single organism and line of descent, mutating it away as it undergoes mitosis.</p><p>To begin, some necessary imports:</p><div class="reduced-code width-47" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> os
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> numpy.random <span style=color:#ff6ac1>import</span> choice, random, normal
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> colour <span style=color:#ff6ac1>import</span> Color
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> pygame  <span style=color:#78787e># Pygame for nice fast drawing</span>
</span></span></code></pre></div></div><p>For the first fun part, we want an <em>organism</em>. An organism is an entity with a chromosome, which is a collection of genes. These genes are what we mutate, and the genes express themselves in various ways. In our example, each gene expresses itself as a circle.</p><p>Each organism has the ability to mutate. That is, perform mitosis to generate a new organism that is a clone of itself, except with some genes <em>changed</em> in some way. In the implementation below, you can see that when we mutate, we give the option to add or remove a gene, or to change features of existing genes. Of course, we could do these both together, we just have to keep in mind that if we change too much at once, our new organism will probably be a bad fit and get culled immediately.</p><p>If you are familiar with MCMC optimisation methods like Metropolis-Hastings, this is us making sure our step size is small enough. If MCMC is something new, ignore this sentence!</p><div class="expanded-code width-81" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>class</span> <span style=color:#f3f99d>Organism</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> __init__(self, genes):
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>clip(genes, <span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>visual <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>fitness <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>None</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>mutate</span>(self, mutation_rate<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.01</span>, scale<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>, add_chance<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Get a mutated organism given the mutation rates and scale input &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>copy(self<span style=color:#ff6ac1>.</span>chromosome)
</span></span><span style=display:flex><span>        n_gene, n_feats <span style=color:#ff6ac1>=</span> chromosome<span style=color:#ff6ac1>.</span>shape
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#78787e># Here we can add/remove a gene, or mutate an existing one</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&gt;</span> add_chance:
</span></span><span style=display:flex><span>            <span style=color:#78787e># Mutate features in our genes</span>
</span></span><span style=display:flex><span>            num_mutations <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>+</span> <span style=color:#ff5c57>int</span>(mutation_rate <span style=color:#ff6ac1>*</span> chromosome<span style=color:#ff6ac1>.</span>size)
</span></span><span style=display:flex><span>            <span style=color:#78787e># As we mutate more, the size of mutations decreases</span>
</span></span><span style=display:flex><span>            scale2 <span style=color:#ff6ac1>=</span> scale <span style=color:#ff6ac1>/</span> num_mutations
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(num_mutations):
</span></span><span style=display:flex><span>                chromosome[choice(n_gene), choice(n_feats)] <span style=color:#ff6ac1>+=</span> normal() <span style=color:#ff6ac1>*</span> scale2
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#78787e># Either add or remove a gene</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&lt;</span> <span style=color:#ff9f43>0.3</span>:
</span></span><span style=display:flex><span>                chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>delete(chromosome, choice(n_gene), axis<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#78787e># When we add, we&#39;ll do so by blending two existing genes </span>
</span></span><span style=display:flex><span>                <span style=color:#78787e># and perturbing it. More likely to find a good gene this way.</span>
</span></span><span style=display:flex><span>                a, b <span style=color:#ff6ac1>=</span> choice(n_gene, <span style=color:#ff9f43>2</span>, replace<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>False</span>)
</span></span><span style=display:flex><span>                gene <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>atleast_2d(<span style=color:#ff9f43>0.5</span> <span style=color:#ff6ac1>*</span> (chromosome[a, :] <span style=color:#ff6ac1>+</span> chromosome[b, :]))
</span></span><span style=display:flex><span>                gene <span style=color:#ff6ac1>+=</span> scale <span style=color:#ff6ac1>*</span> normal(size<span style=color:#ff6ac1>=</span>(<span style=color:#ff9f43>1</span>, gene<span style=color:#ff6ac1>.</span>size))
</span></span><span style=display:flex><span>                gene[:, <span style=color:#ff9f43>2</span>] <span style=color:#ff6ac1>*=</span> <span style=color:#ff9f43>0.2</span>
</span></span><span style=display:flex><span>                chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>append(chromosome, gene, axis<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> Organism(chromosome)
</span></span><span style=display:flex><span>    
</span></span></code></pre></div></div><p>After this, we want something that keeps track of our organism, and mutates it, evaluates it, etc. We shall call this a <code>Population</code>, even though in our case we just looking at a single <code>best_organism</code> to start with.</p><p>This a fairly large code block, but it should be fairly straightforward in its logic. If you want the important part, the <code>step</code> function at the bottom is main component.</p><div class="expanded-code width-93" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>class</span> <span style=color:#f3f99d>Population</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> __init__(self, path):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Load in the reference image and create a surface we can draw on. &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        pygame<span style=color:#ff6ac1>.</span>init()
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>ref <span style=color:#ff6ac1>=</span> pygame<span style=color:#ff6ac1>.</span>surfarray<span style=color:#ff6ac1>.</span>pixels3d(pygame<span style=color:#ff6ac1>.</span>image<span style=color:#ff6ac1>.</span>load(path))
</span></span><span style=display:flex><span>        w, h, d <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>ref<span style=color:#ff6ac1>.</span>shape
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>screen <span style=color:#ff6ac1>=</span> pygame<span style=color:#ff6ac1>.</span>Surface((w, h))
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>screen<span style=color:#ff6ac1>.</span>fill((<span style=color:#ff9f43>255</span>, <span style=color:#ff9f43>255</span>, <span style=color:#ff9f43>255</span>))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>best_organism <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>draw</span>(self, organism):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Draw an organism by expressing each gene in term &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        w, h, d <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>ref<span style=color:#ff6ac1>.</span>shape
</span></span><span style=display:flex><span>        screen <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>screen<span style=color:#ff6ac1>.</span>copy()
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> gene <span style=color:#ff6ac1>in</span> organism<span style=color:#ff6ac1>.</span>chromosome:
</span></span><span style=display:flex><span>            x, y, size, <span style=color:#ff6ac1>*</span>hsl <span style=color:#ff6ac1>=</span> gene
</span></span><span style=display:flex><span>            position <span style=color:#ff6ac1>=</span> (<span style=color:#ff5c57>int</span>(x <span style=color:#ff6ac1>*</span> w), <span style=color:#ff5c57>int</span>(y <span style=color:#ff6ac1>*</span> h))
</span></span><span style=display:flex><span>            c <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>tuple</span>(<span style=color:#ff5c57>map</span>(<span style=color:#ff6ac1>lambda</span> x: <span style=color:#ff5c57>int</span>(<span style=color:#ff9f43>255</span> <span style=color:#ff6ac1>*</span> x),  Color(hsl<span style=color:#ff6ac1>=</span>hsl)<span style=color:#ff6ac1>.</span>rgb))
</span></span><span style=display:flex><span>            pygame<span style=color:#ff6ac1>.</span>draw<span style=color:#ff6ac1>.</span>circle(screen, c, position, <span style=color:#ff5c57>int</span>((size <span style=color:#ff6ac1>*</span> <span style=color:#ff9f43>0.3</span> <span style=color:#ff6ac1>+</span> <span style=color:#ff9f43>0.01</span>) <span style=color:#ff6ac1>*</span> w))
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> screen
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>spawn</span>(self, complexity<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Spawn a new individual with `complexity` genes to start with &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        random_genes <span style=color:#ff6ac1>=</span> random((complexity, <span style=color:#ff9f43>6</span>))
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>best_organism <span style=color:#ff6ac1>=</span> Organism(random_genes)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>calc_fitness(self<span style=color:#ff6ac1>.</span>best_organism)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>calc_fitness</span>(self, organism):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Calculate the fitness of a gene by drawing it and comparing
</span></span></span><span style=display:flex><span><span style=color:#5af78e>        it to the reference &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        screen <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>draw(organism)
</span></span><span style=display:flex><span>        diff <span style=color:#ff6ac1>=</span> pygame<span style=color:#ff6ac1>.</span>surfarray<span style=color:#ff6ac1>.</span>pixels3d(screen) <span style=color:#ff6ac1>-</span> self<span style=color:#ff6ac1>.</span>ref
</span></span><span style=display:flex><span>        organism<span style=color:#ff6ac1>.</span>fitness <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>-</span>np<span style=color:#ff6ac1>.</span>mean(np<span style=color:#ff6ac1>.</span>abs(diff)) <span style=color:#ff6ac1>-</span> <span style=color:#ff9f43>1e-5</span> <span style=color:#ff6ac1>*</span> organism<span style=color:#ff6ac1>.</span>chromosome<span style=color:#ff6ac1>.</span>size
</span></span><span style=display:flex><span>        organism<span style=color:#ff6ac1>.</span>visual <span style=color:#ff6ac1>=</span> screen
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>step</span>(self, time, outdir, rate<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.01</span>, scale<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>, add_chance<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Take a step in time by mutating the organism and seeing if its the 
</span></span></span><span style=display:flex><span><span style=color:#5af78e>        fittest out there! This will also save out a checkpoint file so we can resume
</span></span></span><span style=display:flex><span><span style=color:#5af78e>        evolution, and save out images every 200 steps. &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        o <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>best_organism<span style=color:#ff6ac1>.</span>mutate(mutation_rate<span style=color:#ff6ac1>=</span>rate, scale<span style=color:#ff6ac1>=</span>scale, add_chance<span style=color:#ff6ac1>=</span>add_chance)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>calc_fitness(o)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>if</span> o<span style=color:#ff6ac1>.</span>fitness <span style=color:#ff6ac1>&gt;</span> self<span style=color:#ff6ac1>.</span>best_organism<span style=color:#ff6ac1>.</span>fitness:
</span></span><span style=display:flex><span>            self<span style=color:#ff6ac1>.</span>best_organism <span style=color:#ff6ac1>=</span> o
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#78787e># Save out the image if we want it</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>if</span> time <span style=color:#ff6ac1>%</span> <span style=color:#ff9f43>200</span> <span style=color:#ff6ac1>==</span> <span style=color:#ff9f43>0</span>:
</span></span><span style=display:flex><span>            path <span style=color:#ff6ac1>=</span> outdir <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;</span><span style=color:#5af78e>{</span>time <span style=color:#ff6ac1>//</span> <span style=color:#ff9f43>200</span><span style=color:#5af78e>:</span><span style=color:#5af78e>04d</span><span style=color:#5af78e>}</span><span style=color:#5af78e>.png&#34;</span>
</span></span><span style=display:flex><span>            pygame<span style=color:#ff6ac1>.</span>image<span style=color:#ff6ac1>.</span>save(self<span style=color:#ff6ac1>.</span>best_organism<span style=color:#ff6ac1>.</span>visual, path)
</span></span><span style=display:flex><span>            np<span style=color:#ff6ac1>.</span>save(outdir <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>&#34;save.npy&#34;</span>, self<span style=color:#ff6ac1>.</span>best_organism<span style=color:#ff6ac1>.</span>chromosome)
</span></span></code></pre></div></div><p>With this population, we can create a handy helper function which points to a reference image, sets an output directup up, and then either loads the checkpoint, or starts anew if its not found!</p><div class=width-74 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>evolve</span>(rate, scale, add_chance, steps<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1000000</span>):
</span></span><span style=display:flex><span>    pop <span style=color:#ff6ac1>=</span> Population(<span style=color:#5af78e>&#34;genetic1/starry_night.png&#34;</span>)
</span></span><span style=display:flex><span>    outdir <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;genetic1/output/&#34;</span>
</span></span><span style=display:flex><span>    os<span style=color:#ff6ac1>.</span>makedirs(outdir, exist_ok<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>)
</span></span><span style=display:flex><span>    save <span style=color:#ff6ac1>=</span> outdir <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>&#34;save.npy&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> os<span style=color:#ff6ac1>.</span>path<span style=color:#ff6ac1>.</span>exists(save):
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>best_organism <span style=color:#ff6ac1>=</span> Organism(np<span style=color:#ff6ac1>.</span>load(save))
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>calc_fitness(pop<span style=color:#ff6ac1>.</span>best_organism)
</span></span><span style=display:flex><span>        start <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>int</span>(<span style=color:#ff5c57>sorted</span>(os<span style=color:#ff6ac1>.</span>listdir(outdir))[<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>2</span>][:<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>4</span>]) <span style=color:#ff6ac1>*</span> <span style=color:#ff9f43>200</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>spawn(complexity<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10</span>)
</span></span><span style=display:flex><span>        start <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>0</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(start, steps):
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>step(i, outdir, rate<span style=color:#ff6ac1>=</span>rate, scale<span style=color:#ff6ac1>=</span>scale, add_chance<span style=color:#ff6ac1>=</span>add_chance)
</span></span></code></pre></div></div><p>With this all set up, we can now call <code>evolve</code> and specify the mutation rate, the scale of the mutations, and the chance that we add or remove a gene in any given mutation.</p><p><div><figure class="img-main rounded"><picture><source srcset=/tutorials/genetic_part_one/cover_hu786e819a5f2e0de988c2ef6304a2aa5e_760580_630x0_resize_q90_h2_box_3.webp width=630 height=500 type=image/webp><source srcset=/tutorials/genetic_part_one/cover.png width=630 height=500 type=image/png><img width=630 height=500 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>The above is our starting point, so lets see how far we can get using a slow rate of evolution:</p><div class="expanded-code width-85" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#78787e># 1% chance of mutation, scale is a normal of std 0.2, and 1% chance to add or remove</span>
</span></span><span style=display:flex><span>evolve(<span style=color:#ff9f43>0.01</span>, <span style=color:#ff9f43>0.2</span>, <span style=color:#ff9f43>0.01</span>)
</span></span></code></pre></div></div><p>After this has run, we will have a <em>lot</em> of PNG files in the output directory. If we fire up good old <code>ffmpeg</code> to turn them into a video sequence, this is what we get:</p><p></p><p>Alright, this all looks interesting&mldr;</p><p>But&mldr;</p><p>It took thousands upon thousands of iterations to get us anything like what we want, and even at the end it could be markedly better.</p><p>Obviously, it is time to increase the sophistication of our algorithm. <a href=/genetic2>Onto part two</a>! And for reference, here is our final frame:</p><p><div><figure class=rounded><picture><source srcset=/tutorials/genetic_part_one/2021-03-19-Genetic_Part_One_files/2021-03-19-Genetic_Part_One_18_0_hu0b9f084cba34cf6b969ed418e5b4f915_1097657_1920x0_resize_q90_h2_box_3.webp width=1920 height=721 type=image/webp><source srcset=/tutorials/genetic_part_one/2021-03-19-Genetic_Part_One_files/2021-03-19-Genetic_Part_One_18_0.png width=2093 height=786 type=image/png><img width=2093 height=786 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><hr><p>For your convenience, here&rsquo;s the code in one block:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> os
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> numpy.random <span style=color:#ff6ac1>import</span> choice, random, normal
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> colour <span style=color:#ff6ac1>import</span> Color
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> pygame  <span style=color:#78787e># Pygame for nice fast drawing</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>class</span> <span style=color:#f3f99d>Organism</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> __init__(self, genes):
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>clip(genes, <span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>visual <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>fitness <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>None</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>mutate</span>(self, mutation_rate<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.01</span>, scale<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>, add_chance<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Get a mutated organism given the mutation rates and scale input &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>copy(self<span style=color:#ff6ac1>.</span>chromosome)
</span></span><span style=display:flex><span>        n_gene, n_feats <span style=color:#ff6ac1>=</span> chromosome<span style=color:#ff6ac1>.</span>shape
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#78787e># Here we can add/remove a gene, or mutate an existing one</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&gt;</span> add_chance:
</span></span><span style=display:flex><span>            <span style=color:#78787e># Mutate features in our genes</span>
</span></span><span style=display:flex><span>            num_mutations <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>+</span> <span style=color:#ff5c57>int</span>(mutation_rate <span style=color:#ff6ac1>*</span> chromosome<span style=color:#ff6ac1>.</span>size)
</span></span><span style=display:flex><span>            <span style=color:#78787e># As we mutate more, the size of mutations decreases</span>
</span></span><span style=display:flex><span>            scale2 <span style=color:#ff6ac1>=</span> scale <span style=color:#ff6ac1>/</span> num_mutations
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(num_mutations):
</span></span><span style=display:flex><span>                chromosome[choice(n_gene), choice(n_feats)] <span style=color:#ff6ac1>+=</span> normal() <span style=color:#ff6ac1>*</span> scale2
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#78787e># Either add or remove a gene</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&lt;</span> <span style=color:#ff9f43>0.3</span>:
</span></span><span style=display:flex><span>                chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>delete(chromosome, choice(n_gene), axis<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#78787e># When we add, we&#39;ll do so by blending two existing genes </span>
</span></span><span style=display:flex><span>                <span style=color:#78787e># and perturbing it. More likely to find a good gene this way.</span>
</span></span><span style=display:flex><span>                a, b <span style=color:#ff6ac1>=</span> choice(n_gene, <span style=color:#ff9f43>2</span>, replace<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>False</span>)
</span></span><span style=display:flex><span>                gene <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>atleast_2d(<span style=color:#ff9f43>0.5</span> <span style=color:#ff6ac1>*</span> (chromosome[a, :] <span style=color:#ff6ac1>+</span> chromosome[b, :]))
</span></span><span style=display:flex><span>                gene <span style=color:#ff6ac1>+=</span> scale <span style=color:#ff6ac1>*</span> normal(size<span style=color:#ff6ac1>=</span>(<span style=color:#ff9f43>1</span>, gene<span style=color:#ff6ac1>.</span>size))
</span></span><span style=display:flex><span>                gene[:, <span style=color:#ff9f43>2</span>] <span style=color:#ff6ac1>*=</span> <span style=color:#ff9f43>0.2</span>
</span></span><span style=display:flex><span>                chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>append(chromosome, gene, axis<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> Organism(chromosome)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#ff6ac1>class</span> <span style=color:#f3f99d>Population</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> __init__(self, path):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Load in the reference image and create a surface we can draw on. &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        pygame<span style=color:#ff6ac1>.</span>init()
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>ref <span style=color:#ff6ac1>=</span> pygame<span style=color:#ff6ac1>.</span>surfarray<span style=color:#ff6ac1>.</span>pixels3d(pygame<span style=color:#ff6ac1>.</span>image<span style=color:#ff6ac1>.</span>load(path))
</span></span><span style=display:flex><span>        w, h, d <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>ref<span style=color:#ff6ac1>.</span>shape
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>screen <span style=color:#ff6ac1>=</span> pygame<span style=color:#ff6ac1>.</span>Surface((w, h))
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>screen<span style=color:#ff6ac1>.</span>fill((<span style=color:#ff9f43>255</span>, <span style=color:#ff9f43>255</span>, <span style=color:#ff9f43>255</span>))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>best_organism <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>draw</span>(self, organism):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Draw an organism by expressing each gene in term &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        w, h, d <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>ref<span style=color:#ff6ac1>.</span>shape
</span></span><span style=display:flex><span>        screen <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>screen<span style=color:#ff6ac1>.</span>copy()
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> gene <span style=color:#ff6ac1>in</span> organism<span style=color:#ff6ac1>.</span>chromosome:
</span></span><span style=display:flex><span>            x, y, size, <span style=color:#ff6ac1>*</span>hsl <span style=color:#ff6ac1>=</span> gene
</span></span><span style=display:flex><span>            position <span style=color:#ff6ac1>=</span> (<span style=color:#ff5c57>int</span>(x <span style=color:#ff6ac1>*</span> w), <span style=color:#ff5c57>int</span>(y <span style=color:#ff6ac1>*</span> h))
</span></span><span style=display:flex><span>            c <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>tuple</span>(<span style=color:#ff5c57>map</span>(<span style=color:#ff6ac1>lambda</span> x: <span style=color:#ff5c57>int</span>(<span style=color:#ff9f43>255</span> <span style=color:#ff6ac1>*</span> x),  Color(hsl<span style=color:#ff6ac1>=</span>hsl)<span style=color:#ff6ac1>.</span>rgb))
</span></span><span style=display:flex><span>            pygame<span style=color:#ff6ac1>.</span>draw<span style=color:#ff6ac1>.</span>circle(screen, c, position, <span style=color:#ff5c57>int</span>((size <span style=color:#ff6ac1>*</span> <span style=color:#ff9f43>0.3</span> <span style=color:#ff6ac1>+</span> <span style=color:#ff9f43>0.01</span>) <span style=color:#ff6ac1>*</span> w))
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> screen
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>spawn</span>(self, complexity<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Spawn a new individual with `complexity` genes to start with &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        random_genes <span style=color:#ff6ac1>=</span> random((complexity, <span style=color:#ff9f43>6</span>))
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>best_organism <span style=color:#ff6ac1>=</span> Organism(random_genes)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>calc_fitness(self<span style=color:#ff6ac1>.</span>best_organism)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>calc_fitness</span>(self, organism):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Calculate the fitness of a gene by drawing it and comparing
</span></span></span><span style=display:flex><span><span style=color:#5af78e>        it to the reference &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        screen <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>draw(organism)
</span></span><span style=display:flex><span>        diff <span style=color:#ff6ac1>=</span> pygame<span style=color:#ff6ac1>.</span>surfarray<span style=color:#ff6ac1>.</span>pixels3d(screen) <span style=color:#ff6ac1>-</span> self<span style=color:#ff6ac1>.</span>ref
</span></span><span style=display:flex><span>        organism<span style=color:#ff6ac1>.</span>fitness <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>-</span>np<span style=color:#ff6ac1>.</span>mean(np<span style=color:#ff6ac1>.</span>abs(diff)) <span style=color:#ff6ac1>-</span> <span style=color:#ff9f43>1e-5</span> <span style=color:#ff6ac1>*</span> organism<span style=color:#ff6ac1>.</span>chromosome<span style=color:#ff6ac1>.</span>size
</span></span><span style=display:flex><span>        organism<span style=color:#ff6ac1>.</span>visual <span style=color:#ff6ac1>=</span> screen
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>step</span>(self, time, outdir, rate<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.01</span>, scale<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>, add_chance<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Take a step in time by mutating the organism and seeing if its the 
</span></span></span><span style=display:flex><span><span style=color:#5af78e>        fittest out there! This will also save out a checkpoint file so we can resume
</span></span></span><span style=display:flex><span><span style=color:#5af78e>        evolution, and save out images every 200 steps. &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        o <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>best_organism<span style=color:#ff6ac1>.</span>mutate(mutation_rate<span style=color:#ff6ac1>=</span>rate, scale<span style=color:#ff6ac1>=</span>scale, add_chance<span style=color:#ff6ac1>=</span>add_chance)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>calc_fitness(o)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>if</span> o<span style=color:#ff6ac1>.</span>fitness <span style=color:#ff6ac1>&gt;</span> self<span style=color:#ff6ac1>.</span>best_organism<span style=color:#ff6ac1>.</span>fitness:
</span></span><span style=display:flex><span>            self<span style=color:#ff6ac1>.</span>best_organism <span style=color:#ff6ac1>=</span> o
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#78787e># Save out the image if we want it</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>if</span> time <span style=color:#ff6ac1>%</span> <span style=color:#ff9f43>200</span> <span style=color:#ff6ac1>==</span> <span style=color:#ff9f43>0</span>:
</span></span><span style=display:flex><span>            path <span style=color:#ff6ac1>=</span> outdir <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;</span><span style=color:#5af78e>{</span>time <span style=color:#ff6ac1>//</span> <span style=color:#ff9f43>200</span><span style=color:#5af78e>:</span><span style=color:#5af78e>04d</span><span style=color:#5af78e>}</span><span style=color:#5af78e>.png&#34;</span>
</span></span><span style=display:flex><span>            pygame<span style=color:#ff6ac1>.</span>image<span style=color:#ff6ac1>.</span>save(self<span style=color:#ff6ac1>.</span>best_organism<span style=color:#ff6ac1>.</span>visual, path)
</span></span><span style=display:flex><span>            np<span style=color:#ff6ac1>.</span>save(outdir <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>&#34;save.npy&#34;</span>, self<span style=color:#ff6ac1>.</span>best_organism<span style=color:#ff6ac1>.</span>chromosome)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>evolve</span>(rate, scale, add_chance, steps<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1000000</span>):
</span></span><span style=display:flex><span>    pop <span style=color:#ff6ac1>=</span> Population(<span style=color:#5af78e>&#34;genetic1/starry_night.png&#34;</span>)
</span></span><span style=display:flex><span>    outdir <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;genetic1/output/&#34;</span>
</span></span><span style=display:flex><span>    os<span style=color:#ff6ac1>.</span>makedirs(outdir, exist_ok<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>)
</span></span><span style=display:flex><span>    save <span style=color:#ff6ac1>=</span> outdir <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>&#34;save.npy&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> os<span style=color:#ff6ac1>.</span>path<span style=color:#ff6ac1>.</span>exists(save):
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>best_organism <span style=color:#ff6ac1>=</span> Organism(np<span style=color:#ff6ac1>.</span>load(save))
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>calc_fitness(pop<span style=color:#ff6ac1>.</span>best_organism)
</span></span><span style=display:flex><span>        start <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>int</span>(<span style=color:#ff5c57>sorted</span>(os<span style=color:#ff6ac1>.</span>listdir(outdir))[<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>2</span>][:<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>4</span>]) <span style=color:#ff6ac1>*</span> <span style=color:#ff9f43>200</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>spawn(complexity<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10</span>)
</span></span><span style=display:flex><span>        start <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>0</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(start, steps):
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>step(i, outdir, rate<span style=color:#ff6ac1>=</span>rate, scale<span style=color:#ff6ac1>=</span>scale, add_chance<span style=color:#ff6ac1>=</span>add_chance)
</span></span><span style=display:flex><span><span style=color:#78787e># 1% chance of mutation, scale is a normal of std 0.2, and 1% chance to add or remove</span>
</span></span><span style=display:flex><span>evolve(<span style=color:#ff9f43>0.01</span>, <span style=color:#ff9f43>0.2</span>, <span style=color:#ff9f43>0.01</span>)
</span></span></code></pre></div><div class="relative max-w-xl mx-auto my-20"><div class="fancy_card horizontal"><div class=card_translator><div class="card_rotator tiny_rot card_layer"><div class="card_layer newsletter p-2"><div class="newsletter-inner h-full"><div class="relative h-full sib-form-container" id=sib-form-container><div class="mb-6 lg:mb-12 text-center"><h3 class="text-main-200 mb-2 lg:mb-8">Stay in the loop!</h3><p class="text-main-100 text-lg text-opacity-70">For new releases, exclusive giveaways, and reviews.</p></div><form action="https://Cosmiccoding.us5.list-manage.com/subscribe/post?u=aebe5de1d2e40dccb3aeca491&amp;id=3987dd4a1f" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class="validate w-full" target=_blank novalidate><div><input type=email class="w-full appearance-none bg-main-600 mb-4 border border-main-600 bg-opacity-5 focus:border-main-300 rounded-sm px-4 py-3 text-main-100 placeholder-main-100 required" placeholder="Your best email" aria-label="Your best email" name=EMAIL required data-required=true id=EMAIL><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_aebe5de1d2e40dccb3aeca491_3987dd4a1f tabindex=-1></div><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class="button btn bg-main-600 hover:bg-main-400 shadow w-full"></div><p id=mce-error-response style=display:none class="text-center mt-2 opacity-50 text-main-200">There was a problem, please try again.</p><p id=mce-success-response style=display:none class="text-center mt-2 opacity-50 text-main-200">Thanks mate, won't let ya down.</p></form></div></div></div><div class="card_layer card_effect card_soft_glare" style=pointer-events:none></div></div></div></div></div></div><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script></div><script language=javascript type=text/javascript src=https://cosmiccoding.com.au/js/main.min.11673d10a962fb5205229607e62ea1d23424d35dad33db7bfe2a09a63d5409fa.js></script>
<script async defer src="https://www.googletagmanager.com/gtag/js?id=G-GRX6QE03YR"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GRX6QE03YR")</script></div></body></html>