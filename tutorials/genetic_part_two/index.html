<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Genetic Algorithms 2: Painting Vermeer - Samuel Hinton</title><link rel=stylesheet href="https://cosmiccoding.com.au/css/main.min.5400481537df6ded7c631d7584eaeb522e0bea3c952908a01d5163e524dfbcde.css" integrity="sha256-VABIFTffbe18Yx11hOrrUi4L6jyVKQigHVFj5STfvN4="><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel="shortcut icon" href=https://cosmiccoding.com.au/img/favicon.png type=image/x-icon></head><meta name=description content="A gentle introduction to genetic algorithms by recreating painting classics"><meta name=robots content="noodp"><link rel=canonical href=https://cosmiccoding.com.au/tutorials/genetic_part_two/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cosmiccoding.com.au/tutorials/genetic_part_two/cover.png"><meta name=twitter:title content="Genetic Algorithms 2: Painting Vermeer"><meta name=twitter:description content="A gentle introduction to genetic algorithms by recreating painting classics"><meta property="og:title" content="Genetic Algorithms 2: Painting Vermeer"><meta property="og:description" content="A gentle introduction to genetic algorithms by recreating painting classics"><meta property="og:type" content="article"><meta property="og:url" content="https://cosmiccoding.com.au/tutorials/genetic_part_two/"><meta property="og:image" content="https://cosmiccoding.com.au/tutorials/genetic_part_two/cover.png"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2021-03-20T00:00:00+00:00"><meta property="article:modified_time" content="2021-03-20T00:00:00+00:00"><meta property="article:section" content="tutorial"><meta property="article:published_time" content="2021-03-20 00:00:00 +0000 UTC"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Genetic Algorithms 2: Painting Vermeer","genre":"tutorial","url":"https:\/\/cosmiccoding.com.au\/tutorials\/genetic_part_two\/","datePublished":"2021-03-20 00:00:00 \u002b0000 UTC","description":"A gentle introduction to genetic algorithms by recreating painting classics","author":{"@type":"Person","name":""}}</script><body><div class="flex flex-col min-h-screen overflow-hidden"><header class="absolute w-full z-30"><div class="max-w-6xl mx-auto px-4 sm:px-6"><div class="flex items-center justify-between h-20"><div class="flex-shrink-0 mr-4"><a class=block href=/ aria-label="Samuel Hinton"><h2 class=logo>SRH</h2></a></div><nav class="hidden md:flex md:flex-grow"><ul class="flex flex-grow justify-end flex-wrap items-center"><li><a href=/#books class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Books</a></li><li><a href=/reviews class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Reviews</a></li><li><a href=/tutorials class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Tutorials</a></li><li><a href=/blogs class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Blog</a></li><li><a href=/#courses class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">CV</a></li></ul></nav><div class=md:hidden x-data="{ expanded: false }"><button class=hamburger :class="{ 'active': expanded }" @click.stop="expanded = !expanded" aria-controls=mobile-nav :aria-expanded=expanded>
<span class=sr-only>Menu</span><svg class="w-6 h-6 fill-current text-gray-300 hover:text-gray-200 transition duration-150 ease-in-out" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect y="4" width="24" height="2" rx="1"/><rect y="11" width="24" height="2" rx="1"/><rect y="18" width="24" height="2" rx="1"/></svg></button><nav id=mobile-nav class="absolute top-full z-20 left-0 w-full px-4 sm:px-6 overflow-hidden transition-all duration-300 ease-in-out" x-ref=mobileNav :style="expanded ? 'max-height: ' + $refs.mobileNav.scrollHeight + 'px; opacity: 1' : 'max-height: 0; opacity: .8'" @click.away="expanded = false" @keydown.escape.window="expanded = false" x-cloak><ul class="bg-gray-800 px-4 py-2"><li><a href=/#books class="flex text-gray-300 hover:text-gray-200 py-2">Books</a></li><li><a href=/reviews class="flex text-gray-300 hover:text-gray-200 py-2">Reviews</a></li><li><a href=/tutorials class="flex text-gray-300 hover:text-gray-200 py-2">Tutorials</a></li><li><a href=/blogs class="flex text-gray-300 hover:text-gray-200 py-2">Blog</a></li><li><a href=/#courses class="flex text-gray-300 hover:text-gray-200 py-2">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="flex text-gray-300 hover:text-gray-200 py-2">CV</a></li></ul></nav></div></div></div></header><div class=flex-grow><div id=post-container class="content content-wider blog-post relative"><div class="section-header blog"><h1 class=title>Genetic Algorithms 2: Painting Vermeer</h1><p>6th March 2021</p><p>A gentle introduction to genetic algorithms by recreating painting classics</p></div><div><ul class="grid gap-6 w-full md:grid-cols-2" style=list-style:none;padding-left:0><li><input type=radio id=show-code name=code-toggle value=show-code class="hidden peer" onchange=clickCheckbox(this) required checked>
<label for=show-code class="inline-flex justify-between items-center p-5 w-full text-gray-500 bg-gray-800 rounded-lg border border-gray-200 cursor-pointer peer-checked:border-2 peer-checked:border-main-300 peer-checked:text-white peer-checked:bg-gray-700 hover:text-gray-200 hover:bg-gray-700"><div class="block w-full"><div class="w-full text-center text-lg font-semibold">Show me everything!</div><div class="w-full text-center text-sm">Oh yeah, coding time.</div></div></label></li><li><input type=radio id=hide-code name=code-toggle value=hide-code class="hidden peer" onchange=clickCheckbox(this)>
<label for=hide-code class="inline-flex justify-between items-center p-5 w-full text-gray-500 bg-gray-800 rounded-lg border border-gray-200 cursor-pointer peer-checked:border-2 peer-checked:border-main-300 peer-checked:text-white peer-checked:bg-gray-700 hover:text-gray-200 hover:bg-gray-700"><div class="block w-full"><div class="w-full text-center text-lg font-semibold">Just the plots</div><div class="w-full text-center text-sm">Code is nasty.</div></div></label></li></ul></div><script>function clickCheckbox(e){e.id=="show-code"?document.getElementById("post-container").classList.remove("hide-code"):document.getElementById("post-container").classList.add("hide-code")}</script><p>This is what we&rsquo;re going to make in this tutorial. Building on from the previous discussion in <a href=/genetic1>part one</a>, we now add population and genetic mixing into the algorithm.</p><p><div class="video img-small"><video preload=auto playsinline plays-inline controls autoplay loop muted>
<source src=/tutorials/genetic_part_two/output.mp4 type=video/mp4></video></div></p><p>In the <a href=/genetic1>prior article</a> we evolved a painting by the process of having a single organism that we mutated over time. We aim to improve this algorithm in this step by adding multiple different organisms into the population, and allowing those organisms to mate and produce offspring.</p><p>Let&rsquo;s write out our imports now to get them out of the way.</p><div class="reduced-code width-47" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> os
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> numpy.random <span style=color:#ff6ac1>import</span> choice, random, normal
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> colour <span style=color:#ff6ac1>import</span> Color
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> json
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> pygame  <span style=color:#78787e># Pygame for nice fast drawing</span>
</span></span></code></pre></div></div><p>As before, we define an organism. You&rsquo;ll note it looks very much like the one from the previous article, except that now I have increased the chance the when a gene mutates, its the hue of the cirlce that changes (hue being located in index 3).</p><div class="expanded-code width-81" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>class</span> <span style=color:#f3f99d>Organism</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> __init__(self, genes):
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>clip(genes, <span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>visual <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>fitness <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>None</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>mutate</span>(self, rate<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.01</span>, scale<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>, add<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Get a mutated organism given the mutation rates and scale input &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>copy(self<span style=color:#ff6ac1>.</span>chromosome)
</span></span><span style=display:flex><span>        n_gene, n_feat <span style=color:#ff6ac1>=</span> chromosome<span style=color:#ff6ac1>.</span>shape
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#78787e># Here we can add/remove a gene, or mutate an existing one</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&gt;</span> add:
</span></span><span style=display:flex><span>            <span style=color:#78787e># Mutate features in our genes</span>
</span></span><span style=display:flex><span>            num_mutations <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>+</span> <span style=color:#ff5c57>int</span>(rate <span style=color:#ff6ac1>*</span> n_gene)
</span></span><span style=display:flex><span>            <span style=color:#78787e># As we mutate more, the size of mutations decreases</span>
</span></span><span style=display:flex><span>            scale2 <span style=color:#ff6ac1>=</span> scale <span style=color:#ff6ac1>/</span> num_mutations
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(num_mutations):
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&gt;</span> <span style=color:#ff9f43>0.5</span>:
</span></span><span style=display:flex><span>                    i <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>3</span>
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>                    i <span style=color:#ff6ac1>=</span> choice(n_feat)
</span></span><span style=display:flex><span>                chromosome[choice(n_gene), i] <span style=color:#ff6ac1>+=</span> normal() <span style=color:#ff6ac1>*</span> scale2
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>if</span> i <span style=color:#ff6ac1>==</span> <span style=color:#ff9f43>3</span>:
</span></span><span style=display:flex><span>                    chromosome[:, i] <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>mod(chromosome[:, i], <span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#78787e># Either add or remove a gene</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&lt;</span> <span style=color:#ff9f43>0.3</span>:
</span></span><span style=display:flex><span>                chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>delete(chromosome, choice(n_gene), axis<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#78787e># When we add, we&#39;ll do so by blending two existing genes </span>
</span></span><span style=display:flex><span>                <span style=color:#78787e># and perturbing it. More likely to find a good gene this way.</span>
</span></span><span style=display:flex><span>                a, b <span style=color:#ff6ac1>=</span> choice(n_gene, <span style=color:#ff9f43>2</span>, replace<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>False</span>)
</span></span><span style=display:flex><span>                gene <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>atleast_2d(<span style=color:#ff9f43>0.5</span> <span style=color:#ff6ac1>*</span> (chromosome[a, :] <span style=color:#ff6ac1>+</span> chromosome[b, :]))
</span></span><span style=display:flex><span>                gene <span style=color:#ff6ac1>+=</span> scale <span style=color:#ff6ac1>*</span> normal(size<span style=color:#ff6ac1>=</span>(<span style=color:#ff9f43>1</span>, gene<span style=color:#ff6ac1>.</span>size))
</span></span><span style=display:flex><span>                gene[:, <span style=color:#ff9f43>2</span>] <span style=color:#ff6ac1>*=</span> <span style=color:#ff9f43>0.2</span>
</span></span><span style=display:flex><span>                chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>append(chromosome, gene, axis<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> Organism(chromosome)
</span></span><span style=display:flex><span>    
</span></span></code></pre></div></div><p>Here lie the main changes from the previous section - our population now acutally has a population. Dramatic stuff. Specifically for changes, we now have:</p><ul><li><code>spawn</code> spawns a population now, not just one individual</li><li><code>save</code> and <code>load</code> allow us to save out and load in a population so I can give my poor laptop a break when it starts to melt.</li><li><code>get_child</code> takes two parents and picks genes from both</li><li><code>mutate_and_pick</code> which tries several times to mutate the organism to a better version</li><li><code>step</code> which now generates childre, mutates them, and then picks the cream of the crop to survive.</li></ul><div class="expanded-code width-86" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>class</span> <span style=color:#f3f99d>Population</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> __init__(self, path):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Load in the reference image and create a surface we can draw on. &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        pygame<span style=color:#ff6ac1>.</span>init()
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>ref <span style=color:#ff6ac1>=</span> pygame<span style=color:#ff6ac1>.</span>surfarray<span style=color:#ff6ac1>.</span>pixels3d(pygame<span style=color:#ff6ac1>.</span>image<span style=color:#ff6ac1>.</span>load(path))
</span></span><span style=display:flex><span>        w, h, d <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>ref<span style=color:#ff6ac1>.</span>shape
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>screen <span style=color:#ff6ac1>=</span> pygame<span style=color:#ff6ac1>.</span>Surface((w, h))
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>screen<span style=color:#ff6ac1>.</span>fill((<span style=color:#ff9f43>255</span>, <span style=color:#ff9f43>255</span>, <span style=color:#ff9f43>255</span>))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>population <span style=color:#ff6ac1>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>draw</span>(self, organism):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Draw an organism by expressing each gene in term &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        w, h, d <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>ref<span style=color:#ff6ac1>.</span>shape
</span></span><span style=display:flex><span>        screen <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>screen<span style=color:#ff6ac1>.</span>copy()
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> gene <span style=color:#ff6ac1>in</span> organism<span style=color:#ff6ac1>.</span>chromosome:
</span></span><span style=display:flex><span>            x, y, size, <span style=color:#ff6ac1>*</span>hsl <span style=color:#ff6ac1>=</span> gene
</span></span><span style=display:flex><span>            position <span style=color:#ff6ac1>=</span> (<span style=color:#ff5c57>int</span>(x <span style=color:#ff6ac1>*</span> w), <span style=color:#ff5c57>int</span>(y <span style=color:#ff6ac1>*</span> h))
</span></span><span style=display:flex><span>            c <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>tuple</span>(<span style=color:#ff5c57>map</span>(<span style=color:#ff6ac1>lambda</span> x: <span style=color:#ff5c57>int</span>(<span style=color:#ff9f43>255</span> <span style=color:#ff6ac1>*</span> x),  Color(hsl<span style=color:#ff6ac1>=</span>hsl)<span style=color:#ff6ac1>.</span>rgb))
</span></span><span style=display:flex><span>            pygame<span style=color:#ff6ac1>.</span>draw<span style=color:#ff6ac1>.</span>circle(screen, c, position, <span style=color:#ff5c57>int</span>((size <span style=color:#ff6ac1>*</span> <span style=color:#ff9f43>0.3</span> <span style=color:#ff6ac1>+</span> <span style=color:#ff9f43>0.01</span>) <span style=color:#ff6ac1>*</span> w))
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> screen
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>spawn</span>(self, pop_size<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>30</span>, complexity<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Spawn a new population with `complexity` genes in each member with &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(pop_size):
</span></span><span style=display:flex><span>            organism <span style=color:#ff6ac1>=</span> Organism(random((complexity, <span style=color:#ff9f43>6</span>)))
</span></span><span style=display:flex><span>            self<span style=color:#ff6ac1>.</span>population<span style=color:#ff6ac1>.</span>append(organism) 
</span></span><span style=display:flex><span>            self<span style=color:#ff6ac1>.</span>calc_fitness(organism)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>population <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>sorted</span>(self<span style=color:#ff6ac1>.</span>population, key<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>lambda</span> x: <span style=color:#ff6ac1>-</span>x<span style=color:#ff6ac1>.</span>fitness)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>calc_fitness</span>(self, organism):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Calculate the fitness of a gene by drawing it and comparing
</span></span></span><span style=display:flex><span><span style=color:#5af78e>        it to the reference &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        screen <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>draw(organism)
</span></span><span style=display:flex><span>        diff <span style=color:#ff6ac1>=</span> pygame<span style=color:#ff6ac1>.</span>surfarray<span style=color:#ff6ac1>.</span>pixels3d(screen) <span style=color:#ff6ac1>-</span> self<span style=color:#ff6ac1>.</span>ref
</span></span><span style=display:flex><span>        organism<span style=color:#ff6ac1>.</span>fitness <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>-</span>np<span style=color:#ff6ac1>.</span>mean(np<span style=color:#ff6ac1>.</span>abs(diff)) <span style=color:#ff6ac1>-</span> <span style=color:#ff9f43>1e-5</span> <span style=color:#ff6ac1>*</span> organism<span style=color:#ff6ac1>.</span>chromosome<span style=color:#ff6ac1>.</span>size
</span></span><span style=display:flex><span>        organism<span style=color:#ff6ac1>.</span>visual <span style=color:#ff6ac1>=</span> screen
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_child</span>(self, a, b):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Breed a and b by mixing the common length genes, keeping most from 
</span></span></span><span style=display:flex><span><span style=color:#5af78e>        the first parent. &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        new_genes <span style=color:#ff6ac1>=</span> []
</span></span><span style=display:flex><span>        n_a, n_b <span style=color:#ff6ac1>=</span> a<span style=color:#ff6ac1>.</span>chromosome<span style=color:#ff6ac1>.</span>shape[<span style=color:#ff9f43>0</span>], b<span style=color:#ff6ac1>.</span>chromosome<span style=color:#ff6ac1>.</span>shape[<span style=color:#ff9f43>0</span>]
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(<span style=color:#ff5c57>max</span>(n_a, n_b)):
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>if</span> i <span style=color:#ff6ac1>&lt;</span> n_a <span style=color:#ff6ac1>and</span> i <span style=color:#ff6ac1>&lt;</span> n_b:
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&lt;</span> <span style=color:#ff9f43>0.7</span>:
</span></span><span style=display:flex><span>                    new_genes<span style=color:#ff6ac1>.</span>append(a<span style=color:#ff6ac1>.</span>chromosome[i, :])
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>                    new_genes<span style=color:#ff6ac1>.</span>append(b<span style=color:#ff6ac1>.</span>chromosome[i, :])
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>elif</span> i <span style=color:#ff6ac1>&lt;</span> n_a:
</span></span><span style=display:flex><span>                new_genes<span style=color:#ff6ac1>.</span>append(a<span style=color:#ff6ac1>.</span>chromosome[i, :])
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&lt;</span> <span style=color:#ff9f43>0.3</span>:
</span></span><span style=display:flex><span>                    new_genes<span style=color:#ff6ac1>.</span>append(b<span style=color:#ff6ac1>.</span>chromosome[i, :])
</span></span><span style=display:flex><span>            chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>array(new_genes)
</span></span><span style=display:flex><span>        o <span style=color:#ff6ac1>=</span> Organism(chromosome)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>calc_fitness(o)
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> o
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>save</span>(self, path):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Save population to json file &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        out <span style=color:#ff6ac1>=</span> [o<span style=color:#ff6ac1>.</span>chromosome<span style=color:#ff6ac1>.</span>tolist() <span style=color:#ff6ac1>for</span> o <span style=color:#ff6ac1>in</span> self<span style=color:#ff6ac1>.</span>population]
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span> <span style=color:#ff5c57>open</span>(path, <span style=color:#5af78e>&#34;w&#34;</span>) <span style=color:#ff6ac1>as</span> f:
</span></span><span style=display:flex><span>            json<span style=color:#ff6ac1>.</span>dump(out, f)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>load</span>(self, path):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Load population from json file &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span> <span style=color:#ff5c57>open</span>(path) <span style=color:#ff6ac1>as</span> f:
</span></span><span style=display:flex><span>            inp <span style=color:#ff6ac1>=</span> json<span style=color:#ff6ac1>.</span>load(f)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>population <span style=color:#ff6ac1>=</span> [Organism(np<span style=color:#ff6ac1>.</span>array(x)) <span style=color:#ff6ac1>for</span> x <span style=color:#ff6ac1>in</span> inp]
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> o <span style=color:#ff6ac1>in</span> self<span style=color:#ff6ac1>.</span>population:
</span></span><span style=display:flex><span>            self<span style=color:#ff6ac1>.</span>calc_fitness(o)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>mutate_and_pick</span>(self, organism, rate, scale, add, attempts<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Mutate organism attempts times to try and get something better &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(attempts):
</span></span><span style=display:flex><span>            o <span style=color:#ff6ac1>=</span> organism<span style=color:#ff6ac1>.</span>mutate(rate<span style=color:#ff6ac1>=</span>rate, scale<span style=color:#ff6ac1>=</span>scale, add<span style=color:#ff6ac1>=</span>add)
</span></span><span style=display:flex><span>            self<span style=color:#ff6ac1>.</span>calc_fitness(o)
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>if</span> o<span style=color:#ff6ac1>.</span>fitness <span style=color:#ff6ac1>&gt;</span> organism<span style=color:#ff6ac1>.</span>fitness:
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>return</span> o
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> organism
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>step</span>(self, time, outdir, rate<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.01</span>, scale<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>, add<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Take a step in time by making some kids, mutating them,
</span></span></span><span style=display:flex><span><span style=color:#5af78e>        and then letting the fittest survive. Nature is a harsh mistress.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#78787e># Get some children by picking the fitter parents</span>
</span></span><span style=display:flex><span>        new_orgs <span style=color:#ff6ac1>=</span> []
</span></span><span style=display:flex><span>        weights <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>-</span> np<span style=color:#ff6ac1>.</span>linspace(<span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>0.2</span>, <span style=color:#ff5c57>len</span>(self<span style=color:#ff6ac1>.</span>population))
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(<span style=color:#ff5c57>len</span>(self<span style=color:#ff6ac1>.</span>population)):
</span></span><span style=display:flex><span>            a, b <span style=color:#ff6ac1>=</span> choice(self<span style=color:#ff6ac1>.</span>population, <span style=color:#ff9f43>2</span>, replace<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, p<span style=color:#ff6ac1>=</span>weights <span style=color:#ff6ac1>/</span> weights<span style=color:#ff6ac1>.</span>sum())
</span></span><span style=display:flex><span>            child <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>get_child(a, b)
</span></span><span style=display:flex><span>            new_orgs<span style=color:#ff6ac1>.</span>append(self<span style=color:#ff6ac1>.</span>mutate_and_pick(child, rate, scale, add))
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#78787e># Calculate fitness,sort fitness, update population</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> o <span style=color:#ff6ac1>in</span> new_orgs:
</span></span><span style=display:flex><span>            self<span style=color:#ff6ac1>.</span>calc_fitness(o)
</span></span><span style=display:flex><span>        sorted_orgs <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>sorted</span>(new_orgs, key<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>lambda</span> x: <span style=color:#ff6ac1>-</span>x<span style=color:#ff6ac1>.</span>fitness)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>population <span style=color:#ff6ac1>=</span> sorted_orgs[:<span style=color:#ff5c57>len</span>(self<span style=color:#ff6ac1>.</span>population)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#78787e># Save out the image if we want it</span>
</span></span><span style=display:flex><span>        path <span style=color:#ff6ac1>=</span> outdir <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;</span><span style=color:#5af78e>{</span>time<span style=color:#5af78e>:</span><span style=color:#5af78e>04d</span><span style=color:#5af78e>}</span><span style=color:#5af78e>.png&#34;</span>
</span></span><span style=display:flex><span>        pygame<span style=color:#ff6ac1>.</span>image<span style=color:#ff6ac1>.</span>save(self<span style=color:#ff6ac1>.</span>population[<span style=color:#ff9f43>0</span>]<span style=color:#ff6ac1>.</span>visual, path)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>save(outdir <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>&#34;save.json&#34;</span>)
</span></span></code></pre></div></div><p>With this population, we can create a handy helper function (again) which points to a reference image, sets an output directup up, and then either loads the checkpoint, or starts anew if its not found!</p><p>When I feel like I have enough samples I&rsquo;ll terminate the function myself - those are more steps than my laptop could ever generate.</p><div class=width-67 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>evolve</span>(rate, scale, add_chance, steps<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>700000</span>):
</span></span><span style=display:flex><span>    pop <span style=color:#ff6ac1>=</span> Population(<span style=color:#5af78e>&#34;genetic2/earring.png&#34;</span>)
</span></span><span style=display:flex><span>    outdir <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;genetic2/output/&#34;</span>
</span></span><span style=display:flex><span>    os<span style=color:#ff6ac1>.</span>makedirs(outdir, exist_ok<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>)
</span></span><span style=display:flex><span>    save <span style=color:#ff6ac1>=</span> outdir <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>&#34;save.json&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> os<span style=color:#ff6ac1>.</span>path<span style=color:#ff6ac1>.</span>exists(save):
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>load(save)
</span></span><span style=display:flex><span>        start <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>int</span>(<span style=color:#ff5c57>sorted</span>(os<span style=color:#ff6ac1>.</span>listdir(outdir))[<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>2</span>][:<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>4</span>]) <span style=color:#ff6ac1>*</span> <span style=color:#ff9f43>2</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>spawn(complexity<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>20</span>)
</span></span><span style=display:flex><span>        start <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>0</span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(start, steps):
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>step(i, outdir, rate<span style=color:#ff6ac1>=</span>rate, scale<span style=color:#ff6ac1>=</span>scale, add<span style=color:#ff6ac1>=</span>add_chance)
</span></span></code></pre></div></div><p>With this all set up, we can now call <code>evolve</code> and see what we get. Here&rsquo;s our starting point again:</p><p><div><figure class="img-main small rounded"><picture><source srcset=/tutorials/genetic_part_two/cover_hu476ccd77f0eb2b6753d1723c43b95e13_907049_800x0_resize_q90_h2_box_3.webp width=800 height=800 type=image/webp><source srcset=/tutorials/genetic_part_two/cover.png width=800 height=800 type=image/png><img width=800 height=800 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>And now lets kick it off:</p><div class="expanded-code width-85" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#78787e># 1% chance of mutation, scale is a normal of std 0.1, and 1% chance to add or remove</span>
</span></span><span style=display:flex><span>evolve(<span style=color:#ff9f43>0.01</span>, <span style=color:#ff9f43>0.1</span>, <span style=color:#ff9f43>0.01</span>)
</span></span></code></pre></div></div><p>I also grabbed some snapshots of the population at the start and then as we progress further. The three images are the population at the start, after 40 iterations, and much later one. Notice that even though the populations grow more similar, each organism is still unique.</p><p><div><figure class=rounded><picture><source srcset=/tutorials/genetic_part_two/2021-03-20-Genetic_Part_Two_files/2021-03-20-Genetic_Part_Two_16_0_huae1e678e985467f1207f8ce33b6cbbac_568329_1600x0_resize_q90_h2_box_3.webp width=1600 height=544 type=image/webp><source srcset=/tutorials/genetic_part_two/2021-03-20-Genetic_Part_Two_files/2021-03-20-Genetic_Part_Two_16_0.png width=1600 height=544 type=image/png><img width=1600 height=544 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p><div><figure class=rounded><picture><source srcset=/tutorials/genetic_part_two/2021-03-20-Genetic_Part_Two_files/2021-03-20-Genetic_Part_Two_17_0_hu598b119c3682f297c9c4c1d6393aa3e2_190650_1594x0_resize_q90_h2_box_3.webp width=1594 height=544 type=image/webp><source srcset=/tutorials/genetic_part_two/2021-03-20-Genetic_Part_Two_files/2021-03-20-Genetic_Part_Two_17_0.png width=1594 height=544 type=image/png><img width=1594 height=544 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p><div><figure class=rounded><picture><source srcset=/tutorials/genetic_part_two/2021-03-20-Genetic_Part_Two_files/2021-03-20-Genetic_Part_Two_18_0_hu5e60559e3bb0494d698aa6da4bd6af61_292504_1606x0_resize_q90_h2_box_3.webp width=1606 height=556 type=image/webp><source srcset=/tutorials/genetic_part_two/2021-03-20-Genetic_Part_Two_files/2021-03-20-Genetic_Part_Two_18_0.png width=1606 height=556 type=image/png><img width=1606 height=556 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Using our good friend <code>ffmpeg</code> to turn some of these PNGs into an animation, we get this:</p><p></p><p>And heres a side by side:</p><p><div><figure class=rounded><picture><source srcset=/tutorials/genetic_part_two/2021-03-20-Genetic_Part_Two_files/2021-03-20-Genetic_Part_Two_22_0_hufba93f665b6a5112cd58ebfcbff06705_1246488_1920x0_resize_q90_h2_box_3.webp width=1920 height=896 type=image/webp><source srcset=/tutorials/genetic_part_two/2021-03-20-Genetic_Part_Two_files/2021-03-20-Genetic_Part_Two_22_0.png width=2093 height=977 type=image/png><img width=2093 height=977 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>This still took quite a whil to run on my laptop, and there are existing solutions out there. If you have a serious problem and require an efficient and sophisticated genetic algorithm to help you out, check out the <a href=https://deap.readthedocs.io/en/master/>DEAP</a> python package.</p><hr><p>For your convenience, here&rsquo;s the code in one block:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> os
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> numpy.random <span style=color:#ff6ac1>import</span> choice, random, normal
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> colour <span style=color:#ff6ac1>import</span> Color
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> json
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> pygame  <span style=color:#78787e># Pygame for nice fast drawing</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>class</span> <span style=color:#f3f99d>Organism</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> __init__(self, genes):
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>clip(genes, <span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>visual <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>fitness <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>None</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>mutate</span>(self, rate<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.01</span>, scale<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>, add<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Get a mutated organism given the mutation rates and scale input &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>copy(self<span style=color:#ff6ac1>.</span>chromosome)
</span></span><span style=display:flex><span>        n_gene, n_feat <span style=color:#ff6ac1>=</span> chromosome<span style=color:#ff6ac1>.</span>shape
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#78787e># Here we can add/remove a gene, or mutate an existing one</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&gt;</span> add:
</span></span><span style=display:flex><span>            <span style=color:#78787e># Mutate features in our genes</span>
</span></span><span style=display:flex><span>            num_mutations <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>+</span> <span style=color:#ff5c57>int</span>(rate <span style=color:#ff6ac1>*</span> n_gene)
</span></span><span style=display:flex><span>            <span style=color:#78787e># As we mutate more, the size of mutations decreases</span>
</span></span><span style=display:flex><span>            scale2 <span style=color:#ff6ac1>=</span> scale <span style=color:#ff6ac1>/</span> num_mutations
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(num_mutations):
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&gt;</span> <span style=color:#ff9f43>0.5</span>:
</span></span><span style=display:flex><span>                    i <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>3</span>
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>                    i <span style=color:#ff6ac1>=</span> choice(n_feat)
</span></span><span style=display:flex><span>                chromosome[choice(n_gene), i] <span style=color:#ff6ac1>+=</span> normal() <span style=color:#ff6ac1>*</span> scale2
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>if</span> i <span style=color:#ff6ac1>==</span> <span style=color:#ff9f43>3</span>:
</span></span><span style=display:flex><span>                    chromosome[:, i] <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>mod(chromosome[:, i], <span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#78787e># Either add or remove a gene</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&lt;</span> <span style=color:#ff9f43>0.3</span>:
</span></span><span style=display:flex><span>                chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>delete(chromosome, choice(n_gene), axis<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#78787e># When we add, we&#39;ll do so by blending two existing genes </span>
</span></span><span style=display:flex><span>                <span style=color:#78787e># and perturbing it. More likely to find a good gene this way.</span>
</span></span><span style=display:flex><span>                a, b <span style=color:#ff6ac1>=</span> choice(n_gene, <span style=color:#ff9f43>2</span>, replace<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>False</span>)
</span></span><span style=display:flex><span>                gene <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>atleast_2d(<span style=color:#ff9f43>0.5</span> <span style=color:#ff6ac1>*</span> (chromosome[a, :] <span style=color:#ff6ac1>+</span> chromosome[b, :]))
</span></span><span style=display:flex><span>                gene <span style=color:#ff6ac1>+=</span> scale <span style=color:#ff6ac1>*</span> normal(size<span style=color:#ff6ac1>=</span>(<span style=color:#ff9f43>1</span>, gene<span style=color:#ff6ac1>.</span>size))
</span></span><span style=display:flex><span>                gene[:, <span style=color:#ff9f43>2</span>] <span style=color:#ff6ac1>*=</span> <span style=color:#ff9f43>0.2</span>
</span></span><span style=display:flex><span>                chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>append(chromosome, gene, axis<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> Organism(chromosome)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#ff6ac1>class</span> <span style=color:#f3f99d>Population</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> __init__(self, path):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Load in the reference image and create a surface we can draw on. &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        pygame<span style=color:#ff6ac1>.</span>init()
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>ref <span style=color:#ff6ac1>=</span> pygame<span style=color:#ff6ac1>.</span>surfarray<span style=color:#ff6ac1>.</span>pixels3d(pygame<span style=color:#ff6ac1>.</span>image<span style=color:#ff6ac1>.</span>load(path))
</span></span><span style=display:flex><span>        w, h, d <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>ref<span style=color:#ff6ac1>.</span>shape
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>screen <span style=color:#ff6ac1>=</span> pygame<span style=color:#ff6ac1>.</span>Surface((w, h))
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>screen<span style=color:#ff6ac1>.</span>fill((<span style=color:#ff9f43>255</span>, <span style=color:#ff9f43>255</span>, <span style=color:#ff9f43>255</span>))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>population <span style=color:#ff6ac1>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>draw</span>(self, organism):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Draw an organism by expressing each gene in term &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        w, h, d <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>ref<span style=color:#ff6ac1>.</span>shape
</span></span><span style=display:flex><span>        screen <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>screen<span style=color:#ff6ac1>.</span>copy()
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> gene <span style=color:#ff6ac1>in</span> organism<span style=color:#ff6ac1>.</span>chromosome:
</span></span><span style=display:flex><span>            x, y, size, <span style=color:#ff6ac1>*</span>hsl <span style=color:#ff6ac1>=</span> gene
</span></span><span style=display:flex><span>            position <span style=color:#ff6ac1>=</span> (<span style=color:#ff5c57>int</span>(x <span style=color:#ff6ac1>*</span> w), <span style=color:#ff5c57>int</span>(y <span style=color:#ff6ac1>*</span> h))
</span></span><span style=display:flex><span>            c <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>tuple</span>(<span style=color:#ff5c57>map</span>(<span style=color:#ff6ac1>lambda</span> x: <span style=color:#ff5c57>int</span>(<span style=color:#ff9f43>255</span> <span style=color:#ff6ac1>*</span> x),  Color(hsl<span style=color:#ff6ac1>=</span>hsl)<span style=color:#ff6ac1>.</span>rgb))
</span></span><span style=display:flex><span>            pygame<span style=color:#ff6ac1>.</span>draw<span style=color:#ff6ac1>.</span>circle(screen, c, position, <span style=color:#ff5c57>int</span>((size <span style=color:#ff6ac1>*</span> <span style=color:#ff9f43>0.3</span> <span style=color:#ff6ac1>+</span> <span style=color:#ff9f43>0.01</span>) <span style=color:#ff6ac1>*</span> w))
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> screen
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>spawn</span>(self, pop_size<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>30</span>, complexity<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Spawn a new population with `complexity` genes in each member with &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(pop_size):
</span></span><span style=display:flex><span>            organism <span style=color:#ff6ac1>=</span> Organism(random((complexity, <span style=color:#ff9f43>6</span>)))
</span></span><span style=display:flex><span>            self<span style=color:#ff6ac1>.</span>population<span style=color:#ff6ac1>.</span>append(organism) 
</span></span><span style=display:flex><span>            self<span style=color:#ff6ac1>.</span>calc_fitness(organism)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>population <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>sorted</span>(self<span style=color:#ff6ac1>.</span>population, key<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>lambda</span> x: <span style=color:#ff6ac1>-</span>x<span style=color:#ff6ac1>.</span>fitness)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>calc_fitness</span>(self, organism):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Calculate the fitness of a gene by drawing it and comparing
</span></span></span><span style=display:flex><span><span style=color:#5af78e>        it to the reference &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        screen <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>draw(organism)
</span></span><span style=display:flex><span>        diff <span style=color:#ff6ac1>=</span> pygame<span style=color:#ff6ac1>.</span>surfarray<span style=color:#ff6ac1>.</span>pixels3d(screen) <span style=color:#ff6ac1>-</span> self<span style=color:#ff6ac1>.</span>ref
</span></span><span style=display:flex><span>        organism<span style=color:#ff6ac1>.</span>fitness <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>-</span>np<span style=color:#ff6ac1>.</span>mean(np<span style=color:#ff6ac1>.</span>abs(diff)) <span style=color:#ff6ac1>-</span> <span style=color:#ff9f43>1e-5</span> <span style=color:#ff6ac1>*</span> organism<span style=color:#ff6ac1>.</span>chromosome<span style=color:#ff6ac1>.</span>size
</span></span><span style=display:flex><span>        organism<span style=color:#ff6ac1>.</span>visual <span style=color:#ff6ac1>=</span> screen
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_child</span>(self, a, b):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Breed a and b by mixing the common length genes, keeping most from 
</span></span></span><span style=display:flex><span><span style=color:#5af78e>        the first parent. &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        new_genes <span style=color:#ff6ac1>=</span> []
</span></span><span style=display:flex><span>        n_a, n_b <span style=color:#ff6ac1>=</span> a<span style=color:#ff6ac1>.</span>chromosome<span style=color:#ff6ac1>.</span>shape[<span style=color:#ff9f43>0</span>], b<span style=color:#ff6ac1>.</span>chromosome<span style=color:#ff6ac1>.</span>shape[<span style=color:#ff9f43>0</span>]
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(<span style=color:#ff5c57>max</span>(n_a, n_b)):
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>if</span> i <span style=color:#ff6ac1>&lt;</span> n_a <span style=color:#ff6ac1>and</span> i <span style=color:#ff6ac1>&lt;</span> n_b:
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&lt;</span> <span style=color:#ff9f43>0.7</span>:
</span></span><span style=display:flex><span>                    new_genes<span style=color:#ff6ac1>.</span>append(a<span style=color:#ff6ac1>.</span>chromosome[i, :])
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>                    new_genes<span style=color:#ff6ac1>.</span>append(b<span style=color:#ff6ac1>.</span>chromosome[i, :])
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>elif</span> i <span style=color:#ff6ac1>&lt;</span> n_a:
</span></span><span style=display:flex><span>                new_genes<span style=color:#ff6ac1>.</span>append(a<span style=color:#ff6ac1>.</span>chromosome[i, :])
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>if</span> random() <span style=color:#ff6ac1>&lt;</span> <span style=color:#ff9f43>0.3</span>:
</span></span><span style=display:flex><span>                    new_genes<span style=color:#ff6ac1>.</span>append(b<span style=color:#ff6ac1>.</span>chromosome[i, :])
</span></span><span style=display:flex><span>            chromosome <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>array(new_genes)
</span></span><span style=display:flex><span>        o <span style=color:#ff6ac1>=</span> Organism(chromosome)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>calc_fitness(o)
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> o
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>save</span>(self, path):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Save population to json file &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        out <span style=color:#ff6ac1>=</span> [o<span style=color:#ff6ac1>.</span>chromosome<span style=color:#ff6ac1>.</span>tolist() <span style=color:#ff6ac1>for</span> o <span style=color:#ff6ac1>in</span> self<span style=color:#ff6ac1>.</span>population]
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span> <span style=color:#ff5c57>open</span>(path, <span style=color:#5af78e>&#34;w&#34;</span>) <span style=color:#ff6ac1>as</span> f:
</span></span><span style=display:flex><span>            json<span style=color:#ff6ac1>.</span>dump(out, f)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>load</span>(self, path):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Load population from json file &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span> <span style=color:#ff5c57>open</span>(path) <span style=color:#ff6ac1>as</span> f:
</span></span><span style=display:flex><span>            inp <span style=color:#ff6ac1>=</span> json<span style=color:#ff6ac1>.</span>load(f)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>population <span style=color:#ff6ac1>=</span> [Organism(np<span style=color:#ff6ac1>.</span>array(x)) <span style=color:#ff6ac1>for</span> x <span style=color:#ff6ac1>in</span> inp]
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> o <span style=color:#ff6ac1>in</span> self<span style=color:#ff6ac1>.</span>population:
</span></span><span style=display:flex><span>            self<span style=color:#ff6ac1>.</span>calc_fitness(o)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>mutate_and_pick</span>(self, organism, rate, scale, add, attempts<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Mutate organism attempts times to try and get something better &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(attempts):
</span></span><span style=display:flex><span>            o <span style=color:#ff6ac1>=</span> organism<span style=color:#ff6ac1>.</span>mutate(rate<span style=color:#ff6ac1>=</span>rate, scale<span style=color:#ff6ac1>=</span>scale, add<span style=color:#ff6ac1>=</span>add)
</span></span><span style=display:flex><span>            self<span style=color:#ff6ac1>.</span>calc_fitness(o)
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>if</span> o<span style=color:#ff6ac1>.</span>fitness <span style=color:#ff6ac1>&gt;</span> organism<span style=color:#ff6ac1>.</span>fitness:
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>return</span> o
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> organism
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>step</span>(self, time, outdir, rate<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.01</span>, scale<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.1</span>, add<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>):
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;&#34;&#34; Take a step in time by making some kids, mutating them,
</span></span></span><span style=display:flex><span><span style=color:#5af78e>        and then letting the fittest survive. Nature is a harsh mistress.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#78787e># Get some children by picking the fitter parents</span>
</span></span><span style=display:flex><span>        new_orgs <span style=color:#ff6ac1>=</span> []
</span></span><span style=display:flex><span>        weights <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>-</span> np<span style=color:#ff6ac1>.</span>linspace(<span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>0.2</span>, <span style=color:#ff5c57>len</span>(self<span style=color:#ff6ac1>.</span>population))
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(<span style=color:#ff5c57>len</span>(self<span style=color:#ff6ac1>.</span>population)):
</span></span><span style=display:flex><span>            a, b <span style=color:#ff6ac1>=</span> choice(self<span style=color:#ff6ac1>.</span>population, <span style=color:#ff9f43>2</span>, replace<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, p<span style=color:#ff6ac1>=</span>weights <span style=color:#ff6ac1>/</span> weights<span style=color:#ff6ac1>.</span>sum())
</span></span><span style=display:flex><span>            child <span style=color:#ff6ac1>=</span> self<span style=color:#ff6ac1>.</span>get_child(a, b)
</span></span><span style=display:flex><span>            new_orgs<span style=color:#ff6ac1>.</span>append(self<span style=color:#ff6ac1>.</span>mutate_and_pick(child, rate, scale, add))
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#78787e># Calculate fitness,sort fitness, update population</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>for</span> o <span style=color:#ff6ac1>in</span> new_orgs:
</span></span><span style=display:flex><span>            self<span style=color:#ff6ac1>.</span>calc_fitness(o)
</span></span><span style=display:flex><span>        sorted_orgs <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>sorted</span>(new_orgs, key<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>lambda</span> x: <span style=color:#ff6ac1>-</span>x<span style=color:#ff6ac1>.</span>fitness)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>population <span style=color:#ff6ac1>=</span> sorted_orgs[:<span style=color:#ff5c57>len</span>(self<span style=color:#ff6ac1>.</span>population)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#78787e># Save out the image if we want it</span>
</span></span><span style=display:flex><span>        path <span style=color:#ff6ac1>=</span> outdir <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;</span><span style=color:#5af78e>{</span>time<span style=color:#5af78e>:</span><span style=color:#5af78e>04d</span><span style=color:#5af78e>}</span><span style=color:#5af78e>.png&#34;</span>
</span></span><span style=display:flex><span>        pygame<span style=color:#ff6ac1>.</span>image<span style=color:#ff6ac1>.</span>save(self<span style=color:#ff6ac1>.</span>population[<span style=color:#ff9f43>0</span>]<span style=color:#ff6ac1>.</span>visual, path)
</span></span><span style=display:flex><span>        self<span style=color:#ff6ac1>.</span>save(outdir <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>&#34;save.json&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>evolve</span>(rate, scale, add_chance, steps<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>700000</span>):
</span></span><span style=display:flex><span>    pop <span style=color:#ff6ac1>=</span> Population(<span style=color:#5af78e>&#34;genetic2/earring.png&#34;</span>)
</span></span><span style=display:flex><span>    outdir <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;genetic2/output/&#34;</span>
</span></span><span style=display:flex><span>    os<span style=color:#ff6ac1>.</span>makedirs(outdir, exist_ok<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>)
</span></span><span style=display:flex><span>    save <span style=color:#ff6ac1>=</span> outdir <span style=color:#ff6ac1>+</span> <span style=color:#5af78e>&#34;save.json&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> os<span style=color:#ff6ac1>.</span>path<span style=color:#ff6ac1>.</span>exists(save):
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>load(save)
</span></span><span style=display:flex><span>        start <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>int</span>(<span style=color:#ff5c57>sorted</span>(os<span style=color:#ff6ac1>.</span>listdir(outdir))[<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>2</span>][:<span style=color:#ff6ac1>-</span><span style=color:#ff9f43>4</span>]) <span style=color:#ff6ac1>*</span> <span style=color:#ff9f43>2</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>else</span>:
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>spawn(complexity<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>20</span>)
</span></span><span style=display:flex><span>        start <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>0</span>    
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>for</span> i <span style=color:#ff6ac1>in</span> <span style=color:#ff5c57>range</span>(start, steps):
</span></span><span style=display:flex><span>        pop<span style=color:#ff6ac1>.</span>step(i, outdir, rate<span style=color:#ff6ac1>=</span>rate, scale<span style=color:#ff6ac1>=</span>scale, add<span style=color:#ff6ac1>=</span>add_chance)
</span></span><span style=display:flex><span><span style=color:#78787e># 1% chance of mutation, scale is a normal of std 0.1, and 1% chance to add or remove</span>
</span></span><span style=display:flex><span>evolve(<span style=color:#ff9f43>0.01</span>, <span style=color:#ff9f43>0.1</span>, <span style=color:#ff9f43>0.01</span>)
</span></span></code></pre></div><div class="relative max-w-xl mx-auto my-20"><div class="fancy_card horizontal"><div class=card_translator><div class="card_rotator tiny_rot card_layer"><div class="card_layer newsletter p-2"><div class="newsletter-inner h-full"><div class="relative h-full sib-form-container" id=sib-form-container><div class="mb-6 lg:mb-12 text-center"><h3 class="text-main-200 mb-2 lg:mb-8">Stay in the loop!</h3><p class="text-main-100 text-lg text-opacity-70">For new releases, exclusive giveaways, and reviews.</p></div><form action="https://Cosmiccoding.us5.list-manage.com/subscribe/post?u=aebe5de1d2e40dccb3aeca491&amp;id=3987dd4a1f" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class="validate w-full" target=_blank novalidate><div><input type=email class="w-full appearance-none bg-main-600 mb-4 border border-main-600 bg-opacity-5 focus:border-main-300 rounded-sm px-4 py-3 text-main-100 placeholder-main-100 required" placeholder="Your best email" aria-label="Your best email" name=EMAIL required data-required=true id=EMAIL><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_aebe5de1d2e40dccb3aeca491_3987dd4a1f tabindex=-1></div><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class="button btn bg-main-600 hover:bg-main-400 shadow w-full"></div><p id=mce-error-response style=display:none class="text-center mt-2 opacity-50 text-main-200">There was a problem, please try again.</p><p id=mce-success-response style=display:none class="text-center mt-2 opacity-50 text-main-200">Thanks mate, won't let ya down.</p></form></div></div></div><div class="card_layer card_effect card_soft_glare" style=pointer-events:none></div></div></div></div></div></div><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script></div><script language=javascript type=text/javascript src=https://cosmiccoding.com.au/js/main.min.11673d10a962fb5205229607e62ea1d23424d35dad33db7bfe2a09a63d5409fa.js></script>
<script async defer src="https://www.googletagmanager.com/gtag/js?id=G-GRX6QE03YR"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GRX6QE03YR")</script></div></body></html>