<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>A visual tutorial of Inversion Sampling - Samuel Hinton</title><link rel=stylesheet href="https://cosmiccoding.com.au/css/main.min.5400481537df6ded7c631d7584eaeb522e0bea3c952908a01d5163e524dfbcde.css" integrity="sha256-VABIFTffbe18Yx11hOrrUi4L6jyVKQigHVFj5STfvN4="><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel="shortcut icon" href=https://cosmiccoding.com.au/img/favicon.png type=image/x-icon></head><meta name=description content="Efficient inversion sampling explained with Python."><meta name=robots content="noodp"><link rel=canonical href=https://cosmiccoding.com.au/tutorials/inversion_sampling/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cosmiccoding.com.au/tutorials/inversion_sampling/cover.png"><meta name=twitter:title content="A visual tutorial of Inversion Sampling"><meta name=twitter:description content="Efficient inversion sampling explained with Python."><meta property="og:title" content="A visual tutorial of Inversion Sampling"><meta property="og:description" content="Efficient inversion sampling explained with Python."><meta property="og:type" content="article"><meta property="og:url" content="https://cosmiccoding.com.au/tutorials/inversion_sampling/"><meta property="og:image" content="https://cosmiccoding.com.au/tutorials/inversion_sampling/cover.png"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2020-06-19T00:00:00+00:00"><meta property="article:modified_time" content="2020-06-19T00:00:00+00:00"><meta property="article:section" content="tutorial"><meta property="article:published_time" content="2020-06-19 00:00:00 +0000 UTC"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"A visual tutorial of Inversion Sampling","genre":"tutorial","url":"https:\/\/cosmiccoding.com.au\/tutorials\/inversion_sampling\/","datePublished":"2020-06-19 00:00:00 \u002b0000 UTC","description":"Efficient inversion sampling explained with Python.","author":{"@type":"Person","name":""}}</script><body><div class="flex flex-col min-h-screen overflow-hidden"><header class="absolute w-full z-30"><div class="max-w-6xl mx-auto px-4 sm:px-6"><div class="flex items-center justify-between h-20"><div class="flex-shrink-0 mr-4"><a class=block href=/ aria-label="Samuel Hinton"><h2 class=logo>SRH</h2></a></div><nav class="hidden md:flex md:flex-grow"><ul class="flex flex-grow justify-end flex-wrap items-center"><li><a href=/#books class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Books</a></li><li><a href=/reviews class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Reviews</a></li><li><a href=/tutorials class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Tutorials</a></li><li><a href=/blogs class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Blog</a></li><li><a href=/#courses class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out">CV</a></li></ul></nav><div class=md:hidden x-data="{ expanded: false }"><button class=hamburger :class="{ 'active': expanded }" @click.stop="expanded = !expanded" aria-controls=mobile-nav :aria-expanded=expanded>
<span class=sr-only>Menu</span><svg class="w-6 h-6 fill-current text-gray-300 hover:text-gray-200 transition duration-150 ease-in-out" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect y="4" width="24" height="2" rx="1"/><rect y="11" width="24" height="2" rx="1"/><rect y="18" width="24" height="2" rx="1"/></svg></button><nav id=mobile-nav class="absolute top-full z-20 left-0 w-full px-4 sm:px-6 overflow-hidden transition-all duration-300 ease-in-out" x-ref=mobileNav :style="expanded ? 'max-height: ' + $refs.mobileNav.scrollHeight + 'px; opacity: 1' : 'max-height: 0; opacity: .8'" @click.away="expanded = false" @keydown.escape.window="expanded = false" x-cloak><ul class="bg-gray-800 px-4 py-2"><li><a href=/#books class="flex text-gray-300 hover:text-gray-200 py-2">Books</a></li><li><a href=/reviews class="flex text-gray-300 hover:text-gray-200 py-2">Reviews</a></li><li><a href=/tutorials class="flex text-gray-300 hover:text-gray-200 py-2">Tutorials</a></li><li><a href=/blogs class="flex text-gray-300 hover:text-gray-200 py-2">Blog</a></li><li><a href=/#courses class="flex text-gray-300 hover:text-gray-200 py-2">Courses</a></li><li><a href=/static/resume/HintonCV.pdf class="flex text-gray-300 hover:text-gray-200 py-2">CV</a></li></ul></nav></div></div></div></header><div class=flex-grow><div id=post-container class="content content-wider blog-post relative"><div class="section-header blog"><h1 class=title>A visual tutorial of Inversion Sampling</h1><p>6th June 2020</p><p>Efficient inversion sampling explained with Python.</p></div><div><ul class="grid gap-6 w-full md:grid-cols-2" style=list-style:none;padding-left:0><li><input type=radio id=show-code name=code-toggle value=show-code class="hidden peer" onchange=clickCheckbox(this) required checked>
<label for=show-code class="inline-flex justify-between items-center p-5 w-full text-gray-500 bg-gray-800 rounded-lg border border-gray-200 cursor-pointer peer-checked:border-2 peer-checked:border-main-300 peer-checked:text-white peer-checked:bg-gray-700 hover:text-gray-200 hover:bg-gray-700"><div class="block w-full"><div class="w-full text-center text-lg font-semibold">Show me everything!</div><div class="w-full text-center text-sm">Oh yeah, coding time.</div></div></label></li><li><input type=radio id=hide-code name=code-toggle value=hide-code class="hidden peer" onchange=clickCheckbox(this)>
<label for=hide-code class="inline-flex justify-between items-center p-5 w-full text-gray-500 bg-gray-800 rounded-lg border border-gray-200 cursor-pointer peer-checked:border-2 peer-checked:border-main-300 peer-checked:text-white peer-checked:bg-gray-700 hover:text-gray-200 hover:bg-gray-700"><div class="block w-full"><div class="w-full text-center text-lg font-semibold">Just the plots</div><div class="w-full text-center text-sm">Code is nasty.</div></div></label></li></ul></div><script>function clickCheckbox(e){e.id=="show-code"?document.getElementById("post-container").classList.remove("hide-code"):document.getElementById("post-container").classList.add("hide-code")}</script><p>Inversion sampling is a simple and very efficient way to generate samples of some arbitrary probability function. Unlike rejection sampling, there are no rejected samples, and by leveraing common python libraries, we don&rsquo;t even have to do any tricky integrals or function inversion.</p><p>$$ P(x) = 2 x $$</p><p>between 0 and 1. It just happens this does integrate to 1, what luck! Now, the CDF (cumulative distribution function) is the integral of the probability density function (what you see above), integrated from the lower bound - in our case the bounds are 0 to 1, so the CDF is</p><p>$$ CDF(x) = \int_0^x 2 x\ dx = [x^2 - 0^2] = x^2 $$</p><p>Let&rsquo;s visualise the PDF and the CDF quickly:</p><div class="reduced-code width-48" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> matplotlib.pyplot <span style=color:#ff6ac1>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>pdf</span>(x):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> <span style=color:#ff9f43>2</span> <span style=color:#ff6ac1>*</span> x
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>cdf</span>(x):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> x<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>xs <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>linspace(<span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>1</span>, <span style=color:#ff9f43>1000</span>)
</span></span><span style=display:flex><span>ps <span style=color:#ff6ac1>=</span> pdf(xs)
</span></span><span style=display:flex><span>cdfs <span style=color:#ff6ac1>=</span> cdf(xs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fig, axes <span style=color:#ff6ac1>=</span> plt<span style=color:#ff6ac1>.</span>subplots(ncols<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>2</span>)
</span></span><span style=display:flex><span>axes[<span style=color:#ff9f43>0</span>]<span style=color:#ff6ac1>.</span>plot(xs, ps, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;PDF&#34;</span>) 
</span></span><span style=display:flex><span>axes[<span style=color:#ff9f43>0</span>]<span style=color:#ff6ac1>.</span>fill_between(xs, ps, <span style=color:#ff9f43>0</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>)
</span></span><span style=display:flex><span>axes[<span style=color:#ff9f43>1</span>]<span style=color:#ff6ac1>.</span>plot(xs, cdfs, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;CDF&#34;</span>) 
</span></span><span style=display:flex><span>axes[<span style=color:#ff9f43>1</span>]<span style=color:#ff6ac1>.</span>fill_between(xs, cdfs, <span style=color:#ff9f43>0</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>)
</span></span><span style=display:flex><span>axes[<span style=color:#ff9f43>0</span>]<span style=color:#ff6ac1>.</span>set_xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), axes[<span style=color:#ff9f43>1</span>]<span style=color:#ff6ac1>.</span>set_xlabel(<span style=color:#5af78e>&#34;x&#34;</span>)
</span></span><span style=display:flex><span>axes[<span style=color:#ff9f43>0</span>]<span style=color:#ff6ac1>.</span>legend(), axes[<span style=color:#ff9f43>1</span>]<span style=color:#ff6ac1>.</span>legend();
</span></span></code></pre></div></div><p><div><figure class=rounded><picture><source srcset=/tutorials/inversion_sampling/2020-06-19-Inversion_Sampling_files/2020-06-19-Inversion_Sampling_1_0_hu92375d0e6433bc8b40bb3c87c23f8aa6_109437_1920x0_resize_q90_h2_box_3.webp width=1920 height=1051 type=image/webp><source srcset=/tutorials/inversion_sampling/2020-06-19-Inversion_Sampling_files/2020-06-19-Inversion_Sampling_1_0.png width=2778 height=1521 type=image/png><img width=2778 height=1521 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>So in our case, the CDF looks pretty similar to the PDF, obviously this won&rsquo;t be the case if we picked something other than a simple polynomial, but you get the idea. The property that we are making use of is that the CDF will - by definition - go from 0 to 1 for any PDF. So for inversion sampling, we follow a simple procedure:</p><ol><li>Pick a number (our CDF value) between 0 and 1</li><li>Figure out what $x$ value gives that CDF</li><li>Return that $x$ value as our sample.</li></ol><p>That&rsquo;s it!</p><p>The most common cause of confusion is &ldquo;Why are we uniformly sampling the CDF?&rdquo; Think about it like this - between CDF values 0.2 and 0.4, there is 20% of the probability area, right? And if you uniformly sample between 0 and 1, you get between 0.2 and 0.4 20% of the time.</p><p>So let&rsquo;s write this up for our function above, and then we&rsquo;ll generalise to <em>any</em> function and remove the math.</p><div class="reduced-code width-59" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>inverse_cdf</span>(cdf):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> np<span style=color:#ff6ac1>.</span>sqrt(cdf)  <span style=color:#78787e># cdf = x**2, so x = sqrt(cdf)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>sample</span>(n<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>):
</span></span><span style=display:flex><span>    u <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>random(size<span style=color:#ff6ac1>=</span>n)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> inverse_cdf(u)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>samples <span style=color:#ff6ac1>=</span> sample(n<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>100000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ps, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;PDF&#34;</span>) 
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, ps, <span style=color:#ff9f43>0</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>hist(samples, density<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Samples&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>legend(), plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>);
</span></span></code></pre></div></div><p><div><figure class=rounded><picture><source srcset=/tutorials/inversion_sampling/2020-06-19-Inversion_Sampling_files/2020-06-19-Inversion_Sampling_3_0_hu57efb488865a4eafb04978a3175d8052_101265_1920x0_resize_q90_h2_box_3.webp width=1920 height=1051 type=image/webp><source srcset=/tutorials/inversion_sampling/2020-06-19-Inversion_Sampling_files/2020-06-19-Inversion_Sampling_3_0.png width=2778 height=1521 type=image/png><img width=2778 height=1521 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Great, so this is obviously working well, the sample distribution closely follows the input PDF. So lets generalise this to be any function. We can use simple numeric integration to remove the requirement for us to be able to analytically integrate and then invert the PDF.</p><div class="reduced-code width-42" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>xs <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>linspace(<span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>6.06948</span>, <span style=color:#ff9f43>1000</span>)
</span></span><span style=display:flex><span>pdfs <span style=color:#ff6ac1>=</span> ((<span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>+</span> np<span style=color:#ff6ac1>.</span>cos(xs)) <span style=color:#ff6ac1>/</span> (<span style=color:#ff9f43>1.5</span> <span style=color:#ff6ac1>*</span> xs <span style=color:#ff6ac1>+</span> <span style=color:#ff9f43>3</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, pdfs, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;PDF&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, pdfs, <span style=color:#ff9f43>0</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), plt<span style=color:#ff6ac1>.</span>legend();
</span></span></code></pre></div></div><p><div><figure class=rounded><picture><source srcset=/tutorials/inversion_sampling/2020-06-19-Inversion_Sampling_files/2020-06-19-Inversion_Sampling_5_0_hu3a35e76f74f028a24cb491b68c6145f6_74925_1920x0_resize_q90_h2_box_3.webp width=1920 height=1066 type=image/webp><source srcset=/tutorials/inversion_sampling/2020-06-19-Inversion_Sampling_files/2020-06-19-Inversion_Sampling_5_0.png width=2693 height=1495 type=image/png><img width=2693 height=1495 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Now lets determine the CDF, invert it, and return an interpolator we can use to sample it:</p><div class="expanded-code width-85" markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>from</span> scipy.interpolate <span style=color:#ff6ac1>import</span> interp1d
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> scipy.integrate <span style=color:#ff6ac1>import</span> cumtrapz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_inverted_cdf</span>(xs, pdfs):
</span></span><span style=display:flex><span>    cdfs <span style=color:#ff6ac1>=</span> cumtrapz(pdfs, x<span style=color:#ff6ac1>=</span>xs) <span style=color:#78787e># Get the CDF using a very fast trapz rule</span>
</span></span><span style=display:flex><span>    cdfs <span style=color:#ff6ac1>=</span> cdfs <span style=color:#ff6ac1>/</span> cdfs<span style=color:#ff6ac1>.</span>max()  <span style=color:#78787e># Ensure its normalised, to cater for unnormalised PDFs</span>
</span></span><span style=display:flex><span>    cdfs <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>insert(cdfs, <span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>0</span>)  <span style=color:#78787e># Add the 0 area to start of the CDF array</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> interp1d(cdfs, xs, kind<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;linear&#34;</span>)  <span style=color:#78787e># return interpolation from cdf -&gt; x</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>sample_fn</span>(fn, n<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> fn(np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>random(size<span style=color:#ff6ac1>=</span>n))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fn <span style=color:#ff6ac1>=</span> get_inverted_cdf(xs, pdfs)
</span></span><span style=display:flex><span>samples_2 <span style=color:#ff6ac1>=</span> sample_fn(fn, n<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>100000</span>)
</span></span></code></pre></div></div><p>Let&rsquo;s check it works by comparing the histogram of samples to the function:</p><div class=width-61 markdown=1><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, pdfs, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;PDF&#34;</span>) 
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, pdfs, <span style=color:#ff9f43>0</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>hist(samples_2, density<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Samples&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>legend(), plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>);
</span></span></code></pre></div></div><p><div><figure class=rounded><picture><source srcset=/tutorials/inversion_sampling/2020-06-19-Inversion_Sampling_files/2020-06-19-Inversion_Sampling_9_0_hu78d9b592b710e33443e68712198bb931_94231_1920x0_resize_q90_h2_box_3.webp width=1920 height=1066 type=image/webp><source srcset=/tutorials/inversion_sampling/2020-06-19-Inversion_Sampling_files/2020-06-19-Inversion_Sampling_9_0.png width=2693 height=1495 type=image/png><img width=2693 height=1495 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>Beautiful. Now to try and tie it all together, here is one final, more complicated plot, showing the sampling of the CDF (on the top y axis), to figuring out what $x$ value it corresponds to, to where those samples lie in the PDF on the bottom.</p><p><div><figure class="img-main rounded"><picture><source srcset=/tutorials/inversion_sampling/cover_hudd1110e32c99b742ad4791503ec43833_138207_1920x0_resize_q90_h2_box_3.webp width=1920 height=1460 type=image/webp><source srcset=/tutorials/inversion_sampling/cover.png width=2794 height=2125 type=image/png><img width=2794 height=2125 loading=lazy decoding=async alt=png src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPMn7vLFAAFRgH97g1QygAAAABJRU5ErkJggg=="></picture></figure></div></p><p>So you can see - hopefully fairly clearly - how our uniform sampling on the CDF, after being traced horizontally to the CDF and then vertically down to the $x$ value, gives us samples which are distributed according to the underlying PDF.</p><hr><p>For your convenience, here&rsquo;s the code in one block:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff6ac1>import</span> numpy <span style=color:#ff6ac1>as</span> np
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> matplotlib.pyplot <span style=color:#ff6ac1>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>pdf</span>(x):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> <span style=color:#ff9f43>2</span> <span style=color:#ff6ac1>*</span> x
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>cdf</span>(x):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> x<span style=color:#ff6ac1>**</span><span style=color:#ff9f43>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>xs <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>linspace(<span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>1</span>, <span style=color:#ff9f43>1000</span>)
</span></span><span style=display:flex><span>ps <span style=color:#ff6ac1>=</span> pdf(xs)
</span></span><span style=display:flex><span>cdfs <span style=color:#ff6ac1>=</span> cdf(xs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fig, axes <span style=color:#ff6ac1>=</span> plt<span style=color:#ff6ac1>.</span>subplots(ncols<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>2</span>)
</span></span><span style=display:flex><span>axes[<span style=color:#ff9f43>0</span>]<span style=color:#ff6ac1>.</span>plot(xs, ps, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;PDF&#34;</span>) 
</span></span><span style=display:flex><span>axes[<span style=color:#ff9f43>0</span>]<span style=color:#ff6ac1>.</span>fill_between(xs, ps, <span style=color:#ff9f43>0</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>)
</span></span><span style=display:flex><span>axes[<span style=color:#ff9f43>1</span>]<span style=color:#ff6ac1>.</span>plot(xs, cdfs, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;CDF&#34;</span>) 
</span></span><span style=display:flex><span>axes[<span style=color:#ff9f43>1</span>]<span style=color:#ff6ac1>.</span>fill_between(xs, cdfs, <span style=color:#ff9f43>0</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>)
</span></span><span style=display:flex><span>axes[<span style=color:#ff9f43>0</span>]<span style=color:#ff6ac1>.</span>set_xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), axes[<span style=color:#ff9f43>1</span>]<span style=color:#ff6ac1>.</span>set_xlabel(<span style=color:#5af78e>&#34;x&#34;</span>)
</span></span><span style=display:flex><span>axes[<span style=color:#ff9f43>0</span>]<span style=color:#ff6ac1>.</span>legend(), axes[<span style=color:#ff9f43>1</span>]<span style=color:#ff6ac1>.</span>legend();
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>inverse_cdf</span>(cdf):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> np<span style=color:#ff6ac1>.</span>sqrt(cdf)  <span style=color:#78787e># cdf = x**2, so x = sqrt(cdf)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>sample</span>(n<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>):
</span></span><span style=display:flex><span>    u <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>random(size<span style=color:#ff6ac1>=</span>n)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> inverse_cdf(u)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>samples <span style=color:#ff6ac1>=</span> sample(n<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>100000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, ps, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;PDF&#34;</span>) 
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, ps, <span style=color:#ff9f43>0</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>hist(samples, density<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Samples&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>legend(), plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>);
</span></span><span style=display:flex><span>xs <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>linspace(<span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>6.06948</span>, <span style=color:#ff9f43>1000</span>)
</span></span><span style=display:flex><span>pdfs <span style=color:#ff6ac1>=</span> ((<span style=color:#ff9f43>1</span> <span style=color:#ff6ac1>+</span> np<span style=color:#ff6ac1>.</span>cos(xs)) <span style=color:#ff6ac1>/</span> (<span style=color:#ff9f43>1.5</span> <span style=color:#ff6ac1>*</span> xs <span style=color:#ff6ac1>+</span> <span style=color:#ff9f43>3</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, pdfs, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;PDF&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, pdfs, <span style=color:#ff9f43>0</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>), plt<span style=color:#ff6ac1>.</span>legend();
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> scipy.interpolate <span style=color:#ff6ac1>import</span> interp1d
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> scipy.integrate <span style=color:#ff6ac1>import</span> cumtrapz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>get_inverted_cdf</span>(xs, pdfs):
</span></span><span style=display:flex><span>    cdfs <span style=color:#ff6ac1>=</span> cumtrapz(pdfs, x<span style=color:#ff6ac1>=</span>xs) <span style=color:#78787e># Get the CDF using a very fast trapz rule</span>
</span></span><span style=display:flex><span>    cdfs <span style=color:#ff6ac1>=</span> cdfs <span style=color:#ff6ac1>/</span> cdfs<span style=color:#ff6ac1>.</span>max()  <span style=color:#78787e># Ensure its normalised, to cater for unnormalised PDFs</span>
</span></span><span style=display:flex><span>    cdfs <span style=color:#ff6ac1>=</span> np<span style=color:#ff6ac1>.</span>insert(cdfs, <span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>0</span>)  <span style=color:#78787e># Add the 0 area to start of the CDF array</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> interp1d(cdfs, xs, kind<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;linear&#34;</span>)  <span style=color:#78787e># return interpolation from cdf -&gt; x</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>sample_fn</span>(fn, n<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>):
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> fn(np<span style=color:#ff6ac1>.</span>random<span style=color:#ff6ac1>.</span>random(size<span style=color:#ff6ac1>=</span>n))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fn <span style=color:#ff6ac1>=</span> get_inverted_cdf(xs, pdfs)
</span></span><span style=display:flex><span>samples_2 <span style=color:#ff6ac1>=</span> sample_fn(fn, n<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>100000</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>plot(xs, pdfs, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;PDF&#34;</span>) 
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>fill_between(xs, pdfs, <span style=color:#ff9f43>0</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.2</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>hist(samples_2, density<span style=color:#ff6ac1>=</span><span style=color:#ff6ac1>True</span>, alpha<span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0.3</span>, label<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Samples&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#ff6ac1>.</span>legend(), plt<span style=color:#ff6ac1>.</span>xlabel(<span style=color:#5af78e>&#34;x&#34;</span>);
</span></span></code></pre></div><div class="relative max-w-xl mx-auto my-20"><div class="fancy_card horizontal"><div class=card_translator><div class="card_rotator tiny_rot card_layer"><div class="card_layer newsletter p-2"><div class="newsletter-inner h-full"><div class="relative h-full sib-form-container" id=sib-form-container><div class="mb-6 lg:mb-12 text-center"><h3 class="text-main-200 mb-2 lg:mb-8">Stay in the loop!</h3><p class="text-main-100 text-lg text-opacity-70">For new releases, exclusive giveaways, and reviews.</p></div><form action="https://Cosmiccoding.us5.list-manage.com/subscribe/post?u=aebe5de1d2e40dccb3aeca491&amp;id=3987dd4a1f" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class="validate w-full" target=_blank novalidate><div><input type=email class="w-full appearance-none bg-main-600 mb-4 border border-main-600 bg-opacity-5 focus:border-main-300 rounded-sm px-4 py-3 text-main-100 placeholder-main-100 required" placeholder="Your best email…" aria-label="Your best email…" name=EMAIL required data-required=true id=EMAIL><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_aebe5de1d2e40dccb3aeca491_3987dd4a1f tabindex=-1></div><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class="button btn bg-main-600 hover:bg-main-400 shadow w-full"></div><p id=mce-error-response style=display:none class="text-center mt-2 opacity-50 text-main-200">There was a problem, please try again.</p><p id=mce-success-response style=display:none class="text-center mt-2 opacity-50 text-main-200">Thanks mate, won't let ya down.</p></form></div></div></div><div class="card_layer card_effect card_soft_glare" style=pointer-events:none></div></div></div></div></div></div><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script></div><script language=javascript type=text/javascript src=https://cosmiccoding.com.au/js/main.min.11673d10a962fb5205229607e62ea1d23424d35dad33db7bfe2a09a63d5409fa.js></script>
<script async defer src="https://www.googletagmanager.com/gtag/js?id=G-GRX6QE03YR"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GRX6QE03YR")</script></div></body></html>